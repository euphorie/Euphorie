"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[17716],{17716:function(t,e,o){o.r(e),o.d(e,{factory:function(){return Ct}});var n,l,r=o(73845),s=o(2376),i=o(87823),a=o(84348),c=o(7327),d=o(16560);if("undefined"!=typeof WeakMap){let t=new WeakMap;n=e=>t.get(e),l=(e,o)=>(t.set(e,o),o)}else{const t=[],e=10;let o=0;n=e=>{for(let o=0;o<t.length;o+=2)if(t[o]==e)return t[o+1]},l=(n,l)=>(o==e&&(o=0),t[o++]=n,t[o++]=l)}var h=class{constructor(t,e,o,n){this.width=t,this.height=e,this.map=o,this.problems=n}findCell(t){for(let e=0;e<this.map.length;e++){const o=this.map[e];if(o!=t)continue;const n=e%this.width,l=e/this.width|0;let r=n+1,s=l+1;for(let t=1;r<this.width&&this.map[e+t]==o;t++)r++;for(let t=1;s<this.height&&this.map[e+this.width*t]==o;t++)s++;return{left:n,top:l,right:r,bottom:s}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,o){const{left:n,right:l,top:r,bottom:s}=this.findCell(t);return"horiz"==e?(o<0?0==n:l==this.width)?null:this.map[r*this.width+(o<0?n-1:l)]:(o<0?0==r:s==this.height)?null:this.map[n+this.width*(o<0?r-1:s)]}rectBetween(t,e){const{left:o,right:n,top:l,bottom:r}=this.findCell(t),{left:s,right:i,top:a,bottom:c}=this.findCell(e);return{left:Math.min(o,s),top:Math.min(l,a),right:Math.max(n,i),bottom:Math.max(r,c)}}cellsInRect(t){const e=[],o={};for(let n=t.top;n<t.bottom;n++)for(let l=t.left;l<t.right;l++){const r=n*this.width+l,s=this.map[r];o[s]||(o[s]=!0,l==t.left&&l&&this.map[r-1]==s||n==t.top&&n&&this.map[r-this.width]==s||e.push(s))}return e}positionAt(t,e,o){for(let n=0,l=0;;n++){const r=l+o.child(n).nodeSize;if(n==t){let o=e+t*this.width;const n=(t+1)*this.width;for(;o<n&&this.map[o]<l;)o++;return o==n?r-1:this.map[o]}l=r}}static get(t){return n(t)||l(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);const e=function(t){let e=-1,o=!1;for(let n=0;n<t.childCount;n++){const l=t.child(n);let r=0;if(o)for(let e=0;e<n;e++){const o=t.child(e);for(let t=0;t<o.childCount;t++){const l=o.child(t);e+l.attrs.rowspan>n&&(r+=l.attrs.colspan)}}for(let t=0;t<l.childCount;t++){const e=l.child(t);r+=e.attrs.colspan,e.attrs.rowspan>1&&(o=!0)}-1==e?e=r:e!=r&&(e=Math.max(e,r))}return e}(t),o=t.childCount,n=[];let l=0,r=null;const s=[];for(let t=0,l=e*o;t<l;t++)n[t]=0;for(let i=0,a=0;i<o;i++){const c=t.child(i);a++;for(let t=0;;t++){for(;l<n.length&&0!=n[l];)l++;if(t==c.childCount)break;const d=c.child(t),{colspan:h,rowspan:p,colwidth:u}=d.attrs;for(let t=0;t<p;t++){if(t+i>=o){(r||(r=[])).push({type:"overlong_rowspan",pos:a,n:p-t});break}const c=l+t*e;for(let t=0;t<h;t++){0==n[c+t]?n[c+t]=a:(r||(r=[])).push({type:"collision",row:i,pos:a,n:h-t});const o=u&&u[t];if(o){const n=(c+t)%e*2,l=s[n];null==l||l!=o&&1==s[n+1]?(s[n]=o,s[n+1]=1):l==o&&s[n+1]++}}}l+=h,a+=d.nodeSize}const d=(i+1)*e;let h=0;for(;l<d;)0==n[l++]&&h++;h&&(r||(r=[])).push({type:"missing",row:i,n:h}),a++}const i=new h(e,o,n,r);let a=!1;for(let t=0;!a&&t<s.length;t+=2)null!=s[t]&&s[t+1]<o&&(a=!0);a&&function(t,e,o){t.problems||(t.problems=[]);const n={};for(let l=0;l<t.map.length;l++){const r=t.map[l];if(n[r])continue;n[r]=!0;const s=o.nodeAt(r);if(!s)throw new RangeError(`No cell with offset ${r} found`);let i=null;const a=s.attrs;for(let o=0;o<a.colspan;o++){const n=e[2*((l+o)%t.width)];null==n||a.colwidth&&a.colwidth[o]==n||((i||(i=p(a)))[o]=n)}i&&t.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:i})}}(i,s,t);return i}(t))}};function p(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let o=0;o<t.colspan;o++)e.push(0);return e}function u(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const o in t.nodes){const n=t.nodes[o],l=n.spec.tableRole;l&&(e[l]=n)}}return e}var f=new s.H$("selectingCells");function m(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function w(t){const e=t.selection.$head;for(let t=e.depth;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return!0;return!1}function g(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&"cell"==e.node.type.spec.tableRole)return e.$anchor;const o=m(e.$head)||function(t){for(let e=t.nodeAfter,o=t.pos;e;e=e.firstChild,o++){const n=e.type.spec.tableRole;if("cell"==n||"header_cell"==n)return t.doc.resolve(o)}for(let e=t.nodeBefore,o=t.pos;e;e=e.lastChild,o--){const n=e.type.spec.tableRole;if("cell"==n||"header_cell"==n)return t.doc.resolve(o-e.nodeSize)}}(e.$head);if(o)return o;throw new RangeError(`No cell found around position ${e.head}`)}function b(t){return"row"==t.parent.type.spec.tableRole&&!!t.nodeAfter}function C(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function v(t,e,o){const n=t.node(-1),l=h.get(n),r=t.start(-1),s=l.nextCell(t.pos-r,e,o);return null==s?null:t.node(0).resolve(r+s)}function y(t,e,o=1){const n={...t,colspan:t.colspan-o};return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(e,o),n.colwidth.some((t=>t>0))||(n.colwidth=null)),n}function A(t,e,o=1){const n={...t,colspan:t.colspan+o};if(n.colwidth){n.colwidth=n.colwidth.slice();for(let t=0;t<o;t++)n.colwidth.splice(e,0,0)}return n}var S=class extends s.Y1{constructor(t,e=t){const o=t.node(-1),n=h.get(o),l=t.start(-1),r=n.rectBetween(t.pos-l,e.pos-l),i=t.node(0),a=n.cellsInRect(r).filter((t=>t!=e.pos-l));a.unshift(e.pos-l);const c=a.map((t=>{const e=o.nodeAt(t);if(!e)throw RangeError(`No cell with offset ${t} found`);const n=l+t+1;return new s.xm(i.resolve(n),i.resolve(n+e.content.size))}));super(c[0].$from,c[0].$to,c),this.$anchorCell=t,this.$headCell=e}map(t,e){const o=t.resolve(e.map(this.$anchorCell.pos)),n=t.resolve(e.map(this.$headCell.pos));if(b(o)&&b(n)&&C(o,n)){const t=this.$anchorCell.node(-1)!=o.node(-1);return t&&this.isRowSelection()?S.rowSelection(o,n):t&&this.isColSelection()?S.colSelection(o,n):new S(o,n)}return s.Bs.between(o,n)}content(){const t=this.$anchorCell.node(-1),e=h.get(t),o=this.$anchorCell.start(-1),n=e.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),l={},r=[];for(let o=n.top;o<n.bottom;o++){const s=[];for(let r=o*e.width+n.left,i=n.left;i<n.right;i++,r++){const o=e.map[r];if(l[o])continue;l[o]=!0;const i=e.findCell(o);let a=t.nodeAt(o);if(!a)throw RangeError(`No cell with offset ${o} found`);const c=n.left-i.left,d=i.right-n.right;if(c>0||d>0){let t=a.attrs;if(c>0&&(t=y(t,0,c)),d>0&&(t=y(t,t.colspan-d,d)),i.left<n.left){if(a=a.type.createAndFill(t),!a)throw RangeError(`Could not create cell with attrs ${JSON.stringify(t)}`)}else a=a.type.create(t,a.content)}if(i.top<n.top||i.bottom>n.bottom){const t={...a.attrs,rowspan:Math.min(i.bottom,n.bottom)-Math.max(i.top,n.top)};a=i.top<n.top?a.type.createAndFill(t):a.type.create(t,a.content)}s.push(a)}r.push(t.child(o).copy(i.HY.from(s)))}const s=this.isColSelection()&&this.isRowSelection()?t:r;return new i.p2(i.HY.from(s),1,1)}replace(t,e=i.p2.empty){const o=t.steps.length,n=this.ranges;for(let l=0;l<n.length;l++){const{$from:r,$to:s}=n[l],a=t.mapping.slice(o);t.replace(a.map(r.pos),a.map(s.pos),l?i.p2.empty:e)}const l=s.Y1.findFrom(t.doc.resolve(t.mapping.slice(o).map(this.to)),-1);l&&t.setSelection(l)}replaceWith(t,e){this.replace(t,new i.p2(i.HY.from(e),0,0))}forEachCell(t){const e=this.$anchorCell.node(-1),o=h.get(e),n=this.$anchorCell.start(-1),l=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n));for(let o=0;o<l.length;o++)t(e.nodeAt(l[o]),n+l[o])}isColSelection(){const t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;const o=t+this.$anchorCell.nodeAfter.attrs.rowspan,n=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,n)==this.$headCell.node(-1).childCount}static colSelection(t,e=t){const o=t.node(-1),n=h.get(o),l=t.start(-1),r=n.findCell(t.pos-l),s=n.findCell(e.pos-l),i=t.node(0);return r.top<=s.top?(r.top>0&&(t=i.resolve(l+n.map[r.left])),s.bottom<n.height&&(e=i.resolve(l+n.map[n.width*(n.height-1)+s.right-1]))):(s.top>0&&(e=i.resolve(l+n.map[s.left])),r.bottom<n.height&&(t=i.resolve(l+n.map[n.width*(n.height-1)+r.right-1]))),new S(t,e)}isRowSelection(){const t=this.$anchorCell.node(-1),e=h.get(t),o=this.$anchorCell.start(-1),n=e.colCount(this.$anchorCell.pos-o),l=e.colCount(this.$headCell.pos-o);if(Math.min(n,l)>0)return!1;const r=n+this.$anchorCell.nodeAfter.attrs.colspan,s=l+this.$headCell.nodeAfter.attrs.colspan;return Math.max(r,s)==e.width}eq(t){return t instanceof S&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,e=t){const o=t.node(-1),n=h.get(o),l=t.start(-1),r=n.findCell(t.pos-l),s=n.findCell(e.pos-l),i=t.node(0);return r.left<=s.left?(r.left>0&&(t=i.resolve(l+n.map[r.top*n.width])),s.right<n.width&&(e=i.resolve(l+n.map[n.width*(s.top+1)-1]))):(s.left>0&&(e=i.resolve(l+n.map[s.top*n.width])),r.right<n.width&&(t=i.resolve(l+n.map[n.width*(r.top+1)-1]))),new S(t,e)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,e){return new S(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,o=e){return new S(t.resolve(e),t.resolve(o))}getBookmark(){return new $(this.$anchorCell.pos,this.$headCell.pos)}};S.prototype.visible=!1,s.Y1.jsonID("cell",S);var $=class{constructor(t,e){this.anchor=t,this.head=e}map(t){return new $(t.map(this.anchor),t.map(this.head))}resolve(t){const e=t.resolve(this.anchor),o=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==o.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&o.index()<o.parent.childCount&&C(e,o)?new S(e,o):s.Y1.near(o,1)}};function M(t){if(!(t.selection instanceof S))return null;const e=[];return t.selection.forEachCell(((t,o)=>{e.push(a.p.node(o,o+t.nodeSize,{class:"selectedCell"}))})),a.EH.create(t.doc,e)}var R=new s.H$("fix-tables");function N(t,e,o,n){const l=t.childCount,r=e.childCount;t:for(let s=0,i=0;s<r;s++){const r=e.child(s);for(let e=i,n=Math.min(l,s+3);e<n;e++)if(t.child(e)==r){i=e+1,o+=r.nodeSize;continue t}n(r,o),i<l&&t.child(i).sameMarkup(r)?N(t.child(i),r,o+1,n):r.nodesBetween(0,r.content.size,n,o+1),o+=r.nodeSize}}function E(t,e){let o;const n=(e,n)=>{"table"==e.type.spec.tableRole&&(o=function(t,e,o,n){const l=h.get(e);if(!l.problems)return n;n||(n=t.tr);const r=[];for(let t=0;t<l.height;t++)r.push(0);for(let t=0;t<l.problems.length;t++){const s=l.problems[t];if("collision"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;const l=t.attrs;for(let t=0;t<l.rowspan;t++)r[s.row+t]+=s.n;n.setNodeMarkup(n.mapping.map(o+1+s.pos),null,y(l,l.colspan-s.n,s.n))}else if("missing"==s.type)r[s.row]+=s.n;else if("overlong_rowspan"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;n.setNodeMarkup(n.mapping.map(o+1+s.pos),null,{...t.attrs,rowspan:t.attrs.rowspan-s.n})}else if("colwidth mismatch"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;n.setNodeMarkup(n.mapping.map(o+1+s.pos),null,{...t.attrs,colwidth:s.colwidth})}}let s,i;for(let t=0;t<r.length;t++)r[t]&&(null==s&&(s=t),i=t);for(let a=0,c=o+1;a<l.height;a++){const o=e.child(a),l=c+o.nodeSize,d=r[a];if(d>0){let e="cell";o.firstChild&&(e=o.firstChild.type.spec.tableRole);const r=[];for(let o=0;o<d;o++){const o=u(t.schema)[e].createAndFill();o&&r.push(o)}const h=0!=a&&s!=a-1||i!=a?l-1:c+1;n.insert(n.mapping.map(h),r)}c=l}return n.setMeta(R,{fixTables:!0})}(t,e,n,o))};return e?e.doc!=t.doc&&N(e.doc,t.doc,0,n):t.doc.descendants(n),o}function H(t){if(!t.size)return null;let{content:e,openStart:o,openEnd:n}=t;for(;1==e.childCount&&(o>0&&n>0||"table"==e.child(0).type.spec.tableRole);)o--,n--,e=e.child(0).content;const l=e.child(0),r=l.type.spec.tableRole,s=l.type.schema,a=[];if("row"==r)for(let t=0;t<e.childCount;t++){let l=e.child(t).content;const r=t?0:Math.max(0,o-1),c=t<e.childCount-1?0:Math.max(0,n-1);(r||c)&&(l=x(u(s).row,new i.p2(l,r,c)).content),a.push(l)}else{if("cell"!=r&&"header_cell"!=r)return null;a.push(o||n?x(u(s).row,new i.p2(e,o,n)).content:e)}return function(t,e){const o=[];for(let t=0;t<e.length;t++){const n=e[t];for(let e=n.childCount-1;e>=0;e--){const{rowspan:l,colspan:r}=n.child(e).attrs;for(let e=t;e<t+l;e++)o[e]=(o[e]||0)+r}}let n=0;for(let t=0;t<o.length;t++)n=Math.max(n,o[t]);for(let l=0;l<o.length;l++)if(l>=e.length&&e.push(i.HY.empty),o[l]<n){const r=u(t).cell.createAndFill(),s=[];for(let t=o[l];t<n;t++)s.push(r);e[l]=e[l].append(i.HY.from(s))}return{height:e.length,width:n,rows:e}}(s,a)}function x(t,e){const o=t.createAndFill();return new d.wx(o).replace(0,o.content.size,e).doc}function z(t,e,o,n,l,r,s,i){if(0==s||s==e.height)return!1;let a=!1;for(let c=l;c<r;c++){const l=s*e.width+c,r=e.map[l];if(e.map[l-e.width]==r){a=!0;const l=o.nodeAt(r),{top:d,left:h}=e.findCell(r);t.setNodeMarkup(t.mapping.slice(i).map(r+n),null,{...l.attrs,rowspan:s-d}),t.insert(t.mapping.slice(i).map(e.positionAt(s,h,o)),l.type.createAndFill({...l.attrs,rowspan:d+l.attrs.rowspan-s})),c+=l.attrs.colspan-1}}return a}function k(t,e,o,n,l,r,s,i){if(0==s||s==e.width)return!1;let a=!1;for(let c=l;c<r;c++){const l=c*e.width+s,r=e.map[l];if(e.map[l-1]==r){a=!0;const l=o.nodeAt(r),d=e.colCount(r),h=t.mapping.slice(i).map(r+n);t.setNodeMarkup(h,null,y(l.attrs,s-d,l.attrs.colspan-(s-d))),t.insert(h+l.nodeSize,l.type.createAndFill(y(l.attrs,0,s-d))),c+=l.attrs.rowspan-1}}return a}function T(t,e,o,n,l){let r=o?t.doc.nodeAt(o-1):t.doc;if(!r)throw new Error("No table found");let s=h.get(r);const{top:a,left:c}=n,d=c+l.width,p=a+l.height,f=t.tr;let m=0;function w(){if(r=o?f.doc.nodeAt(o-1):f.doc,!r)throw new Error("No table found");s=h.get(r),m=f.mapping.maps.length}(function(t,e,o,n,l,r,s){const a=u(t.doc.type.schema);let c,d;if(l>e.width)for(let r=0,i=0;r<e.height;r++){const h=o.child(r);i+=h.nodeSize;const p=[];let u;u=null==h.lastChild||h.lastChild.type==a.cell?c||(c=a.cell.createAndFill()):d||(d=a.header_cell.createAndFill());for(let t=e.width;t<l;t++)p.push(u);t.insert(t.mapping.slice(s).map(i-1+n),p)}if(r>e.height){const h=[];for(let t=0,n=(e.height-1)*e.width;t<Math.max(e.width,l);t++){const l=!(t>=e.width)&&o.nodeAt(e.map[n+t]).type==a.header_cell;h.push(l?d||(d=a.header_cell.createAndFill()):c||(c=a.cell.createAndFill()))}const p=a.row.create(null,i.HY.from(h)),u=[];for(let t=e.height;t<r;t++)u.push(p);t.insert(t.mapping.slice(s).map(n+o.nodeSize-2),u)}return!(!c&&!d)})(f,s,r,o,d,p,m)&&w(),z(f,s,r,o,c,d,a,m)&&w(),z(f,s,r,o,c,d,p,m)&&w(),k(f,s,r,o,a,p,c,m)&&w(),k(f,s,r,o,a,p,d,m)&&w();for(let t=a;t<p;t++){const e=s.positionAt(t,c,r),n=s.positionAt(t,d,r);f.replace(f.mapping.slice(m).map(e+o),f.mapping.slice(m).map(n+o),new i.p2(l.rows[t-a],0,0))}w(),f.setSelection(new S(f.doc.resolve(o+s.positionAt(a,c,r)),f.doc.resolve(o+s.positionAt(p-1,d-1,r)))),e(f)}var L=(0,c.$)({ArrowLeft:D("horiz",-1),ArrowRight:D("horiz",1),ArrowUp:D("vert",-1),ArrowDown:D("vert",1),"Shift-ArrowLeft":W("horiz",-1),"Shift-ArrowRight":W("horiz",1),"Shift-ArrowUp":W("vert",-1),"Shift-ArrowDown":W("vert",1),Backspace:_,"Mod-Backspace":_,Delete:_,"Mod-Delete":_});function B(t,e,o){return!o.eq(t.selection)&&(e&&e(t.tr.setSelection(o).scrollIntoView()),!0)}function D(t,e){return(o,n,l)=>{if(!l)return!1;const r=o.selection;if(r instanceof S)return B(o,n,s.Y1.near(r.$headCell,e));if("horiz"!=t&&!r.empty)return!1;const i=I(l,t,e);if(null==i)return!1;if("horiz"==t)return B(o,n,s.Y1.near(o.doc.resolve(r.head+e),e));{const l=o.doc.resolve(i),r=v(l,t,e);let a;return a=r?s.Y1.near(r,1):e<0?s.Y1.near(o.doc.resolve(l.before(-1)),-1):s.Y1.near(o.doc.resolve(l.after(-1)),1),B(o,n,a)}}}function W(t,e){return(o,n,l)=>{if(!l)return!1;const r=o.selection;let s;if(r instanceof S)s=r;else{const n=I(l,t,e);if(null==n)return!1;s=new S(o.doc.resolve(n))}const i=v(s.$headCell,t,e);return!!i&&B(o,n,new S(s.$anchorCell,i))}}function _(t,e){const o=t.selection;if(!(o instanceof S))return!1;if(e){const n=t.tr,l=u(t.schema).cell.createAndFill().content;o.forEachCell(((t,e)=>{t.content.eq(l)||n.replace(n.mapping.map(e+1),n.mapping.map(e+t.nodeSize-1),new i.p2(l,0,0))})),n.docChanged&&e(n)}return!0}function Y(t,e){const o=m(t.state.doc.resolve(e));return!!o&&(t.dispatch(t.state.tr.setSelection(new S(o))),!0)}function F(t,e,o){if(!w(t.state))return!1;let n=H(o);const l=t.state.selection;if(l instanceof S){n||(n={width:1,height:1,rows:[i.HY.from(x(u(t.state.schema).cell,o))]});const e=l.$anchorCell.node(-1),r=l.$anchorCell.start(-1),s=h.get(e).rectBetween(l.$anchorCell.pos-r,l.$headCell.pos-r);return n=function({width:t,height:e,rows:o},n,l){if(t!=n){const e=[],l=[];for(let t=0;t<o.length;t++){const r=o[t],s=[];for(let o=e[t]||0,l=0;o<n;l++){let i=r.child(l%r.childCount);o+i.attrs.colspan>n&&(i=i.type.createChecked(y(i.attrs,i.attrs.colspan,o+i.attrs.colspan-n),i.content)),s.push(i),o+=i.attrs.colspan;for(let o=1;o<i.attrs.rowspan;o++)e[t+o]=(e[t+o]||0)+i.attrs.colspan}l.push(i.HY.from(s))}o=l,t=n}if(e!=l){const t=[];for(let n=0,r=0;n<l;n++,r++){const s=[],a=o[r%e];for(let t=0;t<a.childCount;t++){let e=a.child(t);n+e.attrs.rowspan>l&&(e=e.type.create({...e.attrs,rowspan:Math.max(1,l-e.attrs.rowspan)},e.content)),s.push(e)}t.push(i.HY.from(s))}o=t,e=l}return{width:t,height:e,rows:o}}(n,s.right-s.left,s.bottom-s.top),T(t.state,t.dispatch,r,s,n),!0}if(n){const e=g(t.state),o=e.start(-1);return T(t.state,t.dispatch,o,h.get(e.node(-1)).findCell(e.pos-o),n),!0}return!1}function O(t,e){var o;if(e.ctrlKey||e.metaKey)return;const n=P(t,e.target);let l;if(e.shiftKey&&t.state.selection instanceof S)r(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&null!=(l=m(t.state.selection.$anchor))&&(null==(o=V(t,e))?void 0:o.pos)!=l.pos)r(l,e),e.preventDefault();else if(!n)return;function r(e,o){let n=V(t,o);const l=null==f.getState(t.state);if(!n||!C(e,n)){if(!l)return;n=e}const r=new S(e,n);if(l||!t.state.selection.eq(r)){const o=t.state.tr.setSelection(r);l&&o.setMeta(f,e.pos),t.dispatch(o)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",i),null!=f.getState(t.state)&&t.dispatch(t.state.tr.setMeta(f,-1))}function i(o){const l=o,i=f.getState(t.state);let a;if(null!=i)a=t.state.doc.resolve(i);else if(P(t,l.target)!=n&&(a=V(t,e),!a))return s();a&&r(a,l)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",i)}function I(t,e,o){if(!(t.state.selection instanceof s.Bs))return null;const{$head:n}=t.state.selection;for(let l=n.depth-1;l>=0;l--){const r=n.node(l);if((o<0?n.index(l):n.indexAfter(l))!=(o<0?0:r.childCount))return null;if("cell"==r.type.spec.tableRole||"header_cell"==r.type.spec.tableRole){const r=n.before(l),s="vert"==e?o>0?"down":"up":o>0?"right":"left";return t.endOfTextblock(s)?r:null}}return null}function P(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function V(t,e){const o=t.posAtCoords({left:e.clientX,top:e.clientY});return o&&o?m(t.state.doc.resolve(o.pos)):null}var X=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),K(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type==this.node.type&&(this.node=t,K(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))}};function K(t,e,o,n,l,r){var s;let i=0,a=!0,c=e.firstChild;const d=t.firstChild;if(d){for(let t=0,o=0;t<d.childCount;t++){const{colspan:s,colwidth:h}=d.child(t).attrs;for(let t=0;t<s;t++,o++){const s=l==o?r:h&&h[t],d=s?s+"px":"";i+=s||n,s||(a=!1),c?(c.style.width!=d&&(c.style.width=d),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=d}}for(;c;){const t=c.nextSibling;null==(s=c.parentNode)||s.removeChild(c),c=t}a?(o.style.width=i+"px",o.style.minWidth=""):(o.style.width="",o.style.minWidth=i+"px")}}var q=new s.H$("tableColumnResizing");function J({handleWidth:t=5,cellMinWidth:e=25,View:o=X,lastColumnResizable:n=!0}={}){const l=new s.Sy({key:q,state:{init(t,n){return l.spec.props.nodeViews[u(n.schema).table.name]=(t,n)=>new o(t,e,n),new j(-1,!1)},apply(t,e){return e.apply(t)}},props:{attributes:t=>{const e=q.getState(t);return e&&e.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(e,o)=>{!function(t,e,o,n,l){const r=q.getState(t.state);if(!r)return;if(!r.dragging){const n=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target);let s=-1;if(n){const{left:l,right:r}=n.getBoundingClientRect();e.clientX-l<=o?s=U(t,e,"left"):r-e.clientX<=o&&(s=U(t,e,"right"))}if(s!=r.activeHandle){if(!l&&-1!==s){const e=t.state.doc.resolve(s),o=e.node(-1),n=h.get(o),l=e.start(-1);if(n.colCount(e.pos-l)+e.nodeAfter.attrs.colspan-1==n.width-1)return}Q(t,s)}}}(e,o,t,0,n)},mouseleave:t=>{!function(t){const e=q.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&Q(t,-1)}(t)},mousedown:(t,o)=>{!function(t,e,o){const n=q.getState(t.state);if(!n||-1==n.activeHandle||n.dragging)return!1;const l=t.state.doc.nodeAt(n.activeHandle),r=function(t,e,{colspan:o,colwidth:n}){const l=n&&n[n.length-1];if(l)return l;const r=t.domAtPos(e);let s=r.node.childNodes[r.offset].offsetWidth,i=o;if(n)for(let t=0;t<o;t++)n[t]&&(s-=n[t],i--);return s/i}(t,n.activeHandle,l.attrs);function s(e){window.removeEventListener("mouseup",s),window.removeEventListener("mousemove",i);const n=q.getState(t.state);(null==n?void 0:n.dragging)&&(!function(t,e,o){const n=t.state.doc.resolve(e),l=n.node(-1),r=h.get(l),s=n.start(-1),i=r.colCount(n.pos-s)+n.nodeAfter.attrs.colspan-1,a=t.state.tr;for(let t=0;t<r.height;t++){const e=t*r.width+i;if(t&&r.map[e]==r.map[e-r.width])continue;const n=r.map[e],c=l.nodeAt(n).attrs,d=1==c.colspan?0:i-r.colCount(n);if(c.colwidth&&c.colwidth[d]==o)continue;const h=c.colwidth?c.colwidth.slice():Z(c.colspan);h[d]=o,a.setNodeMarkup(s+n,null,{...c,colwidth:h})}a.docChanged&&t.dispatch(a)}(t,n.activeHandle,G(n.dragging,e,o)),t.dispatch(t.state.tr.setMeta(q,{setDragging:null})))}function i(e){if(!e.which)return s(e);const n=q.getState(t.state);if(n&&n.dragging){const l=G(n.dragging,e,o);!function(t,e,o,n){const l=t.state.doc.resolve(e),r=l.node(-1),s=l.start(-1),i=h.get(r).colCount(l.pos-s)+l.nodeAfter.attrs.colspan-1;let a=t.domAtPos(l.start(-1)).node;for(;a&&"TABLE"!=a.nodeName;)a=a.parentNode;if(!a)return;K(r,a.firstChild,a,n,i,o)}(t,n.activeHandle,l,o)}}t.dispatch(t.state.tr.setMeta(q,{setDragging:{startX:e.clientX,startWidth:r}})),window.addEventListener("mouseup",s),window.addEventListener("mousemove",i),e.preventDefault()}(t,o,e)}},decorations:t=>{const e=q.getState(t);if(e&&e.activeHandle>-1)return function(t,e){const o=[],n=t.doc.resolve(e),l=n.node(-1);if(!l)return a.EH.empty;const r=h.get(l),s=n.start(-1),i=r.colCount(n.pos-s)+n.nodeAfter.attrs.colspan;for(let t=0;t<r.height;t++){const e=i+t*r.width-1;if(!(i!=r.width&&r.map[e]==r.map[e+1]||0!=t&&r.map[e-1]==r.map[e-1-r.width])){const t=r.map[e],n=s+t+l.nodeAt(t).nodeSize-1,i=document.createElement("div");i.className="column-resize-handle",o.push(a.p.widget(n,i))}}return a.EH.create(t.doc,o)}(t,e.activeHandle)},nodeViews:{}}});return l}var j=class{constructor(t,e){this.activeHandle=t,this.dragging=e}apply(t){const e=this,o=t.getMeta(q);if(o&&null!=o.setHandle)return new j(o.setHandle,!1);if(o&&void 0!==o.setDragging)return new j(e.activeHandle,o.setDragging);if(e.activeHandle>-1&&t.docChanged){let o=t.mapping.map(e.activeHandle,-1);return b(t.doc.resolve(o))||(o=-1),new j(o,e.dragging)}return e}};function U(t,e,o){const n=t.posAtCoords({left:e.clientX,top:e.clientY});if(!n)return-1;const{pos:l}=n,r=m(t.state.doc.resolve(l));if(!r)return-1;if("right"==o)return r.pos;const s=h.get(r.node(-1)),i=r.start(-1),a=s.map.indexOf(r.pos-i);return a%s.width==0?-1:i+s.map[a-1]}function G(t,e,o){const n=e.clientX-t.startX;return Math.max(o,t.startWidth+n)}function Q(t,e){t.dispatch(t.state.tr.setMeta(q,{setHandle:e}))}function Z(t){return Array(t).fill(0)}function tt(t){const e=t.selection,o=g(t),n=o.node(-1),l=o.start(-1),r=h.get(n);return{...e instanceof S?r.rectBetween(e.$anchorCell.pos-l,e.$headCell.pos-l):r.findCell(o.pos-l),tableStart:l,map:r,table:n}}function et(t,{map:e,tableStart:o,table:n},l){let r=l>0?-1:0;(function(t,e,o){const n=u(e.type.schema).header_cell;for(let l=0;l<t.height;l++)if(e.nodeAt(t.map[o+l*t.width]).type!=n)return!1;return!0})(e,n,l+r)&&(r=0==l||l==e.width?null:0);for(let s=0;s<e.height;s++){const i=s*e.width+l;if(l>0&&l<e.width&&e.map[i-1]==e.map[i]){const r=e.map[i],a=n.nodeAt(r);t.setNodeMarkup(t.mapping.map(o+r),null,A(a.attrs,l-e.colCount(r))),s+=a.attrs.rowspan-1}else{const a=null==r?u(n.type.schema).cell:n.nodeAt(e.map[i+r]).type,c=e.positionAt(s,l,n);t.insert(t.mapping.map(o+c),a.createAndFill())}}return t}function ot(t,{map:e,table:o,tableStart:n},l){const r=t.mapping.maps.length;for(let s=0;s<e.height;){const i=s*e.width+l,a=e.map[i],c=o.nodeAt(a),d=c.attrs;if(l>0&&e.map[i-1]==a||l<e.width-1&&e.map[i+1]==a)t.setNodeMarkup(t.mapping.slice(r).map(n+a),null,y(d,l-e.colCount(a)));else{const e=t.mapping.slice(r).map(n+a);t.delete(e,e+c.nodeSize)}s+=d.rowspan}}function nt(t,{map:e,tableStart:o,table:n},l){var r;let s=o;for(let t=0;t<l;t++)s+=n.child(t).nodeSize;const i=[];let a=l>0?-1:0;(function(t,e,o){var n;const l=u(e.type.schema).header_cell;for(let r=0;r<t.width;r++)if((null==(n=e.nodeAt(t.map[r+o*t.width]))?void 0:n.type)!=l)return!1;return!0})(e,n,l+a)&&(a=0==l||l==e.height?null:0);for(let s=0,c=e.width*l;s<e.width;s++,c++)if(l>0&&l<e.height&&e.map[c]==e.map[c-e.width]){const l=e.map[c],r=n.nodeAt(l).attrs;t.setNodeMarkup(o+l,null,{...r,rowspan:r.rowspan+1}),s+=r.colspan-1}else{const t=null==a?u(n.type.schema).cell:null==(r=n.nodeAt(e.map[c+a*e.width]))?void 0:r.type,o=null==t?void 0:t.createAndFill();o&&i.push(o)}return t.insert(s,u(n.type.schema).row.create(null,i)),t}function lt(t,{map:e,table:o,tableStart:n},l){let r=0;for(let t=0;t<l;t++)r+=o.child(t).nodeSize;const s=r+o.child(l).nodeSize,i=t.mapping.maps.length;t.delete(r+n,s+n);for(let r=0,s=l*e.width;r<e.width;r++,s++){const a=e.map[s];if(l>0&&a==e.map[s-e.width]){const e=o.nodeAt(a).attrs;t.setNodeMarkup(t.mapping.slice(i).map(a+n),null,{...e,rowspan:e.rowspan-1}),r+=e.colspan-1}else if(l<e.width&&a==e.map[s+e.width]){const s=o.nodeAt(a),c=s.attrs,d=s.type.create({...c,rowspan:s.attrs.rowspan-1},s.content),h=e.positionAt(l+1,r,o);t.insert(t.mapping.slice(i).map(n+h),d),r+=c.colspan-1}}}function rt(t){const e=t.content;return 1==e.childCount&&e.child(0).isTextblock&&0==e.child(0).childCount}function st(t,e){const o=t.selection;if(!(o instanceof S)||o.$anchorCell.pos==o.$headCell.pos)return!1;const n=tt(t),{map:l}=n;if(function({width:t,height:e,map:o},n){let l=n.top*t+n.left,r=l,s=(n.bottom-1)*t+n.left,i=l+(n.right-n.left-1);for(let e=n.top;e<n.bottom;e++){if(n.left>0&&o[r]==o[r-1]||n.right<t&&o[i]==o[i+1])return!0;r+=t,i+=t}for(let r=n.left;r<n.right;r++){if(n.top>0&&o[l]==o[l-t]||n.bottom<e&&o[s]==o[s+t])return!0;l++,s++}return!1}(l,n))return!1;if(e){const o=t.tr,r={};let s,a,c=i.HY.empty;for(let t=n.top;t<n.bottom;t++)for(let e=n.left;e<n.right;e++){const i=l.map[t*l.width+e],d=n.table.nodeAt(i);if(!r[i]&&d)if(r[i]=!0,null==s)s=i,a=d;else{rt(d)||(c=c.append(d.content));const t=o.mapping.map(i+n.tableStart);o.delete(t,t+d.nodeSize)}}if(null==s||null==a)return!0;if(o.setNodeMarkup(s+n.tableStart,null,{...A(a.attrs,a.attrs.colspan,n.right-n.left-a.attrs.colspan),rowspan:n.bottom-n.top}),c.size){const t=s+1+a.content.size,e=rt(a)?s+1:t;o.replaceWith(e+n.tableStart,t+n.tableStart,c)}o.setSelection(new S(o.doc.resolve(s+n.tableStart))),e(o)}return!0}function it(t,e){const o=u(t.schema);return(n=({node:t})=>o[t.type.spec.tableRole],(t,e)=>{var o;const l=t.selection;let r,s;if(l instanceof S){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,s=l.$anchorCell.pos}else{if(r=function(t){for(let e=t.depth;e>0;e--){const o=t.node(e).type.spec.tableRole;if("cell"===o||"header_cell"===o)return t.node(e)}return null}(l.$from),!r)return!1;s=null==(o=m(l.$from))?void 0:o.pos}if(null==r||null==s)return!1;if(1==r.attrs.colspan&&1==r.attrs.rowspan)return!1;if(e){let o=r.attrs;const i=[],a=o.colwidth;o.rowspan>1&&(o={...o,rowspan:1}),o.colspan>1&&(o={...o,colspan:1});const c=tt(t),d=t.tr;for(let t=0;t<c.right-c.left;t++)i.push(a?{...o,colwidth:a&&a[t]?[a[t]]:null}:o);let h;for(let t=c.top;t<c.bottom;t++){let e=c.map.positionAt(t,c.left,c.table);t==c.top&&(e+=r.nodeSize);for(let o=c.left,l=0;o<c.right;o++,l++)o==c.left&&t==c.top||d.insert(h=d.mapping.map(e+c.tableStart,1),n({node:r,row:t,col:o}).createAndFill(i[l]))}d.setNodeMarkup(s,n({node:r,row:c.top,col:c.left}),i[0]),l instanceof S&&d.setSelection(new S(d.doc.resolve(l.$anchorCell.pos),h?d.doc.resolve(h):void 0)),e(d)}return!0})(t,e);var n}function at(t,e,o){const n=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1});for(let t=0;t<n.length;t++){const l=e.table.nodeAt(n[t]);if(l&&l.type!==o.header_cell)return!1}return!0}function ct(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,o){if(!w(e))return!1;if(o){const n=u(e.schema),l=tt(e),r=e.tr,s=l.map.cellsInRect("column"==t?{left:l.left,top:0,right:l.right,bottom:l.map.height}:"row"==t?{left:0,top:l.top,right:l.map.width,bottom:l.bottom}:l),i=s.map((t=>l.table.nodeAt(t)));for(let t=0;t<s.length;t++)i[t].type==n.header_cell&&r.setNodeMarkup(l.tableStart+s[t],n.cell,i[t].attrs);if(0==r.steps.length)for(let t=0;t<s.length;t++)r.setNodeMarkup(l.tableStart+s[t],n.header_cell,i[t].attrs);o(r)}return!0}}(t):function(e,o){if(!w(e))return!1;if(o){const n=u(e.schema),l=tt(e),r=e.tr,s=at("row",l,n),i=at("column",l,n),a=("column"===t?s:"row"===t&&i)?1:0,c="column"==t?{left:0,top:a,right:1,bottom:l.map.height}:"row"==t?{left:a,top:0,right:l.map.width,bottom:1}:l,d="column"==t?i?n.cell:n.header_cell:"row"==t?s?n.cell:n.header_cell:n.cell;l.map.cellsInRect(c).forEach((t=>{const e=t+l.tableStart,o=r.doc.nodeAt(e);o&&r.setNodeMarkup(e,d,o.attrs)})),o(r)}return!0}}ct("row",{useDeprecatedLogic:!0}),ct("column",{useDeprecatedLogic:!0});var dt=ct("cell",{useDeprecatedLogic:!0});function ht(t){return function(e,o){if(!w(e))return!1;const n=function(t,e){if(e<0){const e=t.nodeBefore;if(e)return t.pos-e.nodeSize;for(let e=t.index(-1)-1,o=t.before();e>=0;e--){const n=t.node(-1).child(e),l=n.lastChild;if(l)return o-1-l.nodeSize;o-=n.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const e=t.node(-1);for(let o=t.indexAfter(-1),n=t.after();o<e.childCount;o++){const t=e.child(o);if(t.childCount)return n+1;n+=t.nodeSize}}return null}(g(e),t);if(null==n)return!1;if(o){const t=e.doc.resolve(n);o(e.tr.setSelection(s.Bs.between(t,(l=t,l.node(0).resolve(l.pos+l.nodeAfter.nodeSize)))).scrollIntoView())}var l;return!0}}function pt({allowTableNodeSelection:t=!1}={}){return new s.Sy({key:f,state:{init(){return null},apply(t,e){const o=t.getMeta(f);if(null!=o)return-1==o?null:o;if(null==e||!t.docChanged)return e;const{deleted:n,pos:l}=t.mapping.mapResult(e);return n?null:l}},props:{decorations:M,handleDOMEvents:{mousedown:O},createSelectionBetween(t){return null!=f.getState(t.state)?t.state.selection:null},handleTripleClick:Y,handleKeyDown:L,handlePaste:F},appendTransaction(e,o,n){return function(t,e,o){const n=(e||t).selection,l=(e||t).doc;let r,i;if(n instanceof s.qv&&(i=n.node.type.spec.tableRole)){if("cell"==i||"header_cell"==i)r=S.create(l,n.from);else if("row"==i){const t=l.resolve(n.from+1);r=S.rowSelection(t,t)}else if(!o){const t=h.get(n.node),e=n.from+1,o=e+t.map[t.width*t.height-1];r=S.create(l,e+1,o)}}else n instanceof s.Bs&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let o=t.pos,n=e.pos,l=t.depth;for(;l>=0&&!(t.after(l+1)<t.end(l));l--,o++);for(let t=e.depth;t>=0&&!(e.before(t+1)>e.start(t));t--,n--);return o==n&&/row|table/.test(t.node(l).type.spec.tableRole)}(n)?r=s.Bs.create(l,n.from):n instanceof s.Bs&&function({$from:t,$to:e}){let o,n;for(let e=t.depth;e>0;e--){const n=t.node(e);if("cell"===n.type.spec.tableRole||"header_cell"===n.type.spec.tableRole){o=n;break}}for(let t=e.depth;t>0;t--){const o=e.node(t);if("cell"===o.type.spec.tableRole||"header_cell"===o.type.spec.tableRole){n=o;break}}return o!==n&&0===e.parentOffset}(n)&&(r=s.Bs.create(l,n.$from.start(),n.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}(n,E(n,o),t)}})}function ut(t,e,o,n,l,r){let s=0,i=!0,a=e.firstChild;const c=t.firstChild;for(let t=0,o=0;t<c.childCount;t+=1){const{colspan:d,colwidth:h}=c.child(t).attrs;for(let t=0;t<d;t+=1,o+=1){const c=l===o?r:h&&h[t],d=c?`${c}px`:"";s+=c||n,c||(i=!1),a?(a.style.width!==d&&(a.style.width=d),a=a.nextSibling):e.appendChild(document.createElement("col")).style.width=d}}for(;a;){const t=a.nextSibling;a.parentNode.removeChild(a),a=t}i?(o.style.width=`${s}px`,o.style.minWidth=""):(o.style.width="",o.style.minWidth=`${s}px`)}class ft{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ut(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type===this.node.type&&(this.node=t,ut(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"===t.type&&(t.target===this.table||this.colgroup.contains(t.target))}}function mt(t,e){return e?t.createChecked(null,e):t.createAndFill()}function wt(t,e,o,n,l){const r=function(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach((o=>{const n=t.nodes[o];n.spec.tableRole&&(e[n.spec.tableRole]=n)})),t.cached.tableNodeTypes=e,e}(t),s=[],i=[];for(let t=0;t<o;t+=1){const t=mt(r.cell,l);if(t&&i.push(t),n){const t=mt(r.header_cell,l);t&&s.push(t)}}const a=[];for(let t=0;t<e;t+=1)a.push(r.row.createChecked(null,n&&0===t?s:i));return r.table.createChecked(null,a)}const gt=({editor:t})=>{const{selection:e}=t.state;if(!(e instanceof S))return!1;let o=0;const n=(0,r.findParentNodeClosestToPos)(e.ranges[0].$from,(t=>"table"===t.type.name));null==n||n.node.descendants((t=>{if("table"===t.type.name)return!1;["tableCell","tableHeader"].includes(t.type.name)&&(o+=1)}));return o===e.ranges.length&&(t.commands.deleteTable(),!0)},bt=r.Node.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:ft,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:t}){return["table",(0,r.mergeAttributes)(this.options.HTMLAttributes,t),["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:o=!0}={})=>({tr:n,dispatch:l,editor:r})=>{const i=wt(r.schema,t,e,o);if(l){const t=n.selection.anchor+1;n.replaceSelectionWith(i).scrollIntoView().setSelection(s.Bs.near(n.doc.resolve(t)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>function(t,e){if(!w(t))return!1;if(e){const o=tt(t);e(et(t.tr,o,o.left))}return!0}(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>function(t,e){if(!w(t))return!1;if(e){const o=tt(t);e(et(t.tr,o,o.right))}return!0}(t,e),deleteColumn:()=>({state:t,dispatch:e})=>function(t,e){if(!w(t))return!1;if(e){const o=tt(t),n=t.tr;if(0==o.left&&o.right==o.map.width)return!1;for(let t=o.right-1;ot(n,o,t),t!=o.left;t--){const t=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!t)throw RangeError("No table found");o.table=t,o.map=h.get(t)}e(n)}return!0}(t,e),addRowBefore:()=>({state:t,dispatch:e})=>function(t,e){if(!w(t))return!1;if(e){const o=tt(t);e(nt(t.tr,o,o.top))}return!0}(t,e),addRowAfter:()=>({state:t,dispatch:e})=>function(t,e){if(!w(t))return!1;if(e){const o=tt(t);e(nt(t.tr,o,o.bottom))}return!0}(t,e),deleteRow:()=>({state:t,dispatch:e})=>function(t,e){if(!w(t))return!1;if(e){const o=tt(t),n=t.tr;if(0==o.top&&o.bottom==o.map.height)return!1;for(let t=o.bottom-1;lt(n,o,t),t!=o.top;t--){const t=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!t)throw RangeError("No table found");o.table=t,o.map=h.get(o.table)}e(n)}return!0}(t,e),deleteTable:()=>({state:t,dispatch:e})=>function(t,e){const o=t.selection.$anchor;for(let n=o.depth;n>0;n--)if("table"==o.node(n).type.spec.tableRole)return e&&e(t.tr.delete(o.before(n),o.after(n)).scrollIntoView()),!0;return!1}(t,e),mergeCells:()=>({state:t,dispatch:e})=>st(t,e),splitCell:()=>({state:t,dispatch:e})=>it(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>ct("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>ct("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>dt(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>!!st(t,e)||it(t,e),setCellAttribute:(t,e)=>({state:o,dispatch:n})=>function(t,e){return function(o,n){if(!w(o))return!1;const l=g(o);if(l.nodeAfter.attrs[t]===e)return!1;if(n){const r=o.tr;o.selection instanceof S?o.selection.forEachCell(((o,n)=>{o.attrs[t]!==e&&r.setNodeMarkup(n,null,{...o.attrs,[t]:e})})):r.setNodeMarkup(l.pos,null,{...l.nodeAfter.attrs,[t]:e}),n(r)}return!0}}(t,e)(o,n),goToNextCell:()=>({state:t,dispatch:e})=>ht(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>ht(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&E(t),!0),setCellSelection:t=>({tr:e,dispatch:o})=>{if(o){const o=S.create(e.doc,t.anchorCell,t.headCell);e.setSelection(o)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:gt,"Mod-Backspace":gt,Delete:gt,"Mod-Delete":gt}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[J({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],pt({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:(0,r.callOrReturn)((0,r.getExtensionField)(t,"tableRole",e))}}}),Ct=()=>bt.extend({parseHTML(){return[{tag:"table",getAttrs:t=>null===t.closest("div.scroll-table")&&null},{tag:"div",getAttrs:t=>null!==t.matches(".scroll-table").getElementsByTagName("table")&&null}]},renderHTML(t){let{HTMLAttributes:e}=t;return["div",{class:"scroll-table"},["table",(0,r.mergeAttributes)(this.options.HTMLAttributes,e),0]]}})}}]);
//# sourceMappingURL=17716.5aaae7ad6e1d415132df.min.js.map