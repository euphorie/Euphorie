"use strict";(self.webpackChunkoira_prototype=self.webpackChunkoira_prototype||[]).push([[4626],{34626:function(e,t,n){n.r(t),n.d(t,{Tag:function(){return i},TagPluginKey:function(){return a}});var r=n(26798),o=n(76893);const a=new(n(76922).H$)("tag"),i=o.pf.extend({name:"tag",addOptions(){return{...this.parent?.(),suggestion:{...this.parent?.()?.suggestion,pluginKey:a,char:"#"},url_scheme:null}},addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},href:{default:null,parseHTML:e=>e.getAttribute("href"),renderHTML:e=>e.id?{href:this.options.url_scheme.replace("{TAG}",e.id)}:{}}}},parseHTML:()=>[{tag:"a[data-tag]"}],renderHTML({node:e,HTMLAttributes:t}){return["a",(0,r.mergeAttributes)({"data-tag":""},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]}});t.default=i},76893:function(e,t,n){n.d(t,{pf:function(){return l}});var r=n(26798),o=n(76922),a=n(98780);const i=new o.H$("suggestion");function s({pluginKey:e=i,editor:t,char:n="@",allowSpaces:s=!1,prefixSpace:d=!0,startOfLine:l=!1,decorationTag:u="span",decorationClass:c="suggestion",command:p=(()=>null),items:g=(()=>[]),render:h=(()=>({})),allow:m=(()=>!0)}){let v;const f=null==h?void 0:h();return new o.Sy({key:e,view(){return{update:async(e,n)=>{var r,o,a,i,s;const d=null===(r=this.key)||void 0===r?void 0:r.getState(n),l=null===(o=this.key)||void 0===o?void 0:o.getState(e.state),u=d.active&&l.active&&d.range.from!==l.range.from,c=!d.active&&l.active,h=d.active&&!l.active,m=c||u,y=!c&&!h&&d.query!==l.query&&!u,b=h||u;if(!m&&!y&&!b)return;const x=b&&!m?d:l,w=document.querySelector(`[data-decoration-id="${x.decorationId}"]`);v={editor:t,range:x.range,query:x.query,text:x.text,items:y||m?await g({editor:t,query:x.query}):[],command:e=>{p({editor:t,range:x.range,props:e})},decorationNode:w,clientRect:w?()=>{var e;const{decorationId:n}=null===(e=this.key)||void 0===e?void 0:e.getState(t.state);return document.querySelector(`[data-decoration-id="${n}"]`).getBoundingClientRect()}:null},b&&(null===(a=null==f?void 0:f.onExit)||void 0===a||a.call(f,v)),y&&(null===(i=null==f?void 0:f.onUpdate)||void 0===i||i.call(f,v)),m&&(null===(s=null==f?void 0:f.onStart)||void 0===s||s.call(f,v))},destroy:()=>{var e;v&&(null===(e=null==f?void 0:f.onExit)||void 0===e||e.call(f,v))}}},state:{init:()=>({active:!1,range:{},query:null,text:null,composing:!1}),apply(e,o,a,i){const{composing:u}=t.view,{selection:c}=e,{empty:p,from:g}=c,h={...o};if(h.composing=u,p||t.view.composing){!(g<o.range.from||g>o.range.to)||u||o.composing||(h.active=!1);const e=function(e){const{char:t,allowSpaces:n,prefixSpace:o,startOfLine:a,$position:i}=e,s=(0,r.escapeForRegEx)(t),d=new RegExp(`\\s${s}$`),l=a?"^":"",u=n?new RegExp(`${l}${s}.*?(?=\\s${s}|$)`,"gm"):new RegExp(`${l}(?:^)?${s}[^\\s${s}]*`,"gm"),c=i.depth<=0?0:i.before(),p=i.pos,g=i.doc.textBetween(c,p,"\0","\0"),h=Array.from(g.matchAll(u)).pop();if(!h||void 0===h.input||void 0===h.index)return null;const m=h.input.slice(Math.max(0,h.index-1),h.index),v=/^[\s\0]?$/.test(m);if(o&&!v)return null;const f=h.index+i.start();let y=f+h[0].length;return n&&d.test(g.slice(y-1,y+1))&&(h[0]+=" ",y+=1),f<i.pos&&y>=i.pos?{range:{from:f,to:y},query:h[0].slice(t.length),text:h[0]}:null}({char:n,allowSpaces:s,prefixSpace:d,startOfLine:l,$position:c.$from}),a=`id_${Math.floor(4294967295*Math.random())}`;e&&m({editor:t,state:i,range:e.range})?(h.active=!0,h.decorationId=o.decorationId?o.decorationId:a,h.range=e.range,h.query=e.query,h.text=e.text):h.active=!1}else h.active=!1;return h.active||(h.decorationId=null,h.range={},h.query=null,h.text=null),h}},props:{handleKeyDown(e,t){var n;const{active:r,range:o}=this.getState(e.state);return r&&(null===(n=null==f?void 0:f.onKeyDown)||void 0===n?void 0:n.call(f,{view:e,event:t,range:o}))||!1},decorations(e){const{active:t,range:n,decorationId:r}=this.getState(e);return t?a.EH.create(e.doc,[a.p.inline(n.from,n.to,{nodeName:u,class:c,"data-decoration-id":r})]):null}}})}const d=new o.H$("mention"),l=r.Node.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:t}){var n;return`${e.suggestion.char}${null!==(n=t.attrs.label)&&void 0!==n?n:t.attrs.id}`},suggestion:{char:"@",pluginKey:d,command:({editor:e,range:t,props:n})=>{var r;const o=e.view.state.selection.$to.nodeAfter;(null===(r=null==o?void 0:o.text)||void 0===r?void 0:r.startsWith(" "))&&(t.to+=1),e.chain().focus().insertContentAt(t,[{type:this.name,attrs:n},{type:"text",text:" "}]).run()},allow:({state:e,range:t})=>{const n=e.doc.resolve(t.from),r=e.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}),parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:t}){return["span",(0,r.mergeAttributes)({"data-type":this.name},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:e,state:t})=>{let n=!1;const{selection:r}=t,{empty:o,anchor:a}=r;return!!o&&(t.doc.nodesBetween(a-1,a,((t,r)=>{if(t.type.name===this.name)return n=!0,e.insertText(this.options.suggestion.char||"",r,r+t.nodeSize),!1})),n)}))}},addProseMirrorPlugins(){return[s({editor:this.editor,...this.options.suggestion})]}})}}]);
//# sourceMappingURL=4626.29405bc0f82642235c19.min.js.map