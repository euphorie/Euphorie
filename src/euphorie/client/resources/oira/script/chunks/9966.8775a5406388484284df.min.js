"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[9966],{9966:function(e,t,r){r.r(t),r.d(t,{Gapcursor:function(){return m},default:function(){return m}});var n=r(73845),o=r(7327),i=r(2376),l=r(87823),s=r(84348);class a extends i.Y1{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return a.valid(r)?new a(r):i.Y1.near(r)}content(){return l.p2.empty}eq(e){return e instanceof a&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new a(e.resolve(t.pos))}getBookmark(){return new u(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let r=e.index(t),n=e.node(t);if(0!=r)for(let e=n.child(r-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(n.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let r=e.indexAfter(t),n=e.node(t);if(r!=n.childCount)for(let e=n.child(r);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(n.type.spec.isolating)return!0}return!0}(e))return!1;let r=t.type.spec.allowGapCursor;if(null!=r)return r;let n=t.contentMatchAt(e.index()).defaultType;return n&&n.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&a.valid(e))return e;let n=e.pos,o=null;for(let r=e.depth;;r--){let i=e.node(r);if(t>0?e.indexAfter(r)<i.childCount:e.index(r)>0){o=i.child(t>0?e.indexAfter(r):e.index(r)-1);break}if(0==r)return null;n+=t;let l=e.doc.resolve(n);if(a.valid(l))return l}for(;;){let l=t>0?o.firstChild:o.lastChild;if(!l){if(o.isAtom&&!o.isText&&!i.qv.isSelectable(o)){e=e.doc.resolve(n+o.nodeSize*t),r=!1;continue e}break}o=l,n+=t;let s=e.doc.resolve(n);if(a.valid(s))return s}return null}}}a.prototype.visible=!1,a.findFrom=a.findGapCursorFrom,i.Y1.jsonID("gapcursor",a);class u{constructor(e){this.pos=e}map(e){return new u(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return a.valid(t)?new a(t):i.Y1.near(t)}}const c=(0,o.$)({ArrowLeft:d("horiz",-1),ArrowRight:d("horiz",1),ArrowUp:d("vert",-1),ArrowDown:d("vert",1)});function d(e,t){const r="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,n,o){let l=e.selection,s=t>0?l.$to:l.$from,u=l.empty;if(l instanceof i.Bs){if(!o.endOfTextblock(r)||0==s.depth)return!1;u=!1,s=e.doc.resolve(t>0?s.after():s.before())}let c=a.findGapCursorFrom(s,t,u);return!!c&&(n&&n(e.tr.setSelection(new a(c))),!0)}}function p(e,t,r){if(!e||!e.editable)return!1;let n=e.state.doc.resolve(t);if(!a.valid(n))return!1;let o=e.posAtCoords({left:r.clientX,top:r.clientY});return!(o&&o.inside>-1&&i.qv.isSelectable(e.state.doc.nodeAt(o.inside)))&&(e.dispatch(e.state.tr.setSelection(new a(n))),!0)}function f(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof a))return!1;let{$from:r}=e.state.selection,n=r.parent.contentMatchAt(r.index()).findWrapping(e.state.schema.nodes.text);if(!n)return!1;let o=l.HY.empty;for(let e=n.length-1;e>=0;e--)o=l.HY.from(n[e].createAndFill(null,o));let s=e.state.tr.replace(r.pos,r.pos,new l.p2(o,0,0));return s.setSelection(i.Bs.near(s.doc.resolve(r.pos+1))),e.dispatch(s),!1}function h(e){if(!(e.selection instanceof a))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",s.EH.create(e.doc,[s.p.widget(e.selection.head,t,{key:"gapcursor"})])}const m=n.Extension.create({name:"gapCursor",addProseMirrorPlugins(){return[new i.Sy({props:{decorations:h,createSelectionBetween(e,t,r){return t.pos==r.pos&&a.valid(r)?new a(r):null},handleClick:p,handleKeyDown:c,handleDOMEvents:{beforeinput:f}}})]},extendNodeSchema(e){var t;const r={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:null!==(t=(0,n.callOrReturn)((0,n.getExtensionField)(e,"allowGapCursor",r)))&&void 0!==t?t:null}}})}}]);
//# sourceMappingURL=9966.8775a5406388484284df.min.js.map