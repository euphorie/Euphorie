"use strict";(self.webpackChunkoira_prototype=self.webpackChunkoira_prototype||[]).push([[9318],{19318:function(e,t,n){n.r(t),n.d(t,{Mention:function(){return i}});var o=n(26798),r=n(76893);const i=r.pf.extend({defaultOptions:{...r.pf.options,url_scheme:null},addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},href:{default:null,parseHTML:e=>e.getAttribute("href"),renderHTML:e=>e.id?{href:this.options.url_scheme.replace("{USER}",e.id)}:{}}}},parseHTML:()=>[{tag:"a[data-mention]"}],renderHTML({node:e,HTMLAttributes:t}){return["a",(0,o.mergeAttributes)({"data-mention":""},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]}})},76893:function(e,t,n){n.d(t,{pf:function(){return l}});var o=n(26798),r=n(76922),i=n(98780);const a=new r.H$("suggestion");function s({pluginKey:e=a,editor:t,char:n="@",allowSpaces:o=!1,prefixSpace:s=!0,startOfLine:d=!1,decorationTag:l="span",decorationClass:c="suggestion",command:u=(()=>null),items:p=(()=>[]),render:g=(()=>({})),allow:m=(()=>!0)}){const h=null==g?void 0:g();return new r.Sy({key:e,view(){return{update:async(e,n)=>{var o,r,i,a,s;const d=null===(o=this.key)||void 0===o?void 0:o.getState(n),l=null===(r=this.key)||void 0===r?void 0:r.getState(e.state),c=d.active&&l.active&&d.range.from!==l.range.from,g=!d.active&&l.active,m=d.active&&!l.active,v=g||c,f=!g&&!m&&d.query!==l.query&&!c,y=m||c;if(!v&&!f&&!y)return;const b=y&&!v?d:l,x=document.querySelector(`[data-decoration-id="${b.decorationId}"]`),L={editor:t,range:b.range,query:b.query,text:b.text,items:f||v?await p({editor:t,query:b.query}):[],command:e=>{u({editor:t,range:b.range,props:e})},decorationNode:x,clientRect:x?()=>{var e;const{decorationId:n}=null===(e=this.key)||void 0===e?void 0:e.getState(t.state);return document.querySelector(`[data-decoration-id="${n}"]`).getBoundingClientRect()}:null};y&&(null===(i=null==h?void 0:h.onExit)||void 0===i||i.call(h,L)),f&&(null===(a=null==h?void 0:h.onUpdate)||void 0===a||a.call(h,L)),v&&(null===(s=null==h?void 0:h.onStart)||void 0===s||s.call(h,L))}}},state:{init:()=>({active:!1,range:{},query:null,text:null,composing:!1}),apply(e,r){const{composing:i}=t.view,{selection:a}=e,{empty:l,from:c}=a,u={...r};if(u.composing=i,l||t.view.composing){!(c<r.range.from||c>r.range.to)||i||r.composing||(u.active=!1);const e=function(e){const{char:t,allowSpaces:n,prefixSpace:o,startOfLine:r,$position:i}=e,a=t.split("").map((e=>`\\${e}`)).join(""),s=new RegExp(`\\s${a}$`),d=r?"^":"",l=n?new RegExp(`${d}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${d}(?:^)?${a}[^\\s${a}]*`,"gm"),c=i.depth<=0?0:i.before(),u=i.pos,p=i.doc.textBetween(c,u,"\0","\0"),g=Array.from(p.matchAll(l)).pop();if(!g||void 0===g.input||void 0===g.index)return null;const m=g.input.slice(Math.max(0,g.index-1),g.index),h=/^[\s\0]?$/.test(m);if(o&&!h)return null;const v=g.index+i.start();let f=v+g[0].length;return n&&s.test(p.slice(f-1,f+1))&&(g[0]+=" ",f+=1),v<i.pos&&f>=i.pos?{range:{from:v,to:f},query:g[0].slice(t.length),text:g[0]}:null}({char:n,allowSpaces:o,prefixSpace:s,startOfLine:d,$position:a.$from}),l=`id_${Math.floor(4294967295*Math.random())}`;e&&m({editor:t,range:e.range})?(u.active=!0,u.decorationId=r.decorationId?r.decorationId:l,u.range=e.range,u.query=e.query,u.text=e.text):u.active=!1}else u.active=!1;return u.active||(u.decorationId=null,u.range={},u.query=null,u.text=null),u}},props:{handleKeyDown(e,t){var n;const{active:o,range:r}=this.getState(e.state);return o&&(null===(n=null==h?void 0:h.onKeyDown)||void 0===n?void 0:n.call(h,{view:e,event:t,range:r}))||!1},decorations(e){const{active:t,range:n,decorationId:o}=this.getState(e);return t?i.EH.create(e.doc,[i.p.inline(n.from,n.to,{nodeName:l,class:c,"data-decoration-id":o})]):null}}})}const d=new r.H$("mention"),l=o.Node.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:t}){var n;return`${e.suggestion.char}${null!==(n=t.attrs.label)&&void 0!==n?n:t.attrs.id}`},suggestion:{char:"@",pluginKey:d,command:({editor:e,range:t,props:n})=>{var o;const r=e.view.state.selection.$to.nodeAfter;(null===(o=null==r?void 0:r.text)||void 0===o?void 0:o.startsWith(" "))&&(t.to+=1),e.chain().focus().insertContentAt(t,[{type:this.name,attrs:n},{type:"text",text:" "}]).run()},allow:({editor:e,range:t})=>{const n=e.state.doc.resolve(t.from),o=e.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(o)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}),parseHTML:()=>[{tag:"span[data-mention]"}],renderHTML({node:e,HTMLAttributes:t}){return["span",(0,o.mergeAttributes)({"data-mention":""},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:e,state:t})=>{let n=!1;const{selection:o}=t,{empty:r,anchor:i}=o;return!!r&&(t.doc.nodesBetween(i-1,i,((t,o)=>{if(t.type.name===this.name)return n=!0,e.insertText(this.options.suggestion.char||"",o,o+t.nodeSize),!1})),n)}))}},addProseMirrorPlugins(){return[s({editor:this.editor,...this.options.suggestion})]}})}}]);