"use strict";(self.webpackChunkoira_prototype=self.webpackChunkoira_prototype||[]).push([[9318],{19318:function(e,t,n){n.r(t),n.d(t,{Mention:function(){return r}});var o=n(26798);const r=n(76893).pf.extend({addOptions(){return{...this.parent?.(),url_scheme:null}},addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},href:{default:null,parseHTML:e=>e.getAttribute("href"),renderHTML:e=>e.id?{href:this.options.url_scheme.replace("{USER}",e.id)}:{}}}},parseHTML:()=>[{tag:"a[data-mention]"}],renderHTML({node:e,HTMLAttributes:t}){return["a",(0,o.mergeAttributes)({"data-mention":""},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]}});t.default=r},76893:function(e,t,n){n.d(t,{pf:function(){return l}});var o=n(26798),r=n(76922),i=n(98780);const a=new r.H$("suggestion");function s({pluginKey:e=a,editor:t,char:n="@",allowSpaces:s=!1,prefixSpace:d=!0,startOfLine:l=!1,decorationTag:u="span",decorationClass:c="suggestion",command:p=(()=>null),items:g=(()=>[]),render:m=(()=>({})),allow:h=(()=>!0)}){let v;const f=null==m?void 0:m();return new r.Sy({key:e,view(){return{update:async(e,n)=>{var o,r,i,a,s;const d=null===(o=this.key)||void 0===o?void 0:o.getState(n),l=null===(r=this.key)||void 0===r?void 0:r.getState(e.state),u=d.active&&l.active&&d.range.from!==l.range.from,c=!d.active&&l.active,m=d.active&&!l.active,h=c||u,y=!c&&!m&&d.query!==l.query&&!u,b=m||u;if(!h&&!y&&!b)return;const x=b&&!h?d:l,L=document.querySelector(`[data-decoration-id="${x.decorationId}"]`);v={editor:t,range:x.range,query:x.query,text:x.text,items:y||h?await g({editor:t,query:x.query}):[],command:e=>{p({editor:t,range:x.range,props:e})},decorationNode:L,clientRect:L?()=>{var e;const{decorationId:n}=null===(e=this.key)||void 0===e?void 0:e.getState(t.state);return document.querySelector(`[data-decoration-id="${n}"]`).getBoundingClientRect()}:null},b&&(null===(i=null==f?void 0:f.onExit)||void 0===i||i.call(f,v)),y&&(null===(a=null==f?void 0:f.onUpdate)||void 0===a||a.call(f,v)),h&&(null===(s=null==f?void 0:f.onStart)||void 0===s||s.call(f,v))},destroy:()=>{var e;v&&(null===(e=null==f?void 0:f.onExit)||void 0===e||e.call(f,v))}}},state:{init:()=>({active:!1,range:{},query:null,text:null,composing:!1}),apply(e,r,i,a){const{composing:u}=t.view,{selection:c}=e,{empty:p,from:g}=c,m={...r};if(m.composing=u,p||t.view.composing){!(g<r.range.from||g>r.range.to)||u||r.composing||(m.active=!1);const e=function(e){const{char:t,allowSpaces:n,prefixSpace:r,startOfLine:i,$position:a}=e,s=(0,o.escapeForRegEx)(t),d=new RegExp(`\\s${s}$`),l=i?"^":"",u=n?new RegExp(`${l}${s}.*?(?=\\s${s}|$)`,"gm"):new RegExp(`${l}(?:^)?${s}[^\\s${s}]*`,"gm"),c=a.depth<=0?0:a.before(),p=a.pos,g=a.doc.textBetween(c,p,"\0","\0"),m=Array.from(g.matchAll(u)).pop();if(!m||void 0===m.input||void 0===m.index)return null;const h=m.input.slice(Math.max(0,m.index-1),m.index),v=/^[\s\0]?$/.test(h);if(r&&!v)return null;const f=m.index+a.start();let y=f+m[0].length;return n&&d.test(g.slice(y-1,y+1))&&(m[0]+=" ",y+=1),f<a.pos&&y>=a.pos?{range:{from:f,to:y},query:m[0].slice(t.length),text:m[0]}:null}({char:n,allowSpaces:s,prefixSpace:d,startOfLine:l,$position:c.$from}),i=`id_${Math.floor(4294967295*Math.random())}`;e&&h({editor:t,state:a,range:e.range})?(m.active=!0,m.decorationId=r.decorationId?r.decorationId:i,m.range=e.range,m.query=e.query,m.text=e.text):m.active=!1}else m.active=!1;return m.active||(m.decorationId=null,m.range={},m.query=null,m.text=null),m}},props:{handleKeyDown(e,t){var n;const{active:o,range:r}=this.getState(e.state);return o&&(null===(n=null==f?void 0:f.onKeyDown)||void 0===n?void 0:n.call(f,{view:e,event:t,range:r}))||!1},decorations(e){const{active:t,range:n,decorationId:o}=this.getState(e);return t?i.EH.create(e.doc,[i.p.inline(n.from,n.to,{nodeName:u,class:c,"data-decoration-id":o})]):null}}})}const d=new r.H$("mention"),l=o.Node.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:t}){var n;return`${e.suggestion.char}${null!==(n=t.attrs.label)&&void 0!==n?n:t.attrs.id}`},suggestion:{char:"@",pluginKey:d,command:({editor:e,range:t,props:n})=>{var o;const r=e.view.state.selection.$to.nodeAfter;(null===(o=null==r?void 0:r.text)||void 0===o?void 0:o.startsWith(" "))&&(t.to+=1),e.chain().focus().insertContentAt(t,[{type:this.name,attrs:n},{type:"text",text:" "}]).run()},allow:({state:e,range:t})=>{const n=e.doc.resolve(t.from),o=e.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(o)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}),parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:t}){return["span",(0,o.mergeAttributes)({"data-type":this.name},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:e,state:t})=>{let n=!1;const{selection:o}=t,{empty:r,anchor:i}=o;return!!r&&(t.doc.nodesBetween(i-1,i,((t,o)=>{if(t.type.name===this.name)return n=!0,e.insertText(this.options.suggestion.char||"",o,o+t.nodeSize),!1})),n)}))}},addProseMirrorPlugins(){return[s({editor:this.editor,...this.options.suggestion})]}})}}]);
//# sourceMappingURL=9318.6727c3b4a51d488cacfa.min.js.map