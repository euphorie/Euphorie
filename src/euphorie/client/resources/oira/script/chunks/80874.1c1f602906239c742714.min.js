"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[80874,89989],{13249:function(e,t,n){n.d(t,{B:function(){return d},q:function(){return l}});var a=n(30566),r=n(80717),i=n(2232),s=n(93392),o=n(52781);let c=null;async function l(e){let{url:t,editor:n,instance:l=null,pattern:p=null,extra_class:u=null}=e;const m=c,_=c=n.state.doc.nodeAt(n.state.selection.from);if(null===l||_===m&&l?.tippy.popperInstance||(await d({instance:l,pattern_name:p.name}),l=null),l&&l?.tippy.popperInstance)l.get_content(t);else{p&&(a.A.patterns[p.name]=p);const e=n.options.element;l=new s.Ay(e,{source:"ajax",url:t,trigger:"none",class:u,"position-list":["tl"]}),await i.A.await_pattern_init(l);const c=(0,o.posToDOMRect)(n.view,n.state.selection.from,n.state.selection.to);l.tippy?.setProps({getReferenceClientRect:()=>c}),i.A.add_event_listener(document,"mousedown","tiptap--context_menu_close--click",(async e=>{[e.target,...r.A.get_parents(e.target)].includes(l?.tippy.popper)||(await d({instance:l,pattern_name:p.name}),l=null)})),i.A.add_event_listener(document,"keydown","tiptap--context_menu_close--esc",(async e=>{"Escape"===e.key&&(await d({instance:l,pattern_name:p.name}),l=null)})),l.show()}return l}async function d(e){let{instance:t,pattern_name:n}=e;return t&&(await t.hide(),t.destroy(),t=null),n&&delete a.A.patterns[n],i.A.remove_event_listener(document,"tiptap--context_menu_close--click"),i.A.remove_event_listener(document,"tiptap--context_menu_close--esc"),null}},80874:function(e,t,n){n.r(t),n.d(t,{factory:function(){return f},init:function(){return _}});var a=n(13249),r=n(89989),i=n(42752),s=n(52781),o=n(42845),c=n(13744),l=n(80717),d=n(2232),p=n(49264);let u;function m(e){let{app:t}=e;class n extends c.m{static name="tiptap-embed-context-menu";static trigger=".tiptap-embed-context-menu";init(){(0,r.focus_handler)(this.el);const e=this.el.querySelector(".tiptap-edit-embed"),n=this.el.querySelector(".tiptap-remove-embed");e&&e.addEventListener("click",(()=>{t.toolbar.embed.click()})),n&&n.addEventListener("click",(()=>{t.editor.commands.selectParentNode(),t.editor.commands.deleteSelection(),t.editor.commands.focus()}))}}return n}function _(e){let{app:t,button:n}=e;n.addEventListener("click",(()=>{if(l.A.get_data(t.toolbar_el,"tiptap-instance",null)!==t)return;const e=function(e){let{app:t}=e;return{name:"tiptap-embed-panel",trigger:t.options.embed?.panel,init(e){const n=e.querySelector("[name=tiptap-src]");if(!n)return void i.Rm.warn("No src input in embed panel found.");const a=e.querySelector("[name=tiptap-title]"),s=e.querySelector("[name=tiptap-caption]"),o=e.querySelector(".tiptap-confirm, [name=tiptap-confirm]");(0,r.focus_handler)(e);const c=t.editor.state.doc.nodeAt(t.editor.state.selection.from);t.editor.commands.selectParentNode();const p=t.editor.state.doc.nodeAt(t.editor.state.selection.from),u=p?.content.content.filter((e=>"figcaption"===e.type.name))?.[0];c&&(n.value=c.attrs?.src||"",a&&(a.value=c.attrs?.title||"")),u&&s&&(s.value=u.textContent||"");const m=e=>{t.editor.commands.insertContent({type:"figure",content:[{type:"embed",attrs:{src:n.value,...a?.value&&{title:a.value}}},...s?.value?[{type:"figcaption",content:[{type:"text",text:s.value}]}]:[]]}),!0===e&&(t.editor.commands.selectParentNode(),t.editor.commands.focus(t.editor.state.selection.to))},_=l.A.querySelectorAllAndMe(e,"form")?.[0];_&&d.A.add_event_listener(_,"submit","tiptap_embed_submit",(e=>{e.preventDefault()})),o?d.A.add_event_listener(o,"click","tiptap_embed_confirm",(()=>m(!0))):(d.A.add_event_listener(n,"change","tiptap_embed_src",m),d.A.add_event_listener(a,"change","tiptap_embed_title",m),d.A.add_event_listener(s,"change","tiptap_embed_caption",m))}}}({app:t});document.addEventListener("patterns-injected-delayed",(n=>{e.init(n.detail.injected),t.current_modal.addEventListener("patterns-injected-delayed",(()=>{e.init(t.current_modal)}))}),{once:!0})})),t.editor.on("selectionUpdate",(async()=>{t.editor.isActive("embed")?n.classList.add("active"):n.classList.remove("active"),t.editor.can().setEmbed()?n.classList.remove("disabled"):n.classList.add("disabled"),t.options.embed.menu&&p.A.debounce((async()=>{t.editor.isActive("embed")?u=await(0,a.q)({url:t.options.embed.menu,editor:t.editor,instance:u,pattern:m({app:t}),extra_class:"tiptap-embed-menu"}):u&&(await(0,a.B)({instance:u,pattern_name:"tiptap-embed-context-menu"}),u=null)}),50)()}))}const f=()=>{const e=e=>e.indexOf("youtube.com")>-1,t=e=>e.indexOf("vimeo.com")>-1;return s.Node.create({name:"embed",addOptions(){return{HTMLAttributes:{}}},group:"block",allowGapCursor:!1,draggable:!1,isolating:!0,selectable:!0,addAttributes(){return{src:{default:null},title:{default:null}}},parseHTML(){return[{tag:'iframe[src*="youtube.com"]',getAttrs:n=>(e(n.getAttribute("src"))||t(n.getAttribute("src"))>-1)&&null}]},renderHTML(n){let{HTMLAttributes:a}=n;const r={width:"560",height:"315",allowfullscreen:"",frameborder:"0"},i={width:"640",height:"360",allowfullscreen:"",frameborder:"0"};let o;if(e(a.src)){o={...a,...r};const e=o.src.match(/watch.*v\=(?<vid>[^&]*)/)?.groups?.vid;e&&(o.src=`https://www.youtube.com/embed/${e}`)}if(t(a.src)){o={...a,...i};const e=o.src.match(/vimeo.com\/(?<vid>[0-9]*)/)?.groups?.vid;e&&(o.src=`https://player.vimeo.com/video/${e}`)}return["iframe",(0,s.mergeAttributes)(this.options.HTMLAttributes,o)]},addCommands(){return{setEmbed:e=>t=>{let{commands:n}=t;return n.insertContent({type:this.name,attrs:e})}}},addProseMirrorPlugins(){return[new o.k_({props:{handleDOMEvents:{dragstart:(e,t)=>{if(!t.target)return!1;const n=e.posAtDOM(t.target,0);return e.state.doc.resolve(n).parent.type===this.type&&t.preventDefault(),!1}}}})]}})}},89989:function(e,t,n){n.r(t),n.d(t,{TARGETS:function(){return i},focus_handler:function(){return s}});var a=n(2232),r=n(49264);const i=[];function s(e){e.setAttribute("tabindex","-1"),a.A.add_event_listener(e,"focus","tiptap-focusin",(async()=>{r.A.timeout(1),i.map((e=>e?.classList.add("tiptap-focus")))}),!0),a.A.add_event_listener(e,"blur","tiptap-focusout",(()=>{i.map((e=>e?.classList.remove("tiptap-focus")))}),!0)}}}]);
//# sourceMappingURL=80874.1c1f602906239c742714.min.js.map