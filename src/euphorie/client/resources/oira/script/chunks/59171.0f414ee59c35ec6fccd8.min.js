"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[59171,84193],{22383:function(e,t,n){n.d(t,{y:function(){return l},z:function(){return p}});var a=n(86272),i=n(56938),r=n(57467),o=n(45814),s=n(73845);let c=null;async function l(e){let{url:t,editor:n,instance:l=null,pattern:u=null,extra_class:d=null}=e;const m=c,_=c=n.state.doc.nodeAt(n.state.selection.from);if(null===l||_===m&&l?.tippy.popperInstance||(await p({instance:l,pattern_name:u.name}),l=null),l&&l?.tippy.popperInstance)l.get_content(t);else{u&&(a.Z.patterns[u.name]=u);const e=n.options.element;l=new o.ZP(e,{source:"ajax",url:t,trigger:"none",class:d,"position-list":["tl"]}),await r.Z.await_pattern_init(l);const c=(0,s.posToDOMRect)(n.view,n.state.selection.from,n.state.selection.to);l.tippy?.setProps({getReferenceClientRect:()=>c}),r.Z.add_event_listener(document,"mousedown","tiptap--context_menu_close--click",(async e=>{[e.target,...i.Z.get_parents(e.target)].includes(l?.tippy.popper)||(await p({instance:l,pattern_name:u.name}),l=null)})),r.Z.add_event_listener(document,"keydown","tiptap--context_menu_close--esc",(async e=>{"Escape"===e.key&&(await p({instance:l,pattern_name:u.name}),l=null)})),l.show()}return l}async function p(e){let{instance:t,pattern_name:n}=e;return t&&(await t.hide(),t.destroy(),t=null),n&&delete a.Z.patterns[n],r.Z.remove_event_listener(document,"tiptap--context_menu_close--click"),r.Z.remove_event_listener(document,"tiptap--context_menu_close--esc"),null}},59171:function(e,t,n){n.r(t),n.d(t,{factory:function(){return _},init:function(){return m}});var a=n(22383),i=n(84193),r=n(73845),o=n(2376),s=n(92041),c=n(56938),l=n(57467),p=n(92452);let u;function d(e){let{app:t}=e;class n extends s.o{static name="tiptap-image-context-menu";static trigger=".tiptap-image-context-menu";init(){(0,i.focus_handler)(this.el);const e=this.el.querySelector(".tiptap-edit-image"),n=this.el.querySelector(".tiptap-remove-image");e&&e.addEventListener("click",(()=>{t.toolbar.image.click()})),n&&n.addEventListener("click",(()=>{t.editor.commands.selectParentNode(),t.editor.commands.deleteSelection(),t.editor.commands.focus()}))}}return n}function m(e){let{app:t,button:n}=e;n.addEventListener("click",(()=>{if(c.Z.get_data(t.toolbar_el,"tiptap-instance",null)!==t)return;const e=function(e){let{app:t}=e;return{name:"tiptap-image-panel",trigger:t.options.image?.panel,init(e){const n=e.querySelectorAll("[name=tiptap-src]"),a=e.querySelector("[name=tiptap-alt]"),r=e.querySelector("[name=tiptap-title]"),o=e.querySelector("[name=tiptap-caption]"),s=e.querySelector(".tiptap-confirm, [name=tiptap-confirm]");(0,i.focus_handler)(e);const p=this.node_image;if(p){const e=p.attrs?.src;let t=e?[...n].filter((t=>t.value===e)):[];if(t.length>0)for(const e of t)e.checked=!0,e.dispatchEvent(l.Z.change_event());else{let t=[...n].filter((e=>"text"===e.type||"url"===e.type));t.length>0&&!t[0].value&&(t[0].value=e||"")}r&&!r.value&&(r.value=p.attrs?.title||""),a&&!a.value&&(a.value=p.attrs?.alt||"")}const u=this.figcaption_node;u&&o&&!o.value&&(o.value=u.textContent||"");const d=n=>{const i=e.querySelector("[name=tiptap-src][type=radio]:checked,\n                         [name=tiptap-src][type=checkbox]:checked,\n                         [name=tiptap-src][type=option]:checked,\n                         [name=tiptap-src][type=hidden],\n                         [name=tiptap-src][type=text],\n                         [name=tiptap-src][type=url]");t.editor.commands.insertContent({type:"figure",content:[{type:"image-figure",attrs:{src:i.value,...a?.value&&{alt:a.value},...r?.value&&{title:r.value}}},...o?.value?[{type:"figcaption",content:[{type:"text",text:o.value}]}]:[]]}),!0===n&&(t.editor.commands.selectParentNode(),t.editor.commands.focus(t.editor.state.selection.to))},m=c.Z.querySelectorAllAndMe(e,"form")?.[0];if(m&&l.Z.add_event_listener(m,"submit","tiptap_image_submit",(e=>{e.preventDefault()})),s)l.Z.add_event_listener(s,"click","tiptap_image_confirm",(()=>d(!0)));else{for(const e of n)l.Z.add_event_listener(e,"change","tiptap_image_src",d);l.Z.add_event_listener(a,"change","tiptap_image_alt",d),l.Z.add_event_listener(r,"change","tiptap_image_title",d),l.Z.add_event_listener(o,"change","tiptap_image_caption",d)}},_node_image:null,get node_image(){return this._node_image||void 0===this._node_image||(this._node_image=t.editor.state.doc.nodeAt(t.editor.state.selection.from)),this._node_image},_figcaption:null,get figcaption_node(){if(this._figcaption||void 0===this._figcaption)return this._figcaption;t.editor.commands.selectParentNode();const e=t.editor.state.doc.nodeAt(t.editor.state.selection.from),n=e?.content.content.filter((e=>"figcaption"===e.type.name))?.[0];return this._figcaption=n,n}}}({app:t});document.addEventListener("patterns-injected-delayed",(n=>{e.init(n.detail.injected),t.current_modal.addEventListener("patterns-injected-delayed",(()=>{e.init(t.current_modal)}))}),{once:!0})})),t.editor.on("selectionUpdate",(async()=>{t.editor.isActive("image-figure")?n.classList.add("active"):n.classList.remove("active"),t.editor.can().setImage()?n.classList.remove("disabled"):n.classList.add("disabled"),t.options.image.menu&&p.Z.debounce((async()=>{t.editor.isActive("image-figure")?u=await(0,a.y)({url:t.options.image.menu,editor:t.editor,instance:u,pattern:d({app:t}),extra_class:"tiptap-image-menu"}):u&&(await(0,a.z)({instance:u,pattern_name:"tiptap-image-context-menu"}),u=null)}),50)()}))}const _=()=>r.Node.create({name:"image-figure",addOptions(){return{HTMLAttributes:{}}},addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},group:"block",inline:!1,allowGapCursor:!1,atom:!0,draggable:!1,isolating:!0,selectable:!0,parseHTML(){return[{tag:"img",getAttrs:e=>null!==e.closest("figure")&&null}]},renderHTML(e){let{HTMLAttributes:t}=e;return["img",(0,r.mergeAttributes)(this.options.HTMLAttributes,t)]},addProseMirrorPlugins(){return[new o.Sy({props:{handleDOMEvents:{dragstart:(e,t)=>(t.preventDefault(),!1)}}})]}})},84193:function(e,t,n){n.r(t),n.d(t,{TARGETS:function(){return r},focus_handler:function(){return o}});var a=n(57467),i=n(92452);const r=[];function o(e){e.setAttribute("tabindex","-1"),a.Z.add_event_listener(e,"focus","tiptap-focusin",(async()=>{i.Z.timeout(1),r.map((e=>e?.classList.add("tiptap-focus")))}),!0),a.Z.add_event_listener(e,"blur","tiptap-focusout",(()=>{r.map((e=>e?.classList.remove("tiptap-focus")))}),!0)}}}]);
//# sourceMappingURL=59171.0f414ee59c35ec6fccd8.min.js.map