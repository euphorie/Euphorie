{"version":3,"file":"chunks/30238.ad955358faec2e76ebda.min.js","mappings":"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","sources":["webpack://@patternslib/patternslib/./node_modules/@patternslib/pat-tiptap/src/context_menu.js","webpack://@patternslib/patternslib/./node_modules/@patternslib/pat-tiptap/src/focus-handler.js"],"sourcesContent":["import Registry from \"@patternslib/patternslib/src/core/registry\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\nimport events from \"@patternslib/patternslib/src/core/events\";\nimport patTooltip from \"@patternslib/patternslib/src/pat/tooltip/tooltip\";\nimport { posToDOMRect } from \"@tiptap/core\";\n\nlet PREV_NODE = null;\n\nexport async function context_menu({\n    url,\n    editor,\n    instance = null,\n    pattern = null,\n    extra_class = null,\n}) {\n    const prev_node = PREV_NODE;\n    const cur_node = (PREV_NODE = editor.state.doc.nodeAt(editor.state.selection.from));\n\n    if (\n        instance !== null &&\n        (cur_node !== prev_node || !instance?.tippy.popperInstance)\n    ) {\n        // Close context menu, when new node is selected.\n        context_menu_close({\n            instance: instance,\n            pattern_name: pattern.prototype.name,\n        });\n        instance = null;\n    }\n\n    if (!instance || !instance?.tippy.popperInstance) {\n        // Only re-initialize when not already opened.\n\n        // 1) Dynamically register a pattern to be used in the context menu\n        //    We need to unregister it after use in ``context_menu_close``\n        //    to allow multiple tiptap editors on the same page because it\n        //    references the current editor instance.\n        if (pattern) {\n            Registry.patterns[pattern.prototype.name] = pattern;\n        }\n\n        // 2) Initialize the tooltip\n        const editor_element = editor.options.element;\n        instance = await new patTooltip(editor_element, {\n            \"source\": \"ajax\",\n            \"url\": url,\n            \"trigger\": \"none\",\n            \"class\": extra_class,\n            \"position-list\": [\"tl\"],\n        });\n\n        await events.await_pattern_init(instance);\n\n        const reference_position = posToDOMRect(\n            editor.view,\n            editor.state.selection.from,\n            editor.state.selection.to\n        );\n\n        instance.tippy?.setProps({\n            // NOTE: getReferenceClientRect is called after each setContent.\n            getReferenceClientRect: () => reference_position,\n        });\n\n        events.add_event_listener(\n            document,\n            \"mousedown\",\n            \"tiptap--context_menu_close--click\",\n            (e) => {\n                if (\n                    [e.target, ...dom.get_parents(e.target)].includes(\n                        instance?.tippy.popper\n                    )\n                ) {\n                    // Do not close the context menu if we click in it.\n                    return;\n                }\n                context_menu_close({\n                    instance: instance,\n                    pattern_name: pattern.prototype.name,\n                });\n            }\n        );\n        events.add_event_listener(\n            document,\n            \"keydown\",\n            \"tiptap--context_menu_close--esc\",\n            (e) => {\n                if (e.key !== \"Escape\") {\n                    // Not a closing key.\n                    return;\n                }\n                context_menu_close({\n                    instance: instance,\n                    pattern_name: pattern.prototype.name,\n                });\n            }\n        );\n\n        instance.show();\n    } else {\n        instance.get_content(url);\n    }\n\n    return instance;\n}\n\nexport function context_menu_close({ instance, pattern_name }) {\n    // Hide and destroy the context menu / tooltip instance\n    if (instance) {\n        instance.hide();\n        instance.destroy();\n        instance = null;\n    }\n\n    // Unregister the pattern\n    if (pattern_name) {\n        delete Registry.patterns[pattern_name];\n    }\n    events.remove_event_listener(document, \"tiptap--context_menu_close--click\");\n    events.remove_event_listener(document, \"tiptap--context_menu_close--esc\");\n    return null;\n}\n","import events from \"@patternslib/patternslib/src/core/events\";\nimport utils from \"@patternslib/patternslib/src/core/utils\";\n\nexport const TARGETS = [];\n\nexport function focus_handler(el) {\n    // make element focusable\n    // See: https://javascript.info/focus-blur\n    el.setAttribute(\"tabindex\", \"-1\"); // not user-selectable but programmatically focusable.\n    events.add_event_listener(\n        el,\n        \"focus\",\n        \"tiptap-focusin\",\n        async () => {\n            utils.timeout(1); // short timeout to ensure focus class is set even if tiptap_blur_handler is called concurrently.\n            TARGETS.map((it) => it?.classList.add(\"tiptap-focus\"));\n        },\n        true\n    );\n    events.add_event_listener(\n        el,\n        \"blur\",\n        \"tiptap-focusout\",\n        () => {\n            TARGETS.map((it) => it?.classList.remove(\"tiptap-focus\"));\n        },\n        true\n    );\n}\n"],"names":["i","PREV_NODE","context_menu","url","editor","instance","pattern","extra_class","prev_node","cur_node","state","doc","nodeAt","selection","from","tippy","popperInstance","context_menu_close","pattern_name","prototype","name","Registry","editor_element","options","element","patTooltip","events","reference_position","posToDOMRect","view","to","setProps","getReferenceClientRect","document","e","target","dom","includes","popper","key","show","get_content","hide","destroy","TARGETS","focus_handler","el","setAttribute","utils","map","it","classList","add","remove"],"sourceRoot":""}