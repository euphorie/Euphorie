"use strict";(self.webpackChunkoira_prototype=self.webpackChunkoira_prototype||[]).push([[4626],{34626:function(t,e,n){n.r(e),n.d(e,{TagPluginKey:function(){return i},Tag:function(){return a}});var o=n(26798),r=n(76893);const i=new(n(76922).H$)("tag"),a=r.pf.extend({name:"tag",defaultOptions:{...r.pf.options,suggestion:{...r.pf.options.suggestion,pluginKey:i,char:"#",command:({editor:t,range:e,props:n})=>{const o=t.view.state.selection.$to.nodeAfter?.text?.startsWith(" ");o&&(e.to+=1),t.chain().focus().insertContentAt(e,[{type:"tag",attrs:n},{type:"text",text:" "}]).run()},allow:({editor:t,range:e})=>t.can().insertContentAt(e,{type:"tag"})},url_scheme:null},addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},href:{default:null,parseHTML:t=>t.getAttribute("href"),renderHTML:t=>t.id?{href:this.options.url_scheme.replace("{TAG}",t.id)}:{}}}},parseHTML:()=>[{tag:"a[data-tag]"}],renderHTML({node:t,HTMLAttributes:e}){return["a",(0,o.mergeAttributes)({"data-tag":""},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t})]}})},76893:function(t,e,n){n.d(e,{pf:function(){return l}});var o=n(26798),r=n(76922),i=n(98780);const a=new r.H$("suggestion");function s({pluginKey:t=a,editor:e,char:n="@",allowSpaces:o=!1,prefixSpace:s=!0,startOfLine:d=!1,decorationTag:l="span",decorationClass:c="suggestion",command:u=(()=>null),items:p=(()=>[]),render:g=(()=>({})),allow:m=(()=>!0)}){const h=null==g?void 0:g();return new r.Sy({key:t,view(){return{update:async(t,n)=>{var o,r,i,a,s;const d=null===(o=this.key)||void 0===o?void 0:o.getState(n),l=null===(r=this.key)||void 0===r?void 0:r.getState(t.state),c=d.active&&l.active&&d.range.from!==l.range.from,g=!d.active&&l.active,m=d.active&&!l.active,v=g||c,f=!g&&!m&&d.query!==l.query&&!c,y=m||c;if(!v&&!f&&!y)return;const x=y&&!v?d:l,b=document.querySelector(`[data-decoration-id="${x.decorationId}"]`),w={editor:e,range:x.range,query:x.query,text:x.text,items:f||v?await p({editor:e,query:x.query}):[],command:t=>{u({editor:e,range:x.range,props:t})},decorationNode:b,clientRect:b?()=>{var t;const{decorationId:n}=null===(t=this.key)||void 0===t?void 0:t.getState(e.state);return document.querySelector(`[data-decoration-id="${n}"]`).getBoundingClientRect()}:null};y&&(null===(i=null==h?void 0:h.onExit)||void 0===i||i.call(h,w)),f&&(null===(a=null==h?void 0:h.onUpdate)||void 0===a||a.call(h,w)),v&&(null===(s=null==h?void 0:h.onStart)||void 0===s||s.call(h,w))}}},state:{init:()=>({active:!1,range:{},query:null,text:null,composing:!1}),apply(t,r){const{composing:i}=e.view,{selection:a}=t,{empty:l,from:c}=a,u={...r};if(u.composing=i,l||e.view.composing){!(c<r.range.from||c>r.range.to)||i||r.composing||(u.active=!1);const t=function(t){const{char:e,allowSpaces:n,prefixSpace:o,startOfLine:r,$position:i}=t,a=e.split("").map((t=>`\\${t}`)).join(""),s=new RegExp(`\\s${a}$`),d=r?"^":"",l=n?new RegExp(`${d}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${d}(?:^)?${a}[^\\s${a}]*`,"gm"),c=i.depth<=0?0:i.before(),u=i.pos,p=i.doc.textBetween(c,u,"\0","\0"),g=Array.from(p.matchAll(l)).pop();if(!g||void 0===g.input||void 0===g.index)return null;const m=g.input.slice(Math.max(0,g.index-1),g.index),h=/^[\s\0]?$/.test(m);if(o&&!h)return null;const v=g.index+i.start();let f=v+g[0].length;return n&&s.test(p.slice(f-1,f+1))&&(g[0]+=" ",f+=1),v<i.pos&&f>=i.pos?{range:{from:v,to:f},query:g[0].slice(e.length),text:g[0]}:null}({char:n,allowSpaces:o,prefixSpace:s,startOfLine:d,$position:a.$from}),l=`id_${Math.floor(4294967295*Math.random())}`;t&&m({editor:e,range:t.range})?(u.active=!0,u.decorationId=r.decorationId?r.decorationId:l,u.range=t.range,u.query=t.query,u.text=t.text):u.active=!1}else u.active=!1;return u.active||(u.decorationId=null,u.range={},u.query=null,u.text=null),u}},props:{handleKeyDown(t,e){var n;const{active:o,range:r}=this.getState(t.state);return o&&(null===(n=null==h?void 0:h.onKeyDown)||void 0===n?void 0:n.call(h,{view:t,event:e,range:r}))||!1},decorations(t){const{active:e,range:n,decorationId:o}=this.getState(t);return e?i.EH.create(t.doc,[i.p.inline(n.from,n.to,{nodeName:l,class:c,"data-decoration-id":o})]):null}}})}const d=new r.H$("mention"),l=o.Node.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:t,node:e}){var n;return`${t.suggestion.char}${null!==(n=e.attrs.label)&&void 0!==n?n:e.attrs.id}`},suggestion:{char:"@",pluginKey:d,command:({editor:t,range:e,props:n})=>{var o;const r=t.view.state.selection.$to.nodeAfter;(null===(o=null==r?void 0:r.text)||void 0===o?void 0:o.startsWith(" "))&&(e.to+=1),t.chain().focus().insertContentAt(e,[{type:this.name,attrs:n},{type:"text",text:" "}]).run()},allow:({editor:t,range:e})=>{const n=t.state.doc.resolve(e.from),o=t.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(o)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}}}),parseHTML:()=>[{tag:"span[data-mention]"}],renderHTML({node:t,HTMLAttributes:e}){return["span",(0,o.mergeAttributes)({"data-mention":""},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t})]},renderText({node:t}){return this.options.renderLabel({options:this.options,node:t})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:t,state:e})=>{let n=!1;const{selection:o}=e,{empty:r,anchor:i}=o;return!!r&&(e.doc.nodesBetween(i-1,i,((e,o)=>{if(e.type.name===this.name)return n=!0,t.insertText(this.options.suggestion.char||"",o,o+e.nodeSize),!1})),n)}))}},addProseMirrorPlugins(){return[s({editor:this.editor,...this.options.suggestion})]}})}}]);