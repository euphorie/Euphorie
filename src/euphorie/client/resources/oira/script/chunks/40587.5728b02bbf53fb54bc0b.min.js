"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[40587,89989],{13249:function(t,e,n){n.d(e,{B:function(){return d},q:function(){return c}});var a=n(30566),i=n(80717),o=n(2232),r=n(93392),s=n(52781);let l=null;async function c(t){let{url:e,editor:n,instance:c=null,pattern:u=null,extra_class:p=null}=t;const m=l,v=l=n.state.doc.nodeAt(n.state.selection.from);if(null===c||v===m&&c?.tippy.popperInstance||(await d({instance:c,pattern_name:u.name}),c=null),c&&c?.tippy.popperInstance)c.get_content(e);else{u&&(a.A.patterns[u.name]=u);const t=n.options.element;c=new r.Ay(t,{source:"ajax",url:e,trigger:"none",class:p,"position-list":["tl"]}),await o.A.await_pattern_init(c);const l=(0,s.posToDOMRect)(n.view,n.state.selection.from,n.state.selection.to);c.tippy?.setProps({getReferenceClientRect:()=>l}),o.A.add_event_listener(document,"mousedown","tiptap--context_menu_close--click",(async t=>{[t.target,...i.A.get_parents(t.target)].includes(c?.tippy.popper)||(await d({instance:c,pattern_name:u.name}),c=null)})),o.A.add_event_listener(document,"keydown","tiptap--context_menu_close--esc",(async t=>{"Escape"===t.key&&(await d({instance:c,pattern_name:u.name}),c=null)})),c.show()}return c}async function d(t){let{instance:e,pattern_name:n}=t;return e&&(await e.hide(),e.destroy(),e=null),n&&delete a.A.patterns[n],o.A.remove_event_listener(document,"tiptap--context_menu_close--click"),o.A.remove_event_listener(document,"tiptap--context_menu_close--esc"),null}},40587:function(t,e,n){n.r(e),n.d(e,{factory:function(){return y}});var a=n(52781),i=n(42845),o=n(1575);function r(t){var e;const{char:n,allowSpaces:i,allowedPrefixes:o,startOfLine:r,$position:s}=t,l=(0,a.escapeForRegEx)(n),c=new RegExp(`\\s${l}$`),d=r?"^":"",u=i?new RegExp(`${d}${l}.*?(?=\\s${l}|$)`,"gm"):new RegExp(`${d}(?:^)?${l}[^\\s${l}]*`,"gm"),p=(null===(e=s.nodeBefore)||void 0===e?void 0:e.isText)&&s.nodeBefore.text;if(!p)return null;const m=s.pos-p.length,v=Array.from(p.matchAll(u)).pop();if(!v||void 0===v.input||void 0===v.index)return null;const g=v.input.slice(Math.max(0,v.index-1),v.index),f=new RegExp(`^[${null==o?void 0:o.join("")}\0]?$`).test(g);if(null!==o&&!f)return null;const h=m+v.index;let y=h+v[0].length;return i&&c.test(p.slice(y-1,y+1))&&(v[0]+=" ",y+=1),h<s.pos&&y>=s.pos?{range:{from:h,to:y},query:v[0].slice(n.length),text:v[0]}:null}const s=new i.hs("suggestion");function l({pluginKey:t=s,editor:e,char:n="@",allowSpaces:a=!1,allowedPrefixes:l=[" "],startOfLine:c=!1,decorationTag:d="span",decorationClass:u="suggestion",command:p=()=>null,items:m=()=>[],render:v=()=>({}),allow:g=()=>!0,findSuggestionMatch:f=r}){let h;const y=null==v?void 0:v(),w=new i.k_({key:t,view(){return{update:async(t,n)=>{var a,i,o,r,s,l,c;const d=null===(a=this.key)||void 0===a?void 0:a.getState(n),u=null===(i=this.key)||void 0===i?void 0:i.getState(t.state),v=d.active&&u.active&&d.range.from!==u.range.from,g=!d.active&&u.active,f=d.active&&!u.active,w=!g&&!f&&d.query!==u.query,_=g||v&&w,x=w||v,b=f;if(!_&&!x&&!b)return;const A=b&&!_?d:u,$=t.dom.querySelector(`[data-decoration-id="${A.decorationId}"]`);h={editor:e,range:A.range,query:A.query,text:A.text,items:[],command:t=>p({editor:e,range:A.range,props:t}),decorationNode:$,clientRect:$?()=>{var n;const{decorationId:a}=null===(n=this.key)||void 0===n?void 0:n.getState(e.state),i=t.dom.querySelector(`[data-decoration-id="${a}"]`);return(null==i?void 0:i.getBoundingClientRect())||null}:null},_&&(null===(o=null==y?void 0:y.onBeforeStart)||void 0===o||o.call(y,h)),x&&(null===(r=null==y?void 0:y.onBeforeUpdate)||void 0===r||r.call(y,h)),(x||_)&&(h.items=await m({editor:e,query:A.query})),b&&(null===(s=null==y?void 0:y.onExit)||void 0===s||s.call(y,h)),x&&(null===(l=null==y?void 0:y.onUpdate)||void 0===l||l.call(y,h)),_&&(null===(c=null==y?void 0:y.onStart)||void 0===c||c.call(y,h))},destroy:()=>{var t;h&&(null===(t=null==y?void 0:y.onExit)||void 0===t||t.call(y,h))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(t,i,o,r){const{isEditable:s}=e,{composing:d}=e.view,{selection:u}=t,{empty:p,from:m}=u,v={...i};if(v.composing=d,s&&(p||e.view.composing)){!(m<i.range.from||m>i.range.to)||d||i.composing||(v.active=!1);const t=f({char:n,allowSpaces:a,allowedPrefixes:l,startOfLine:c,$position:u.$from}),o=`id_${Math.floor(4294967295*Math.random())}`;t&&g({editor:e,state:r,range:t.range,isActive:i.active})?(v.active=!0,v.decorationId=i.decorationId?i.decorationId:o,v.range=t.range,v.query=t.query,v.text=t.text):v.active=!1}else v.active=!1;return v.active||(v.decorationId=null,v.range={from:0,to:0},v.query=null,v.text=null),v}},props:{handleKeyDown(t,e){var n;const{active:a,range:i}=w.getState(t.state);return a&&(null===(n=null==y?void 0:y.onKeyDown)||void 0===n?void 0:n.call(y,{view:t,event:e,range:i}))||!1},decorations(t){const{active:e,range:n,decorationId:a}=w.getState(t);return e?o.zF.create(t.doc,[o.NZ.inline(n.from,n.to,{nodeName:d,class:u,"data-decoration-id":a})]):null}}});return w}var c=n(13249),d=n(89989),u=n(13744),p=n(80717),m=n(2232),v=n(49264),g=n(83825);let f;function h(t,e){class n extends u.m{static name="tiptap-suggestion";static trigger=".tiptap-items";init(){(0,d.focus_handler)(this.el),this.active=this.items[0],m.A.add_event_listener(this.el,"keydown","tiptap-suggestion-keydown",(t=>{t.preventDefault(),t.stopPropagation();const e=this.items,n=this.active;if("ArrowDown"===t.code)if(n){let t=n?e.indexOf(n)+1:0;t>=e.length&&(t=0),this.active=e[t]}else this.active=e[0];else if("ArrowUp"===t.code)if(n){let t=n?e.indexOf(n)-1:0;t<0&&(t=e.length-1),this.active=e[t]}else this.active=e[0];else if("Enter"===t.code){const t=n?.dataset?.tiptapValue;if(!t)return;const e=n.querySelector("a");this.command(e,t)}})),m.A.add_event_listener(this.el,"click","tiptap-suggestion-click",(t=>{const e=t.target.closest("a"),n=p.A.acquire_attribute(e,"data-tiptap-value");n&&(t.preventDefault(),this.command(e,n))}))}command(t,n){const a=Object.fromEntries([...t.attributes].map((t=>[t.name,t.value])));e.command({"data-title":n,...a})}get active(){return this.el.querySelector(".tiptap-item.active")}set active(t){t&&(this.active?.classList.remove("active"),t.classList.add("active"))}get items(){return[...this.el.querySelectorAll(".tiptap-item")]}}return n}const y=t=>{let{app:e,name:n,char:o,plural:r}=t;return a.Node.create({name:n,content:"inline*",group:"inline",inline:!0,selectable:!1,atom:!0,isolating:!0,addOptions(){return{HTMLAttributes:{},url:null,renderLabel(t){let{options:e,node:n}=t;const a=(n.attrs["data-title"]||n.content?.content?.[0]?.text||"").replace(new RegExp(`^${e.suggestion.char}`),"");return`${e.suggestion.char}${a}`},suggestion:{char:o,pluginKey:new i.hs(n)}}},addAttributes(){const t={class:{},contenteditable:{},href:{},target:{},title:{},"data-id":{},"data-title":{},"data-pat-inject":{},"data-pat-forward":{},"data-pat-modal":{},"data-pat-switch":{},"data-pat-toggle":{},"data-pat-tooltip":{}};t[`data-${this.name}`]={default:""};for(const e of g.Ay.accessibility_attributes)t[e]={};return t},parseHTML(){return[{tag:`a[data-${this.name}]`}]},renderHTML(t){let{node:e,HTMLAttributes:n}=t;return["a",(0,a.mergeAttributes)(this.options.HTMLAttributes,n),this.options.renderLabel({options:this.options,node:e})]},renderText(t){let{node:e}=t;return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Enter:()=>!!f&&(f.tippy?.popper?.querySelector(".tiptap-items")?.dispatchEvent(new KeyboardEvent("keydown",{code:"Enter"})),!0),Backspace:t=>{let{editor:e}=t;return e.commands.command((t=>{let{tr:e,state:n}=t,a=!1;const{selection:i}=n,{empty:o,anchor:r}=i;return!!o&&(n.doc.nodesBetween(r-1,r,((t,n)=>{if(t.type.name===this.name)return a=!0,e.insertText(this.options.suggestion.char||"",n,n+t.nodeSize),!1})),a)}))}}},addProseMirrorPlugins(){var t=this;return this.options.suggestion.command=t=>{let{editor:e,range:n,props:a}=t;n.to=e.state.selection.$head.pos,e.chain().focus().insertContentAt(n,[{type:this.name,attrs:a},{type:"text",text:" "}]).run()},this.options.suggestion.render=()=>{let e;const n=async()=>{this.editor.off("selectionUpdate",e),await(0,c.B)({instance:f,pattern_name:"tiptap-suggestion"}),f=null};return{onStart:async n=>{const a=async function(){let{transaction:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{transaction:null},a=t.options.url,i=n.range.from+1,o=e?e.curSelection.$head.pos:n.range.to;const s=t.editor.state.doc.textBetween(i,o,"");a=s?a+s:a;return await(0,c.q)({url:a,editor:t.editor,instance:f,pattern:h(0,n),extra_class:`tiptap-${r||t.name}`})};e=v.A.debounce((async t=>{f=await a(t)}),200),f=await a(),this.editor.on("selectionUpdate",e)},onKeyDown:t=>{if(f&&("ArrowDown"===t.event.key||"ArrowUp"===t.event.key||"Enter"===t.event.key)){t.event.preventDefault(),t.event.stopPropagation();const e=document.querySelector(".tiptap-items");if(!e)return;e.dispatchEvent(new KeyboardEvent("keydown",{code:t.event.key}))}},onExit:()=>{n()}}},this.options.suggestion.allow=t=>{let{state:e,range:n}=t;const a=e.doc.resolve(n.from),i=e.schema.nodes[this.name];return!!a.parent.type.contentMatch.matchType(i)},[l({editor:this.editor,...this.options.suggestion})]}})}},89989:function(t,e,n){n.r(e),n.d(e,{TARGETS:function(){return o},focus_handler:function(){return r}});var a=n(2232),i=n(49264);const o=[];function r(t){t.setAttribute("tabindex","-1"),a.A.add_event_listener(t,"focus","tiptap-focusin",(async()=>{i.A.timeout(1),o.map((t=>t?.classList.add("tiptap-focus")))}),!0),a.A.add_event_listener(t,"blur","tiptap-focusout",(()=>{o.map((t=>t?.classList.remove("tiptap-focus")))}),!0)}},83825:function(t,e,n){e.Ay={add_search_params:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new URL(t,window.location.href);return`${n.origin}${n.pathname}?${new URLSearchParams([...Array.from(n.searchParams.entries()),...Object.entries(e)]).toString()}`},accessibility_attributes:["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-controls","aria-describedby","aria-disabled","aria-dropeffect","aria-expanded","aria-flowto","aria-grabbed","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","role"],is_url:t=>/(^\.?\.?\/|^[^\.]+:)/.test(t),is_mail:t=>/[^@\s]+@[^@\s]+\.[^@\s]+/.test(t)}}}]);
//# sourceMappingURL=40587.5728b02bbf53fb54bc0b.min.js.map