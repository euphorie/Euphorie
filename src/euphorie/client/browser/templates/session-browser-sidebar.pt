<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="euphorie"
>
<metal:aside-browser define-macro="aside-browser" meta:interpolation="true" i18n:domain="euphorie">
  <aside id="osc"
        tal:define="
        my_view nocall:context/session-browser-sidebar;
        webhelpers nocall:context/webhelpers;
        root_group my_view/get_root_group;
        root_parent root_group/parent|nothing;
        language my_view/portal/plone_portal_state/language;
        absolute_url here/absolute_url;
        zodb_path request/zodb_path|nothing;
        styles_override webhelpers/styles_override;
      ">
  <metal:include tal:define="id string:ra-browser" use-macro="context/@@includes/macros/osh"/>
  <metal:slot define-slot="aside-header">
    <form id="osc-header" class="pat-inject pat-autosubmit" action="${absolute_url}/@@${view/__name__}#browser">
      <tal:in_group condition="python: root_group and root_parent">
        <a class="back-button pat-inject"
           href="${absolute_url}/@@${view/__name__}?groupid=${root_parent/group_id|nothing}"
           data-pat-inject="source: #osc-header; target: #osc-header &amp;&amp; source: #osc; target: #osc"
           i18n:translate=""
        >Back</a>
        <h2 class="column-title">${root_group/fullname}</h2>
      </tal:in_group>

      <!--
      <tal:root condition="python: not root_group or not root_parent">
        <label class="pat-select bare">
          <select>
            <option i18n:translate="">Group by department</option>
            <option i18n:translate="">Group by tool</option>
            <option>Group by publication date</option>
            <option>Group by modification date</option>
            <option>Group by user</option>
            <option>Group by country</option>
            <option>Group by sector</option>
          </select>
        </label>
      </tal:root>
      -->

      <a class="no-label pat-modal iconified icon-plus"
         id="button-new-session-quick"
         href="${webhelpers/session_overview_url}/@@new-session.html#document-content"
         title="Start a new session"
         data-pat-modal="class: large"
         i18n:attributes="title link_start_session"
         i18n:translate="New"
      >New</a>
      <button id="button-osc-expand"
              tal:condition="webhelpers/use_publication_feature"
              class="no-label iconified icon-resize-full pat-toggle"
              data-pat-toggle="selector: body; value: osc-size-full osc-size-normal"
              i18n:attributes="title"
              title="Expand sidebar" i18n:translate="">Expand sidebar</button>

    </form>
  </metal:slot>

  <metal:slot define-slot="aside-sessions">
    <div id="navigation"
         tal:define="groups my_view/leaf_groups;">
      <style type="text/css" tal:condition="styles_override">
          ${styles_override}
      </style>
      <div class="miller-columns"
           id="miller-columns"
      >
        <form class="search-form pat-autosubmit pat-inject"
              data-pat-autosubmit="500ms"
              action="${absolute_url}/@@${view/__name__}#browser"
        >
          <fieldset>
            <label>
              <input name="SearchableText"
                     placeholder="Search"
                     type="search"
                     i18n:attributes="placeholder osc_search_placeholder"
              />
              <button hidden
                      type="submit"
                      i18n:translate="osc_search_placeholder"
              >Search</button>
            </label>
          </fieldset>
        </form>

        <div id="browser">
        <ul class="pat-navigation departments browser">
          <li class="group item type-department"
              tal:repeat="group groups;"
              tal:condition="not:zodb_path"
          >
            <a class="pat-inject field"
               href="${absolute_url}/@@${view/__name__}?groupid=${group/group_id}"
               data-pat-inject="source: #miller-columns::element; target: #miller-columns::element; &amp;&amp; source: #osc-header; target: #osc-header; history: record"
            >
              <strong class="object-name">${group/fullname}</strong></a>
          </li>
          <tal:session repeat="session sessions" define="sessions python:my_view.get_sessions_tree(zodb_path)">
            <tal:tool condition="nocall:tool" define="tool python:sessions[session]">
              <li class="object item type-risk-assessment">
                <span class="object-name field">
                  <a class="session-name pat-inject pat-switch"
                     href="${tool/absolute_url}?action=continue&amp;session=${session/id}"
                     data-pat-switch="selector: body; remove: sidebar-on; add: sidebar-off"
                     data-pat-inject="source: #osc; target: #osc; &amp;&amp; source: #content; target: #content;"
                  >${session/title}</a>
                </span>
                <span class="last-saved meta field"
                  ><tal:i18n i18n:translate="">Last saved</tal:i18n
                  > <time class="pat-display-time"
                        datetime="${value}"
                        data-pat-display-time="from-now: true; locale: ${language}"
                        tal:define="
                          value session/modified/isoformat|nothing;
                        "
                  >${value}</time
                ></span>
                <span class="date meta field" tal:condition="session/published"
                  ><span class="label">
                    <tal:i18n i18n:translate="label_published">published</tal:i18n
                    > <time class="pat-display-time"
                          datetime="${value}"
                          data-pat-display-time="from-now: true; locale: ${language}"
                          tal:define="
                            value session/published/isoformat|nothing;
                          "
                    >${value}</time
                  ></span
                ></span>
                <span class="field" tal:condition="not:session/published"></span>
                <span class="tool meta field"
                  ><tal:i18n i18n:translate="">based on</tal:i18n
                  > <a class="pat-inject pat-switch"
                     data-pat-switch="selector: body; remove: focus-*; add: focus-document &amp;&amp; selector: body; remove: sidebar-on; add: sidebar-off &amp;&amp; selector: body; remove: osc-s-*; add: osc-s-off; store: local &amp;&amp; selector: body; remove: osc-size-*; add: osc-size-normal"
                     data-pat-inject="history: record"
                     href="${tool/absolute_url}?groupid=${request/groupid|string:}#content"
                     title="${tool/title}"
                  >${tool/title}</a
                ></span>
                <a href="${tool/absolute_url}/@@more_menu?sessionid=${session/id}#more-menu"
                   class="more-menu iconified icon-ellipsis pat-tooltip inactive"
                   data-pat-tooltip="source: ajax; position-list: tl"
                   i18n:translate=""
                >More</a>
              </li>
            </tal:tool>
          </tal:session>
          <li tal:condition="not:my_view/has_content">
            <p class="pat-message notice"
               tal:condition="not:my_view/searchable_text"
               i18n:translate=""
            >
              No risk assessments are available for this selection.
            </p>
            <p class="pat-message notice"
               tal:condition="my_view/searchable_text"
               i18n:translate="osc_search_no_results_for_search"
            >
              No risk assessments were found for this selection.
            </p>
          </li>
        </ul>
      </div>
      </div>
    </div>
  </metal:slot>
</aside>
</metal:aside-browser>
</html>
