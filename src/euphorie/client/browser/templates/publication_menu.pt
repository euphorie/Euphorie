<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="euphorie"
>
  <body>
    <div id="publication-menu"
         hidden="hidden"
         tal:define="
           webhelpers python:view.webhelpers;
           session view/context/session;
           last_modifier session/last_modifier|nothing;
           toLocalizedTime nocall: here/@@plone/toLocalizedTime;
           language view/portal/plone_portal_state/language;
         "
    >
      <div class="pat-message notice"
           tal:condition="last_modifier"
      >
        <p tal:define="
             last_publisher session/last_publisher|nothing;
           "
           tal:condition="session/published"
        >
          <!-- Diplay this paragraph only when the assessment is published. -->
          <strong><tal:i18n i18n:translate="label_published">Published</tal:i18n>
            <time class="pat-display-time"
                  datetime="${value}"
                  data-pat-display-time="from-now: true; locale: ${language}"
                  tal:define="
                    value python:webhelpers.timezoned_date(session.published);
                  "
            >${value}</time>
            <tal:publisher condition="last_publisher">
              <tal:i18n i18n:translate="by">by</tal:i18n>
              <a href="mailto:${last_publisher/email}">${last_publisher/email}</a>
            </tal:publisher>
          </strong>
        </p>
        <p i18n:translate="last_edited_by">Last edited by
          <a href="mailto:${last_modifier/email}"
             i18n:name="name"
          >${last_modifier/email}</a>
          on
          <tal:i18n i18n:name="date">${python:toLocalizedTime(session.modified, long_format=1)}</tal:i18n>.
        </p>
      </div>
      <tal:can_publish condition="webhelpers/can_publish_session">
        <ul class="menu"
            tal:switch="session/review_state"
        >
          <tal:case case="string:private">
            <li>
              <form class="pat-inject"
                    action="${here/absolute_url}/@@publication_date/set_date#content"
              >
                <button class="icon-lock close-panel"
                        type="submit"
                        i18n:translate=""
                >Publish Risk Assessment</button>
              </form>
            </li>
          </tal:case>
          <tal:case case="string:published">
            <li>
              <form class="pat-inject"
                    action="${here/absolute_url}/@@publication_date/unset_date#content"
              >
                <button class="icon-lock-open close-panel"
                        type="submit"
                        i18n:translate=""
                >Unpublish Risk Assessment</button>
              </form>
            </li>
            <li>
              <form class="pat-inject"
                    action="${here/absolute_url}/@@publication_date/reset_date#content"
              >
                <button class="icon-arrows-cw"
                        type="submit"
                        i18n:translate=""
                >Refresh publication date</button>
              </form>
            </li>
          </tal:case>
        </ul>
      </tal:can_publish>
      <div class="pat-message notice"
           tal:condition="not:last_modifier"
      >
        <p i18n:translate="">No information about the last editor is available.</p>
      </div>
    </div>
  </body>
</html>
