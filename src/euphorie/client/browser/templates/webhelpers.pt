<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      meta:interpolation="true"
      i18n:domain="euphorie"
>

  <metal:headers define-macro="headers">
    <meta http-equiv="Content-Type"
          content="text/html; charset=UTF-8"
    />
    <meta http-equiv="X-UA-Compatible"
          content="IE=edge"
    />
    <meta name="viewport"
          content="width=device-width, initial-scale=1"
    />
    <link rel="icon" type="image/png" href="${style_url}/apple-touch-icon.png" />
  </metal:headers>

  <metal:home define-macro="homelink"
              meta:interpolation="true"
              tal:define="
                logo_mode webhelpers/logoMode;
              "
  >
    <li id="home">
      <a href="${webhelpers/country_url}"
         tal:condition="python:logo_mode=='alien'"
      >${webhelpers/sector/title}</a>
      <a href="${webhelpers/country_url}"
         tal:condition="python:logo_mode=='native'"
      >
        <strong i18n:translate="title_tool">OiRA - Online interactive Risk Assessment</strong><br />
        <span tal:omit-tag=""
              i18n:translate="oira_name_line_1"
        >Online interactive</span><br />
        <span tal:omit-tag=""
              i18n:translate="oira_name_line_2"
        >Risk Assessment</span></a>
    </li>
  </metal:home>

  <metal:topnav define-macro="toplevel-navigation">
    <ul id="navigation">
      <metal:home use-macro="webhelpers/macros/homelink" />
      <li tal:condition="not:webhelpers/is_guest_account"><a href="${webhelpers/country_url}/logout"
           i18n:translate="navigation_logout"
        >Logout</a></li>
      <li tal:condition="not:webhelpers/is_guest_account"><a href="${webhelpers/session_overview_url}"
           i18n:translate="navigation_surveys"
        >My Assessments</a></li>
      <li><a href="${webhelpers/help_url}#${site_section}"
           i18n:translate="navigation_help"
        >Help</a></li>
      <li tal:condition="python:site_section not in ['preparation', 'session', 'sessions']"><a href="${webhelpers/survey_url}/status"
           i18n:translate="navigation_status"
        >Status</a></li>
      <li tal:condition="not:webhelpers/is_guest_account"><a href="${webhelpers/country_url}/account-settings"
           i18n:translate="navigation_settings"
        >Settings</a></li>
      <li tal:condition="webhelpers/is_guest_account"><a href="${webhelpers/country_url}/@@login?came_from=${context/absolute_url}"
           i18n:translate="Sign in"
        >Sign in</a></li>
    </ul>
  </metal:topnav>

  <metal:css define-macro="css" meta:interpolation="true">
    <link rel="stylesheet" href="${webhelpers/css_url}" type="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  </metal:css>

  <metal:javascript define-macro="javascript" meta:interpolation="true">
    <script src="${webhelpers/js_url}" type="text/javascript"></script>
  </metal:javascript>

  <metal:survey define-macro="survey_tree_inner"
                meta:interpolation="true"
                tal:define="
                  target_inject python:page_section=='identification' and '#step-2' or '#step-4';
                "
  >
    <ol tal:condition="exists:tree"
        class="${python:tree['leaf_module'] and 'questions' or ''}"
    >
      <tal:items repeat="item tree/children">
        <li class="${python: '%s %s' % (item['class'], 'submodule' if item['type'] == 'module' and item['depth']&gt;1 else '')}"
            id="${python:item['css_id']}"
            title="${python:'%s. %s' % (item['number'], item['title']) if tree['leaf_module'] else None}"
            tal:condition="python: item['type']!='location'"
        >
          <a class="pat-switch pat-inject"
             href="${item/url}"
             data-pat-inject="history: record; source: #main-content; target: #main-content ${python:item['type'] == 'module' and '&amp;&amp; source:
             {target}; target: {target}'.format(target=target_inject) or None} &amp;&amp; source: #status; target: #status"
             data-pat-switch="selector: #main; remove: sidebar-*; add: sidebar-off"
          >
            <strong class="${python:'counter' if item['type']=='module' else 'number'}">${item/number}</strong>
             ${item/title}
          </a>

          <tal:subtree define="
                         tree python:item;
                       "
                       condition="python:item['children']"
          >
            <metal:call use-macro="webhelpers/macros/survey_tree_inner" />
          </tal:subtree>
        </li>
        <tal:location condition="python: item['type']=='location'">
          <h4 class="location-tag">${item/title}</h4>
          <tal:subtree define="
                         tree python:item;
                       "
                       condition="python:item['children']"
          >
            <metal:call use-macro="webhelpers/macros/survey_tree_inner" />
          </tal:subtree>
        </tal:location>

      </tal:items>
    </ol>
  </metal:survey>

  <metal:survey define-macro="survey_tree"
                meta:interpolation="true"
  >

    <div class="topics"
      id="${python:page_section=='identification' and 'step-2-topics' or
            page_section=='actionplan' and 'step-4-topics' or ''}"
      tal:condition="exists:tree"
    >
      <metal:call use-macro="webhelpers/macros/survey_tree_inner" />
      <ul class="legend">
        <li class="unvisited"
            i18n:translate=""
        >Unvisited</li>
        <li class="postponed"
            i18n:translate=""
        >Postponed</li>
        <li class="answered"
            i18n:translate=""
        >Risk not present</li>
        <li class="answered risk"
            i18n:translate=""
        >Risk present</li>
      </ul>
    </div>
  </metal:survey>

  <metal:risk_identification define-macro="risk_identification">
    <fieldset class="vertical"
              id="${view/risk_number}"
              tal:define="
                always_present risk/risk_always_present|nothing;
              "
    >

      <!-- Existing Measures -->
      <fieldset class="pat-checklist pat-clone ${python:'pat-inject pat-autosubmit pat-subform' if (webhelpers.use_training_module or webhelpers.integrated_action_plan) else None}"
                id="risk_identification_form"
               data-pat-inject="${python:'source: #slide-content-1; target: #slide-content-1;' if webhelpers.use_training_module else None} ${python:'&amp;&amp; source: #panel-action-plan; target: #panel-action-plan' if webhelpers.integrated_action_plan else None}"
                data-pat-clone="template: #in-place-measure-template; trigger-element: #add-in-place-measure-button; remove-confirmation: Sind Sie sicher, dass Sie die eingetragene bestehende SchutzmaÃŸnahme entfernen wollen?; remove-behaviour: none"
      >
        <tal:existing_measures condition="view/show_existing_measures">
          <article class="pat-rich">
            <p tal:content="structure view/intro_extra"></p>
          </article>
          <tal:measures define="
                          measures view/get_existing_measures_with_activation;
                        "
                        repeat="measure measures"
          >
            <div class="label" tal:condition="python: measure['plan_type']=='in_place_standard'"
               tal:define="description measure/text">
              <label class="label-fragment-title pat-rich"
              ><input checked="${python:measure['active'] and 'checked' or None}"
                     name="measure-standard-${measure/solution_id}"
                     type="checkbox"
              /><tal:measure replace="structure measure/title" /></label>
                <span class="label-fragment-description pat-rich" tal:condition="description"><pre class="pat-markdown" tal:content="structure description">Description</pre></span>
            </div>

            <label tal:condition="python: measure['plan_type']=='in_place_custom'"
                   class="clone">
              <input checked="checked"
                     disabled="disabled"
                     name="measure-custom-${measure/solution_id}"
                     type="checkbox"
              />
              <textarea cols="50"
                        autofocus="autofocus"
                        name="measure-custom-${measure/solution_id}"
                        placeholder="${view/placeholder_add_extra}"
                        rows="3"
                        tal:content="structure python:measure['text']"
              ></textarea>
              <button class="icon-trash iconified remove-clone"
                      title="${view/button_remove_extra}"
              >Remove</button>

            </label>
          </tal:measures>
          <input type="hidden" name="handle_measures_in_place" value="1" />

          <label class="clone"
                 id="in-place-measure-template"
                 hidden="hidden"
          >
            <input class="pat-autofocus"
                   autofocus="autofocus"
                   checked="checked"
                   disabled="disabled"
                   name="use-new-measure-#{1}"
                   type="checkbox"
            />
            <textarea cols="50"
                      name="new-measure-#{1}"
                      placeholder="${view/placeholder_add_extra}"
                      rows="3"
            ></textarea>
            <button class="icon-trash iconified remove-clone"
                    title="${view/button_remove_extra}"
            >Remove</button>
          </label>
        </tal:existing_measures>
      </fieldset>

      <div class="button-bar cloning"
           tal:condition="python:view.show_existing_measures"
      >
        <button class="add-clone small pat-button icon-plus-circle"
                id="add-in-place-measure-button"
                title="${view/button_add_extra}"
                type="button"
        >${view/button_add_extra}</button>
      </div>
      <!-- END Existing measures -->

      <!-- Yes / No -->
      <fieldset class="pat-checklist radio pat-rich">
        <tal:existing condition="python:view.show_existing_measures and not always_present">
          <p tal:condition="view/intro_questions" tal:content="structure view/intro_questions"></p>
        </tal:existing>
        <p class="byline"
           tal:condition="python:always_present and view.show_explanation_on_always_present_risks"
           i18n:translate="explanation_risk_always_present"
        >This risk was automatically set as being present. You cannot change this.</p>
        <tal:answers condition="not:always_present">
          <input name="answer:default"
                 type="hidden"
                 value="postponed"
          />
            <label class="yes"><input checked="${python:'checked' if context.identification=='yes' else None}"
                     name="answer"
                     type="radio"
                     value="yes"
              /><tal:answer replace="structure view/answer_yes" /></label>
            <label class="no"><input checked="${python:'checked' if context.identification=='no' else None}"
                     name="answer"
                     type="radio"
                     value="no"
              /><tal:answer replace="structure view/answer_no" /></label>
          <label class="not-applicable"
                 tal:condition="risk/show_notapplicable|nothing"
          ><input checked="${python:'checked' if context.identification=='n/a' else None}"
                   name="answer"
                   type="radio"
                   value="n/a"
            /><tal:answer replace="structure view/answer_na" /></label>
        </tal:answers>
        <tal:always_present condition="always_present"><input name="answer"
                 type="hidden"
                 value="${view/always_present_answer}"
          /></tal:always_present>
      </fieldset>
    </fieldset>
  </metal:risk_identification>

  <metal:risk_evaluation define-macro="risk_evaluation">
    <fieldset class="pat-well notice pat-depends vertical evaluation"
              id="evaluation"
              data-pat-depends="${view/evaluation_condition}; transition: slide"
              tal:define="
                evaluation_method python:risk.type in ('policy', 'top5') and risk.type or risk.evaluation_method;
              "
              tal:condition="not:view/skip_evaluation"
    >
      <p class="problem-description"><strong>${view/risk/problem_description}</strong></p>
      <tal:block condition="python:evaluation_method=='calculated'">
        <p class="instruction"
           i18n:translate="help_calculated_evaluation"
        >Please answer the following questions. As a result of your answers the system will calculate the priority of the risk. You will be able to modify the priority later.</p>
        <tal:get define="
                   algorithm python:view.evaluation_algorithm(risk);
                 "
        >
          <tal:kinney condition="python:algorithm!='french'">
            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/probability;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_probability">What is the chance of this risk occurring?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                     i18n:translate=""
                >${view/description_probability}</dfn>
              </legend>
              <label><input checked="${python:'checked' if value==1 else None}"
                       name="probability:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="probability_small">Small</tal:span></label>
              <label><input checked="${python:'checked' if value==3 else None}"
                       name="probability:int"
                       type="radio"
                       value="3"
                />
                <tal:span i18n:translate="probability_medium">Medium</tal:span></label>
              <label><input checked="${python:'checked' if value==5 else None}"
                       name="probability:int"
                       type="radio"
                       value="5"
                />
                <tal:span i18n:translate="probability_large">Large</tal:span></label>
            </fieldset>

            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/frequency;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_frequency">How often are people exposed to this risk?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_frequency}</dfn>
              </legend>
              <label><input checked="${python:'checked' if value==1 else None}"
                       name="frequency:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="frequency_almost_never">Almost never</tal:span></label>
              <label><input checked="${python:'checked' if value==4 else None}"
                       name="frequency:int"
                       type="radio"
                       value="4"
                />
                <tal:span i18n:translate="frequency_regularly">Regularly</tal:span></label>
              <label><input checked="${python:'checked' if value==7 else None}"
                       name="frequency:int"
                       type="radio"
                       value="7"
                />
                <tal:span i18n:translate="frequency_constantly">Constantly</tal:span></label>
            </fieldset>

            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/effect;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_effect">What is the severity of the damage?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_severity}</dfn>
              </legend>
              <label><input checked="${python:'checked' if value==1 else None}"
                       name="effect:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="effect_injury_no_absence">Weak severity</tal:span></label>
              <label><input checked="${python:'checked' if value==5 else None}"
                       name="effect:int"
                       type="radio"
                       value="5"
                />
                <tal:span i18n:translate="effect_injury_with_absence">Significant severity</tal:span></label>
              <label><input checked="${python:'checked' if value==10 else None}"
                       name="effect:int"
                       type="radio"
                       value="10"
                />
                <tal:span i18n:translate="effect_permanent_damage">High (very high) severity</tal:span></label>
            </fieldset>
          </tal:kinney>

          <tal:french condition="python:algorithm=='french'">
            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/effect;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_effect">What is the severity of the damage?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_severity}</dfn>
              </legend>
              <label>
                <input checked="${python:'checked' if value==1 else None}"
                       name="severity:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="severity_weak">Weak</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="No need to stop working"
                     i18n:attributes="title severity_weak_help;"
                ></dfn>
              </label>
              <label><input checked="${python:'checked' if value==5 else None}"
                       name="severity:int"
                       type="radio"
                       value="5"
                />
                <tal:span i18n:translate="severity_not_severe">Not very severe</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Need to stop working for less than 3 days"
                     i18n:attributes="title severity_not_severe_help"
                ></dfn>
              </label>
              <label><input checked="${python:'checked' if value==7 else None}"
                       name="severity:int"
                       type="radio"
                       value="7"
                />
                <tal:span i18n:translate="severity_severe">Severe</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Need to stop working for more than 3 days"
                     i18n:attributes="title severity_severe_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==10 else None}"
                       name="severity:int"
                       type="radio"
                       value="10"
                />
                <tal:span i18n:translate="severity_very_severe">Very severe</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Irreversible injury, incurable illness, death"
                     i18n:attributes="title severity_very_severe_help;"
                ></dfn>
              </label>
            </fieldset>

            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/frequency;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_frequency">How often are people exposed to this risk?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_frequency}</dfn>
              </legend>
              <label>
                <input checked="${python:'checked' if value==1 else None}"
                       name="frequency:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="frequency_french_rare">Rare</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Once per year"
                     i18n:attributes="title frequency_french_rare_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==3 else None}"
                       name="frequency:int"
                       type="radio"
                       value="3"
                />
                <tal:span i18n:translate="frequency_french_not_often">Not very often</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Once per month"
                     i18n:attributes="title frequency_french_not_often_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==7 else None}"
                       name="frequency:int"
                       type="radio"
                       value="7"
                />
                <tal:span i18n:translate="frequency_french_often">Often</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Once per week"
                     i18n:attributes="title frequency_french_often_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==9 else None}"
                       name="frequency:int"
                       type="radio"
                       value="9"
                />
                <tal:span i18n:translate="frequency_french_regularly">Very often or regularly</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Minimum once per day"
                     i18n:attributes="title frequency_french_regularly_help;"
                ></dfn>
              </label>
            </fieldset>
          </tal:french>
        </tal:get>
      </tal:block>

      <tal:block condition="python:evaluation_method=='direct'">
        <fieldset class="pat-checklist radio"
                  tal:define="
                    value context/priority;
                  "
        >
          <p i18n:translate="header_risk_priority">Select the priority of this risk</p>
          <label><input checked="${python:'checked' if value=='low' else None}"
                   name="priority"
                   type="radio"
                   value="low"
            />
            <tal:span i18n:translate="priority_low">Low</tal:span></label>
          <label><input checked="${python:'checked' if value=='medium' else None}"
                   name="priority"
                   type="radio"
                   value="medium"
            />
            <tal:span i18n:translate="priority_medium">Medium</tal:span></label>
          <label><input checked="${python:'checked' if value=='high' else None}"
                   name="priority"
                   type="radio"
                   value="high"
            />
            <tal:span i18n:translate="priority_high">High</tal:span></label>
        </fieldset>
      </tal:block>

      <tal:block condition="python:evaluation_method in ('top5', 'policy', 'fixed')">
        <p i18n:translate="description_automatic_evaluation">The risk evaluation has been automatically done by the tool. You will be able to change the priority for this risk &ndash; if you consider it necessary &ndash; in the action plan.</p>
      </tal:block>
    </fieldset>
  </metal:risk_evaluation>

  <metal:legal_references define-macro="legal_references">
    <section class="legal-references"
             tal:condition="view/has_legal"
    >
      <h4 i18n:translate="label_legal_reference">Legal and policy references</h4>
      <tal:legal replace="structure risk/legal_reference">
        The requirements for fridges are defined in section 13.1 section a
        of the health code.
      </tal:legal>
    </section>
  </metal:legal_references>

  <metal:additional_files define-macro="additional_files">
    <section class="more-information"
             tal:condition="view/has_files"
    >
      <h4 tal:condition="python:risk.Type()=='Risk'"
          i18n:translate="header_additional_resources"
      >Additional resources to assess the risk</h4>
      <h4 tal:condition="python:risk.Type()=='Module'"
          i18n:translate="header_additional_resources_module"
      >Additional resources for this module</h4>
      <ul>
        <li class="icon-download"
            tal:condition="nocall:risk/file1|nothing"
        >
          <a href="${risk/absolute_url}/download/file1"><tal:caption condition="risk/file1_caption|nothing">${risk/file1_caption} (${risk/file1/filename})</tal:caption><tal:nocaption condition="not:risk/file1_caption|nothing">${risk/file1/filename}</tal:nocaption></a>
        </li>
        <li class="icon-download"
            tal:condition="nocall:risk/file2|nothing"
        >
          <a href="${risk/absolute_url}/download/file2"><tal:caption condition="risk/file2_caption|nothing">${risk/file2_caption} (${risk/file2/filename})</tal:caption><tal:nocaption condition="not:risk/file2_caption|nothing">${risk/file2/filename}</tal:nocaption></a>
        </li>
        <li class="icon-download"
            tal:condition="nocall:risk/file3|nothing"
        >
          <a href="${risk/absolute_url}/download/file3"><tal:caption condition="risk/file3_caption|nothing">${risk/file3_caption} (${risk/file3/filename})</tal:caption><tal:nocaption condition="not:risk/file3_caption|nothing">${risk/file3/filename}</tal:nocaption></a>
        </li>
        <li class="icon-download"
            tal:condition="nocall:risk/file4|nothing"
        >
          <a href="${risk/absolute_url}/download/file4"><tal:caption condition="risk/file4_caption|nothing">${risk/file4_caption} (${risk/file4/filename})</tal:caption><tal:nocaption condition="not:risk/file4_caption|nothing">${risk/file4/filename}</tal:nocaption></a>
        </li>
      </ul>
    </section>
  </metal:additional_files>

  <metal:risk_comments define-macro="risk_comments">
    <fieldset class="pat-collapsible risk-module ${default_state|nothing}">
      <legend i18n:translate="heading_comments">
            Comments
      </legend>

      <fieldset class="vertical"
                id="comments"
      >
        <textarea class="span-15"
                  id="comment"
                  name="comment:utf8:ustring"
                  placeholder="Please leave any comments you may have on the question above in this field. These comments will be used in the action plan."
                  rows="3"
                  tal:content="context/comment"
                  i18n:attributes="placeholder label_comment"
        >
        </textarea>
      </fieldset>
    </fieldset>
  </metal:risk_comments>

  <metal:action_plan define-macro="action_plan"
                     tal:define="solutions view/solutions_available_for_action_plan|nothing;
                                 action_plans view/context/custom_measures;
     ">
    <tal:solutions condition="solutions">
      <div class="pat-modal-pop-over pat-collapsible closed pat-depends"
           id="measures-panel"
           data-pat-collapsible="open-trigger: #add-standard-measures; close-trigger: #close-standard-measures"
           data-pat-depends="${view/solutions_condition}"
      >
        <h2 class="title"
            i18n:translate=""
        >
          Standard measures
        </h2>
        <section class="pat-rich description">
          <p i18n:translate="label_select_measure">
            Select one or more of the known common measures provided.
          </p>
        </section>
        <div class="pat-checklist pat-pick-list free-form">
          <label class="item"
                 tal:repeat="solution solutions"
          >
            <input id="sm-${solution/id}"
                   checked="${python: 'checked' if solution['id'] in view.active_standard_measures else None}"
                   name="sm-${solution/id}"
                   type="checkbox"
            />
            <span class="text">${solution/description}</span>
            <span class="functions"><em class="small pat-button icon-plus-circle"
                  i18n:translate="button_add"
              >Add</em></span>
          </label>
        </div>
      </div>
      <button id="close-standard-measures"
              type="button">Close panel</button>
    </tal:solutions>

    <div class="measures pat-clone"
         id="action_plan_form"
         data-pat-clone="template: #measure-template; trigger-element: #add-measure-button; remove-behaviour: none; remove-confirmation: ${view/delete_confirmation}"
    >

      <!-- Existing Measures -->
      <tal:existing_measures define="
                               measures view/get_existing_measures;
                             "
                             condition="python:webhelpers.get_phase()=='actionplan' and view.use_existing_measures"
      >
        <div class="measure pat-collapsible"
             tal:repeat="measure measures"
        >
          <h2><tal:translate i18n:translate="label_implemented_measure">Implemented measure</tal:translate>
          ${repeat/measure/number}
          </h2>
          <h4 i18n:translate="label_description">Description</h4>
          <div class="pat-rich">
            <pre class="pat-markdown" tal:content="structure measure/action">Action</pre>
          </div>
        </div>
      </tal:existing_measures>


      <tal:solutions repeat="solution solutions">
        <div class="measure pat-collapsible pat-depends"
             data-pat-depends="condition: sm-${solution/id};"
        >
          <h2>
          ${solution/description}
          </h2>
          <p class="functions">
            <a class="icon-trash pat-forward"
               href="#pick-sm-${solution/id}"
               title="Remove this measure"
               data-pat-forward="selector: #sm-${solution/id}"
               i18n:attributes="title label_remove_measure"
               i18n:translate=""
            >Remove</a>
          </p>
          <input name="measure.plan_type:records"
                 type="hidden"
                 value="measure_standard"
          />
          <input name="measure.solution_id:records"
                 type="hidden"
                 value="${solution/id}"
          />
          <input name="measure.action:utf8:ustring:records"
                 type="hidden"
                 value="${solution/action}"
          />
          <input name="measure.requirements:utf8:ustring:records"
                 type="hidden"
                 value="${solution/requirements}"
          />
          <section class="pat-rich">
            <h4 i18n:translate="label_description">
              Description
            </h4>
            <div class="pat-rich">
              <pre class="pat-markdown" tal:content="structure solution/action">Action</pre>
            </div>
            <tal:requirements condition="python: 'requirements' not in view.skip_fields and solution['requirements']">
              <h4 i18n:translate="label_expertise">
                Expertise
              </h4>
              <p>
                ${solution/requirements}
              </p>
            </tal:requirements>
          </section>
          <fieldset class="vertical"
                    tal:define="
                      measure python:view.active_standard_measures.get(solution['id'], None);
                    "
          >
            <label>
              <tal:span i18n:translate="label_action_plan_responsible">Who is responsible?</tal:span>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_responsible_tooltip"
              >Appoint someone in your company to be responsible for the implementation of this measure. This person will have the authority to take the steps described in the Plan and/or the responsibility to ensure that they are carried out.</dfn>
              <input class="responsible"
                     name="measure.responsible:utf8:ustring:records"
                     type="text"
                     value="${python:measure.responsible if measure else None}"
              />
            </label>
            <label class="currency"
                   tal:condition="python: 'budget' not in view.skip_fields"
            >
              <tal:span i18n:translate="label_action_plan_budget">Budget</tal:span>
              <em class="message error"
                  tal:condition="exists:errors/budget"
                  i18n:translate="error_invalid_budget"
              >Please enter the budget in whole Euros.</em>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_budget_tooltip"
              >Although some measures do not cost any money, most do. The measures should therefore be budgeted for; include them in the annual budget round if necessary.</dfn>
              <span class="composed currency-field">
                <input class="currency"
                       id="solution-budget-${solution/id}"
                       min="0"
                       name="measure.budget:records"
                       type="number"
                       value="${python:measure.budget if measure else None}"
                />
              </span>
            </label>

            <label tal:define="
                     date_error exists:errors/planning_start_date;
                   "
            >
              <tal:label i18n:translate="label_action_plan_start">Planning start</tal:label>
              <input class="pat-date-picker"
                     id="solution-planning-start-${solution/id}"
                     name="measure.planning_start:records"
                     type="text"
                     value="${python:measure.planning_start if measure else None}"
                     data-pat-date-picker="behavior: styled; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json"
                     data-pat-validation="${python:u'type: date; not-after: #solution-planning-end-{number}; message-date: {message}'.format(number=solution['id'], message=view.message_date_before) if 'planning_end' not in view.skip_fields else None}"
              />
            </label>

            <label tal:define="
                     date_error exists:errors/planning_end_date;
                   "
                   tal:condition="python: 'planning_end' not in view.skip_fields"
            >
              <tal:label i18n:translate="label_action_plan_end">Planning end</tal:label>

              <input class="pat-date-picker"
                     id="solution-planning-end-${solution/id}"
                     name="measure.planning_end:records"
                     type="text"
                     value="${python:measure.planning_end if measure else None}"
                     data-pat-date-picker="behavior: styled; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json"
                     data-pat-validation="type: date; not-before: #solution-planning-start-${solution/id}; message-date: ${view/message_date_after}"
              />
            </label>

          </fieldset>
        </div>
      </tal:solutions>

      <tal:actionplans repeat="actionplan action_plans">
        <div class="measure clone pat-collapsible"
        >
          <h2><tal:span condition="not:view/use_existing_measures"
                      i18n:translate="Measure"
            >Measure</tal:span>
            <tal:span condition="view/use_existing_measures"
                      i18n:translate="Additional Measure"
            >Additional Measure</tal:span>
          ${repeat/actionplan/number}
          </h2>
          <input name="measure.id:records"
                 type="hidden"
                 value="${actionplan/id}"
          />
          <input name="measure.plan_type:records"
                 type="hidden"
                 value="measure_custom"
          />
          <p class="functions">
            <a class="icon-trash remove-clone"
               i18n:translate="label_remove_measure"
            >Delete this measure</a>
          </p>

          <fieldset class="vertical"
                    id="fields-${repeat/actionplan/number}"
          >
            <label><tal:label i18n:translate="label_description">Description</tal:label>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_tooltip"
              >Describe: 1) what is your general approach to eliminate or (if the risk is not avoidable) reduce the risk; 2) the specific action(s) required to implement this approach (to eliminate or to reduce the risk)</dfn>
              <textarea class="actionPlan"
                        name="measure.action:utf8:ustring:records"
                        placeholder="General approach (to eliminate or reduce the risk)"
                        rows="3"
                        type="text"
                        tal:content="actionplan/action|nothing"
                        i18n:attributes="placeholder label_measure_action_plan"
              ></textarea>
            </label>
            <tal:requirements condition="python: 'requirements' not in view.skip_fields">
              <label><tal:label i18n:translate="label_expertise">Expertise</tal:label>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                     i18n:translate="actionplan_requirements_tooltip"
                >Describe the level of expertise needed to implement the measure, for instance &ldquo;common sense (no OSH knowledge required)&rdquo;, &ldquo;no specific OSH expertise, but minimum OSH knowledge or training and/or consultation of OSH guidance required&rdquo;, or &ldquo;OSH expert&rdquo;. You can also describe here any other additional requirement (if any).</dfn>
                <textarea class="requirements"
                          name="measure.requirements:utf8:ustring:records"
                          placeholder="Level of expertise and/or requirements needed"
                          rows="3"
                          tal:content="actionplan/requirements|nothing"
                          i18n:attributes="placeholder label_measure_requirements"
                ></textarea>
              </label>
            </tal:requirements>
          </fieldset>

          <fieldset class="vertical"
                    tal:define="
                      number repeat/actionplan/number;
                    "
          >
            <label>
              <tal:span i18n:translate="label_action_plan_responsible">Who is responsible?</tal:span>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_responsible_tooltip"
              >Appoint someone in your company to be responsible for the implementation of this measure. This person will have the authority to take the steps described in the Plan and/or the responsibility to ensure that they are carried out.</dfn>
              <input class="responsible"
                     name="measure.responsible:utf8:ustring:records"
                     type="text"
                     value="${actionplan/responsible|nothing}"
              />
            </label>
            <label class="${python:'error' if exists('errors/budget') else None}"
                   tal:condition="python: 'budget' not in view.skip_fields"
            >
              <tal:span i18n:translate="label_action_plan_budget">Budget</tal:span>
              <em class="message error"
                  tal:condition="exists:errors/budget"
                  i18n:translate="error_invalid_budget"
              >Please enter the budget in whole Euros.</em>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_budget_tooltip"
              >Although some measures do not cost any money, most do. The measures should therefore be budgeted for; include them in the annual budget round if necessary.</dfn>
              <span class="composed currency-field">
                <input class="currency"
                       id="input-budget-${number}"
                       min="0"
                       name="measure.budget:records"
                       type="number"
                       value="${actionplan/budget|nothing}"
                />
              </span>
            </label>

            <label tal:define="
                     date_error exists:errors/planning_start_date;
                   "
            >
              <tal:label i18n:translate="label_action_plan_start">Planning start</tal:label>
              <input class="pat-date-picker"
                     id="planning-start-${number}"
                     name="measure.planning_start:records"
                     type="date"
                     value="${actionplan/planning_start|nothing}"
                     data-pat-date-picker="behavior: styled; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json"
                     data-pat-validation="${python:u'type: date; not-after: #planning-end-{number}; message-date: {message}'.format(number=number, message=view.message_date_before) if 'planning_end' not in view.skip_fields else None}"
              />
            </label>

            <label tal:define="
                     date_error exists:errors/planning_end_date;
                   "
                   tal:condition="python: 'planning_end' not in view.skip_fields"
            >
              <tal:label i18n:translate="label_action_plan_end">Planning end</tal:label>

              <input class="pat-date-picker"
                     id="planning-end-${number}"
                     name="measure.planning_end:records"
                     type="date"
                     value="${actionplan/planning_end|nothing}"
                     data-pat-date-picker="behavior: styled; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json"
                     data-pat-validation="type: date; not-before: #planning-start-${number}; message-date: ${view/message_date_after}"
              />
            </label>
          </fieldset>
        </div>
      </tal:actionplans>
    </div>

    <div class="button-bar">
      <tal:solutions condition="solutions">
        <button class="pat-button icon-plus-circle pat-depends ${view/style_buttons}"
                id="add-standard-measures"
                title="Add another measure"
                type="button"
                data-pat-depends="${view/solutions_condition}"
                i18n:translate="label_select_standard_measures"
        >Select standard measures</button>
      </tal:solutions>
      <button class="add-clone pat-button icon-plus-circle ${view/style_buttons}"
              id="add-measure-button"
              title="Add another measure"
              type="button"
              i18n:translate="label_extra_add_measure"
      >Add an extra measure</button>
    </div>

    <div class="measure pat-collapsible"
         id="measure-template"
         hidden="hidden"
    >

      <h2><tal:span condition="not:view/use_existing_measures"
                  i18n:translate="Measure"
        >Measure</tal:span>
        <tal:span condition="view/use_existing_measures"
                  i18n:translate="Additional Measure"
        >Additional Measure</tal:span>
      #{1}
      </h2>
      <p class="functions">
        <a class="icon-trash remove-clone"
           i18n:translate="label_remove_measure"
        >Delete this measure</a>
      </p>

      <fieldset class="vertical"
                id="fields-#{1}"
      >
        <label><tal:label i18n:translate="label_description">Description</tal:label>
          <dfn class="icon-help-circle iconified pat-tooltip"
               data-pat-tooltip="source: content; position-list: lt"
               i18n:translate="actionplan_measure_tooltip"
          >Describe: 1) what is your general approach to eliminate or (if the risk is not avoidable) reduce the risk; 2) the specific action(s) required to implement this approach (to eliminate or to reduce the risk)</dfn>
          <textarea class="actionPlan"
                    autofocus="autofocus"
                    name="measure.action:utf8:ustring:records"
                    placeholder="General approach (to eliminate or reduce the risk)"
                    rows="3"
                    i18n:attributes="placeholder label_measure_action_plan"
          ></textarea>
        </label>
        <tal:requirements condition="python: 'requirements' not in view.skip_fields">
          <label><tal:label i18n:translate="label_expertise">Expertise</tal:label>
            <dfn class="icon-help-circle iconified pat-tooltip"
                 data-pat-tooltip="source: content; position-list: lt"
                 i18n:translate="actionplan_requirements_tooltip"
            >Describe the level of expertise needed to implement the measure, for instance &ldquo;common sense (no OSH knowledge required)&rdquo;, &ldquo;no specific OSH expertise, but minimum OSH knowledge or training and/or consultation of OSH guidance required&rdquo;, or &ldquo;OSH expert&rdquo;. You can also describe here any other additional requirement (if any).</dfn>
            <textarea class="requirements"
                      name="measure.requirements:utf8:ustring:records"
                      placeholder="Level of expertise and/or requirements needed"
                      rows="3"
                      i18n:attributes="placeholder label_measure_requirements"
            ></textarea>
          </label>
        </tal:requirements>
      </fieldset>

      <fieldset class="vertical">
        <label>
          <tal:span i18n:translate="label_action_plan_responsible">Who is responsible?</tal:span>
          <dfn class="icon-help-circle iconified pat-tooltip"
               data-pat-tooltip="source: content; position-list: lt"
               i18n:translate="actionplan_measure_responsible_tooltip"
          >Appoint someone in your company to be responsible for the implementation of this measure. This person will have the authority to take the steps described in the Plan and/or the responsibility to ensure that they are carried out.</dfn>
          <input class="responsible"
                 name="measure.responsible:utf8:ustring:records"
                 type="text"
          />
        </label>
        <label class="currency"
               tal:condition="python: 'budget' not in view.skip_fields"
        >
          <tal:span i18n:translate="label_action_plan_budget">Budget</tal:span>
          <dfn class="icon-help-circle iconified pat-tooltip"
               data-pat-tooltip="source: content; position-list: lt"
               i18n:translate="actionplan_measure_budget_tooltip"
          >Although some measures do not cost any money, most do. The measures should therefore be budgeted for; include them in the annual budget round if necessary.</dfn>
          <span class="composed currency-field">
            <input class="currency"
                   id="input-budget-#{1}"
                   min="0"
                   name="measure.budget:records"
                   type="number"
            />
          </span>
        </label>
        <label>
          <tal:label i18n:translate="label_action_plan_start">Planning start</tal:label>
          <input class="pat-date-picker"
                 id="planning-start-#{1}"
                 name="measure.planning_start:records"
                 type="date"
                 data-pat-date-picker="behavior: styled; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json"
                 data-pat-validation="${python:u'type: date; not-after: #planning-end-#{1}; message-date: %s' % view.message_date_before if 'planning_end' not in view.skip_fields else None}"
          />
        </label>
        <label tal:condition="python: 'planning_end' not in view.skip_fields">
          <tal:label i18n:translate="label_action_plan_end">Planning end</tal:label>
          <input class="pat-date-picker"
                 id="planning-end-#{1}"
                 name="measure.planning_end:records"
                 type="date"
                 data-pat-date-picker="behavior: styled; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json"
                 data-pat-validation="type:date; not-before: #planning-start-#{1}; message-date: ${view/message_date_after}"
          />
        </label>
      </fieldset>
    </div>
  </metal:action_plan>


  <metal:webstats_js define-macro="webstats_js"
                     meta:interpolation="true"
                     i18n:domain="euphorie"
  >
    <span tal:replace="structure webhelpers/get_webstats_js"></span>
  </metal:webstats_js>

</html>
