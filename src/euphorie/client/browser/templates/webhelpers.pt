<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      meta:interpolation="true"
      i18n:domain="euphorie"
>

  <metal:headers define-macro="headers">
    <meta http-equiv="Content-Type"
          content="text/html; charset=UTF-8"
    />
    <meta http-equiv="X-UA-Compatible"
          content="IE=edge"
    />
    <meta name="viewport"
          content="width=device-width, initial-scale=1"
    />
    <link href="${style_url}/apple-touch-icon.png"
          rel="icon"
          type="image/png"
    />
  </metal:headers>

  <metal:home define-macro="homelink"
              meta:interpolation="true"
              tal:define="
                logo_mode webhelpers/logoMode;
              "
  >
    <li id="home">
      <a href="${webhelpers/country_url}"
         tal:condition="python:logo_mode=='alien'"
      >${webhelpers/sector/title}</a>
      <a href="${webhelpers/country_url}"
         tal:condition="python:logo_mode=='native'"
      >
        <strong i18n:translate="title_tool">OiRA - Online interactive Risk Assessment</strong><br />
        <span tal:omit-tag=""
              i18n:translate="oira_name_line_1"
        >Online interactive</span><br />
        <span tal:omit-tag=""
              i18n:translate="oira_name_line_2"
        >Risk Assessment</span></a>
    </li>
  </metal:home>

  <metal:topnav define-macro="toplevel-navigation">
    <ul id="navigation">
      <metal:home use-macro="webhelpers/macros/homelink" />
      <li tal:condition="not:webhelpers/is_guest_account"><a href="${webhelpers/country_url}/logout"
           i18n:translate="navigation_logout"
        >Logout</a></li>
      <li tal:condition="not:webhelpers/is_guest_account"><a href="${webhelpers/session_overview_url}"
           i18n:translate="navigation_surveys"
        >My Assessments</a></li>
      <li><a href="${webhelpers/help_url}#${site_section}"
           i18n:translate="navigation_help"
        >Help</a></li>
      <li tal:condition="python:site_section not in ['preparation', 'session', 'sessions']"><a href="${webhelpers/survey_url}/status"
           i18n:translate="navigation_status"
        >Status</a></li>
      <li tal:condition="not:webhelpers/is_guest_account"><a href="${webhelpers/country_url}/account-settings"
           i18n:translate="navigation_settings"
        >Settings</a></li>
      <li tal:condition="webhelpers/is_guest_account"><a href="${webhelpers/country_url}/@@login?came_from=${context/absolute_url}"
           i18n:translate="Sign in"
        >Sign in</a></li>
    </ul>
  </metal:topnav>

  <metal:css define-macro="css"
             meta:interpolation="true"
  >
    <link href="${webhelpers/css_url}"
          rel="stylesheet"
          type="text/css"
    />
    <meta http-equiv="X-UA-Compatible"
          content="IE=Edge"
    />
  </metal:css>

  <metal:javascript define-macro="javascript"
                    meta:interpolation="true"
  >
    <script src="${webhelpers/js_url}"
            type="text/javascript"
    ></script>
  </metal:javascript>

  <metal:survey define-macro="survey_tree_inner"
                meta:interpolation="true"
                tal:define="
                  target_inject python:page_section=='identification' and '#step-2' or '#step-4';
                "
  >
    <ol class="${python:tree['leaf_module'] and 'questions' or ''}"
        tal:condition="exists:tree"
    >
      <tal:items repeat="item tree/children">
        <li class="${python: '%s %s' % (item['class'], 'submodule' if item['type'] == 'module' and item['depth']&gt;1 else '')}"
            id="${python:item['css_id']}"
            title="${python:'%s. %s' % (item['number'], item['title']) if tree['leaf_module'] else None}"
            tal:condition="python: item['type']!='location'"
        >
          <a class="pat-switch pat-inject"
             href="${item/url}"
             data-pat-inject="history: record; source: #main-content; target: #main-content ${python:item['type'] == 'module' and '&amp;&amp; source: {target}; target: {target}'.format(target=target_inject) or None} &amp;&amp; source: #status; target: #status"
             data-pat-switch="selector: #main; remove: sidebar-*; add: sidebar-off"
          >
            <strong class="${python:'counter' if item['type']=='module' else 'number'}">${item/number}</strong>
             ${item/title}
          </a>

          <tal:subtree define="
                         tree python:item;
                       "
                       condition="python:item['children']"
          >
            <metal:call use-macro="webhelpers/macros/survey_tree_inner" />
          </tal:subtree>
        </li>
        <tal:location condition="python: item['type']=='location'">
          <h4 class="location-tag">${item/title}</h4>
          <tal:subtree define="
                         tree python:item;
                       "
                       condition="python:item['children']"
          >
            <metal:call use-macro="webhelpers/macros/survey_tree_inner" />
          </tal:subtree>
        </tal:location>

      </tal:items>
    </ol>
  </metal:survey>

  <metal:survey define-macro="survey_tree"
                meta:interpolation="true"
  >

    <div class="topics"
         id="${python:page_section=='identification' and 'step-2-topics' or
            page_section=='actionplan' and 'step-4-topics' or ''}"
         tal:condition="exists:tree"
    >
      <metal:call use-macro="webhelpers/macros/survey_tree_inner" />
      <ul class="legend">
        <li class="unvisited"
            i18n:translate=""
        >Unvisited</li>
        <li class="postponed"
            i18n:translate=""
        >Postponed</li>
        <li class="answered"
            i18n:translate=""
        >Risk not present</li>
        <li class="answered risk"
            i18n:translate=""
        >Risk present</li>
      </ul>
    </div>
  </metal:survey>

  <metal:risk_identification define-macro="risk_identification">
    <fieldset class="vertical"
              id="${view/risk_number}"
              tal:define="
                always_present risk/risk_always_present|nothing;
              "
    >

      <!-- Existing Measures -->
      <fieldset class="pat-checklist pat-clone ${python:'pat-inject pat-autosubmit pat-subform' if (webhelpers.integrated_action_plan or webhelpers.use_training_module) else None}"
                id="risk_identification_form"
                data-pat-clone="template: #in-place-measure-template; trigger-element: #add-in-place-measure-button; remove-behaviour: none"
                data-pat-inject="${python:'source: #panel-action-plan::element; target: #panel-action-plan::element;' if webhelpers.integrated_action_plan else None}${python:' &amp;&amp; source: #page-module-training::element; target: #page-module-training::element;' if webhelpers.use_training_module else None}"
      >
        <tal:existing_measures condition="view/show_existing_measures">
          <article class="pat-rich">
            <p tal:content="structure view/intro_extra"></p>
          </article>
          <tal:measures define="
                          measures view/get_existing_measures_with_activation;
                        "
                        repeat="measure measures"
          >
            <div class="label"
                 tal:define="
                   description measure/text;
                 "
                 tal:condition="python: measure['plan_type']=='in_place_standard'"
            >
              <label class="label-fragment-title pat-rich"><input checked="${python:measure['active'] and 'checked' or None}"
                       name="measure-standard-${measure/solution_id}"
                       type="checkbox"
                /><tal:measure replace="structure python:webhelpers.get_safe_html(measure['title'])" /></label>
              <span class="label-fragment-description pat-rich"
                    tal:condition="description"
              ><pre class="pat-markdown"
                     tal:content="structure python:webhelpers.get_safe_html(description)"
                >Description</pre></span>
            </div>

            <label class="clone"
                   tal:condition="python: measure['plan_type']=='in_place_custom'"
            >
              <input checked="checked"
                     disabled="disabled"
                     name="measure-custom-${measure/solution_id}"
                     type="checkbox"
              />
              <textarea autofocus="autofocus"
                        cols="50"
                        name="measure-custom-${measure/solution_id}"
                        placeholder="${view/placeholder_add_extra}"
                        rows="3"
                        tal:content="structure python:webhelpers.get_safe_html(measure['text'])"
              ></textarea>
              <button class="icon-trash iconified remove-clone"
                      title="${view/button_remove_extra}"
              >Remove</button>

            </label>
          </tal:measures>
          <input name="handle_measures_in_place"
                 type="hidden"
                 value="1"
          />

          <template id="in-place-measure-template">
            <label class="clone">
              <input class="pat-autofocus"
                     autofocus="autofocus"
                     checked="checked"
                     disabled="disabled"
                     name="use-new-measure-#{1}"
                     type="checkbox"
              />
              <textarea cols="50"
                        name="new-measure-#{1}"
                        placeholder="${view/placeholder_add_extra}"
                        rows="3"
              ></textarea>
              <button class="icon-trash iconified remove-clone"
                      title="${view/button_remove_extra}"
              >Remove</button>
            </label>
          </template>
        </tal:existing_measures>
      </fieldset>

      <div class="button-bar cloning"
           tal:condition="python:view.show_existing_measures"
      >
        <button class="add-clone small pat-button icon-plus-circle"
                id="add-in-place-measure-button"
                title="${view/button_add_extra}"
                type="button"
        >${view/button_add_extra}</button>
      </div>
      <!-- END Existing measures -->

      <!-- Yes / No -->
      <fieldset class="pat-checklist radio pat-rich">
        <tal:existing condition="python:view.show_existing_measures and not always_present">
          <p tal:condition="view/intro_questions"
             tal:content="structure view/intro_questions"
          ></p>
        </tal:existing>
        <p class="byline"
           tal:condition="python:always_present and view.show_explanation_on_always_present_risks"
           i18n:translate="explanation_risk_always_present"
        >This risk was automatically set as being present. You cannot change this.</p>
        <tal:answers condition="not:always_present">
          <input name="answer:default"
                 type="hidden"
                 value="postponed"
          />
          <label class="yes"><input checked="${python:'checked' if context.identification=='yes' else None}"
                   name="answer"
                   type="radio"
                   value="yes"
            /><tal:answer replace="structure view/answer_yes" /></label>
          <label class="no"><input checked="${python:'checked' if context.identification=='no' else None}"
                   name="answer"
                   type="radio"
                   value="no"
            /><tal:answer replace="structure view/answer_no" /></label>
          <label class="not-applicable"
                 tal:condition="risk/show_notapplicable|nothing"
          ><input checked="${python:'checked' if context.identification=='n/a' else None}"
                   name="answer"
                   type="radio"
                   value="n/a"
            /><tal:answer replace="structure view/answer_na" /></label>
        </tal:answers>
        <tal:always_present condition="always_present"><input name="answer"
                 type="hidden"
                 value="${view/always_present_answer}"
          /></tal:always_present>
      </fieldset>
    </fieldset>
  </metal:risk_identification>

  <metal:risk_evaluation define-macro="risk_evaluation">
    <fieldset class="pat-well notice pat-depends vertical evaluation"
              id="evaluation"
              data-pat-depends="${view/evaluation_condition}; transition: slide"
              tal:define="
                evaluation_method python:risk.type in ('policy', 'top5') and risk.type or risk.evaluation_method;
              "
              tal:condition="not:view/skip_evaluation"
    >
      <p class="problem-description"><strong>${view/risk/problem_description}</strong></p>
      <tal:block condition="python:evaluation_method=='calculated'">
        <p class="instruction"
           i18n:translate="help_calculated_evaluation"
        >Please answer the following questions. As a result of your answers the system will calculate the priority of the risk. You will be able to modify the priority later.</p>
        <tal:get define="
                   algorithm python:view.evaluation_algorithm(risk);
                 ">
          <tal:kinney condition="python:algorithm!='french'">
            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/probability;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_probability">What is the chance of this risk occurring?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                     i18n:translate=""
                >${view/description_probability}</dfn>
              </legend>
              <label><input checked="${python:'checked' if value==1 else None}"
                       name="probability:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="probability_small">Small</tal:span></label>
              <label><input checked="${python:'checked' if value==3 else None}"
                       name="probability:int"
                       type="radio"
                       value="3"
                />
                <tal:span i18n:translate="probability_medium">Medium</tal:span></label>
              <label><input checked="${python:'checked' if value==5 else None}"
                       name="probability:int"
                       type="radio"
                       value="5"
                />
                <tal:span i18n:translate="probability_large">Large</tal:span></label>
            </fieldset>

            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/frequency;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_frequency">How often are people exposed to this risk?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_frequency}</dfn>
              </legend>
              <label><input checked="${python:'checked' if value==1 else None}"
                       name="frequency:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="frequency_almost_never">Almost never</tal:span></label>
              <label><input checked="${python:'checked' if value==4 else None}"
                       name="frequency:int"
                       type="radio"
                       value="4"
                />
                <tal:span i18n:translate="frequency_regularly">Regularly</tal:span></label>
              <label><input checked="${python:'checked' if value==7 else None}"
                       name="frequency:int"
                       type="radio"
                       value="7"
                />
                <tal:span i18n:translate="frequency_constantly">Constantly</tal:span></label>
            </fieldset>

            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/effect;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_effect">What is the severity of the damage?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_severity}</dfn>
              </legend>
              <label><input checked="${python:'checked' if value==1 else None}"
                       name="effect:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="effect_injury_no_absence">Weak severity</tal:span></label>
              <label><input checked="${python:'checked' if value==5 else None}"
                       name="effect:int"
                       type="radio"
                       value="5"
                />
                <tal:span i18n:translate="effect_injury_with_absence">Significant severity</tal:span></label>
              <label><input checked="${python:'checked' if value==10 else None}"
                       name="effect:int"
                       type="radio"
                       value="10"
                />
                <tal:span i18n:translate="effect_permanent_damage">High (very high) severity</tal:span></label>
            </fieldset>
          </tal:kinney>

          <tal:french condition="python:algorithm=='french'">
            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/effect;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_effect">What is the severity of the damage?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_severity}</dfn>
              </legend>
              <label>
                <input checked="${python:'checked' if value==1 else None}"
                       name="severity:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="severity_weak">Weak</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="No need to stop working"
                     i18n:attributes="title severity_weak_help;"
                ></dfn>
              </label>
              <label><input checked="${python:'checked' if value==5 else None}"
                       name="severity:int"
                       type="radio"
                       value="5"
                />
                <tal:span i18n:translate="severity_not_severe">Not very severe</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Need to stop working for less than 3 days"
                     i18n:attributes="title severity_not_severe_help"
                ></dfn>
              </label>
              <label><input checked="${python:'checked' if value==7 else None}"
                       name="severity:int"
                       type="radio"
                       value="7"
                />
                <tal:span i18n:translate="severity_severe">Severe</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Need to stop working for more than 3 days"
                     i18n:attributes="title severity_severe_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==10 else None}"
                       name="severity:int"
                       type="radio"
                       value="10"
                />
                <tal:span i18n:translate="severity_very_severe">Very severe</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Irreversible injury, incurable illness, death"
                     i18n:attributes="title severity_very_severe_help;"
                ></dfn>
              </label>
            </fieldset>

            <fieldset class="pat-checklist radio"
                      tal:define="
                        value context/frequency;
                      "
            >
              <legend><tal:span i18n:translate="header_risk_frequency">How often are people exposed to this risk?</tal:span>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                >${view/description_frequency}</dfn>
              </legend>
              <label>
                <input checked="${python:'checked' if value==1 else None}"
                       name="frequency:int"
                       type="radio"
                       value="1"
                />
                <tal:span i18n:translate="frequency_french_rare">Rare</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Once per year"
                     i18n:attributes="title frequency_french_rare_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==3 else None}"
                       name="frequency:int"
                       type="radio"
                       value="3"
                />
                <tal:span i18n:translate="frequency_french_not_often">Not very often</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Once per month"
                     i18n:attributes="title frequency_french_not_often_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==7 else None}"
                       name="frequency:int"
                       type="radio"
                       value="7"
                />
                <tal:span i18n:translate="frequency_french_often">Often</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Once per week"
                     i18n:attributes="title frequency_french_often_help;"
                ></dfn>
              </label>
              <label>
                <input checked="${python:'checked' if value==9 else None}"
                       name="frequency:int"
                       type="radio"
                       value="9"
                />
                <tal:span i18n:translate="frequency_french_regularly">Very often or regularly</tal:span><br />
                <dfn class="icon info pat-tooltip"
                     title="Minimum once per day"
                     i18n:attributes="title frequency_french_regularly_help;"
                ></dfn>
              </label>
            </fieldset>
          </tal:french>
        </tal:get>
      </tal:block>

      <tal:block condition="python:evaluation_method=='direct'">
        <fieldset class="pat-checklist radio"
                  tal:define="
                    value context/priority;
                  "
        >
          <p i18n:translate="header_risk_priority">Select the priority of this risk</p>
          <label><input checked="${python:'checked' if value=='low' else None}"
                   name="priority"
                   type="radio"
                   value="low"
            />
            <tal:span i18n:translate="priority_low">Low</tal:span></label>
          <label><input checked="${python:'checked' if value=='medium' else None}"
                   name="priority"
                   type="radio"
                   value="medium"
            />
            <tal:span i18n:translate="priority_medium">Medium</tal:span></label>
          <label><input checked="${python:'checked' if value=='high' else None}"
                   name="priority"
                   type="radio"
                   value="high"
            />
            <tal:span i18n:translate="priority_high">High</tal:span></label>
        </fieldset>
      </tal:block>

      <tal:block condition="python:evaluation_method in ('top5', 'policy', 'fixed')">
        <p i18n:translate="description_automatic_evaluation">The risk evaluation has been automatically done by the tool. You will be able to change the priority for this risk &ndash; if you consider it necessary &ndash; in the action plan.</p>
      </tal:block>
    </fieldset>
  </metal:risk_evaluation>

  <metal:legal_references define-macro="legal_references">
    <section class="legal-references"
             tal:condition="view/has_legal"
    >
      <h4 i18n:translate="label_legal_reference">Legal and policy references</h4>
      <tal:legal replace="structure python:webhelpers.get_safe_html(risk.legal_reference)">
        The requirements for fridges are defined in section 13.1 section a
        of the health code.
      </tal:legal>
    </section>
  </metal:legal_references>

  <metal:additional_files define-macro="additional_files">
    <section class="more-information"
             tal:condition="view/has_files"
    >
      <h4 tal:condition="python:risk.Type()=='Risk'"
          i18n:translate="header_additional_resources"
      >Additional resources to assess the risk</h4>
      <h4 tal:condition="python:risk.Type()=='Module'"
          i18n:translate="header_additional_resources_module"
      >Additional resources for this module</h4>
      <ul>
        <li class="icon-download"
            tal:condition="nocall:risk/file1|nothing"
        >
          <a href="${risk/absolute_url}/download/file1"><tal:caption condition="risk/file1_caption|nothing">${risk/file1_caption} (${risk/file1/filename})</tal:caption><tal:nocaption condition="not:risk/file1_caption|nothing">${risk/file1/filename}</tal:nocaption></a>
        </li>
        <li class="icon-download"
            tal:condition="nocall:risk/file2|nothing"
        >
          <a href="${risk/absolute_url}/download/file2"><tal:caption condition="risk/file2_caption|nothing">${risk/file2_caption} (${risk/file2/filename})</tal:caption><tal:nocaption condition="not:risk/file2_caption|nothing">${risk/file2/filename}</tal:nocaption></a>
        </li>
        <li class="icon-download"
            tal:condition="nocall:risk/file3|nothing"
        >
          <a href="${risk/absolute_url}/download/file3"><tal:caption condition="risk/file3_caption|nothing">${risk/file3_caption} (${risk/file3/filename})</tal:caption><tal:nocaption condition="not:risk/file3_caption|nothing">${risk/file3/filename}</tal:nocaption></a>
        </li>
        <li class="icon-download"
            tal:condition="nocall:risk/file4|nothing"
        >
          <a href="${risk/absolute_url}/download/file4"><tal:caption condition="risk/file4_caption|nothing">${risk/file4_caption} (${risk/file4/filename})</tal:caption><tal:nocaption condition="not:risk/file4_caption|nothing">${risk/file4/filename}</tal:nocaption></a>
        </li>
      </ul>
    </section>
  </metal:additional_files>

  <metal:training_configuration define-macro="training_configuration">
    <div class="pat-collapsible risk-module form-panel"
         id="page-module-training"
         data-pat-collapsible="store: local; scroll-selector: self; scroll-offset: 120px"
         tal:define="
           training_view nocall:here/@@training_slide;
         "
         tal:condition="webhelpers/use_training_module"
    >
      <h3 class="form-separation-header"
          i18n:translate="menu_training"
      >
        Training
      </h3>
      <input name="handle_training_measures"
             type="hidden"
             value="1"
      />

      <div class="panel-content"
           id="page-module-training-panel-content"
           style=""
      >
        <metal:training_configuration_inner define-macro="training_configuration_inner">
          <p class="pat-message info"
             i18n:translate="description-training-configuration"
          >
        Please tick anything that you might like to exclude from the training. Items that are greyed out will not be displayed on the training card.
          </p>
          <fieldset class="vertical"
                    tal:define="
                      existing_measures training_view/existing_measures_training;
                      planned_measures training_view/planned_measures_training;
                    "
          >

            <fieldset class="pat-checklist show-and-hide has-value checked"
                      tal:condition="existing_measures"
            >
              <p class="legend"
                 i18n:translate="label_existing_measures"
              >Already implemented measures</p>

              <tal:measures repeat="measure_id existing_measures">
                <label>
                  <input class=""
                         checked="${python:'checked' if existing_measures[measure_id]['active'] else None}"
                         name="training-measure-in-place-${measure_id}"
                         type="checkbox"
                  />
                  <tal:measure replace="structure python:webhelpers.get_safe_html(existing_measures[measure_id]['action'])" />
                </label>
              </tal:measures>
            </fieldset>

            <fieldset class="pat-checklist show-and-hide has-value checked"
                      tal:condition="planned_measures"
            >
              <p class="legend"
                 i18n:translate="label_planned_measures"
              >Planned measures</p>

              <tal:measures repeat="measure_id planned_measures">

                <label>
                  <input class=""
                         checked="${python:'checked' if planned_measures[measure_id]['active'] else None}"
                         name="training-measure-planned-${measure_id}"
                         type="checkbox"
                  />
                  <tal:measure replace="structure python:webhelpers.get_safe_html(planned_measures[measure_id]['action'])" />
                </label>
              </tal:measures>
            </fieldset>
          </fieldset>
        </metal:training_configuration_inner>
      </div>
    </div>
  </metal:training_configuration>

  <metal:risk_comments define-macro="risk_comments">
    <fieldset class="pat-collapsible risk-module ${default_state|nothing} form-panel"
              id="page-module-comments"
              data-pat-collapsible="store: local; scroll-selector: self; scroll-offset: 120px"
    >
      <h3 class="form-separation-header"
          i18n:translate="label_notes"
      >
            Notes
      </h3>

      <metal:rich_comments_inner define-macro="rich_comments_inner">
        <fieldset class="vertical"
                  id="comments"
        >
          <div class="pat-rich-editor pat-rich toolbar-detached">
            <textarea class="pat-tiptap"
                      name="comment:utf8:ustring"
                      placeholder="${view/notes_placeholder}"
                      data-pat-tiptap="
        toolbar-external: #assessment-toolbar;
        source-panel: #pat-modal.panel-html-source-editor;
        image-panel: #pat-modal.image-picker;
        link-panel: #pat-modal .link-panel;
        context-menu-link: #tiptap-context-menu-hyperlink-fieldname-comments
        url-scheme-mentions: https://quaive.cornelis.amsterdam/users/{USER};
        url-scheme-tags:  https://quaive.cornelis.amsterdam/tags/{TAG}"
                      tal:content="context/comment"
            >
            </textarea>
          </div>
        </fieldset>
      </metal:rich_comments_inner>
    </fieldset>
  </metal:risk_comments>

  <metal:action_plan define-macro="action_plan"
                     tal:define="
                       solutions view/solutions_available_for_action_plan|nothing;
                       action_plans view/context/custom_measures;
                     "
  >
    <tal:solutions condition="solutions">
      <div class="pat-modal-pop-over pat-collapsible closed pat-depends"
           id="measures-panel"
           data-pat-collapsible="open-trigger: #add-standard-measures; close-trigger: #close-standard-measures"
           data-pat-depends="${view/solutions_condition}"
      >
        <h2 class="title"
            i18n:translate=""
        >
          Standard measures
        </h2>
        <section class="pat-rich description">
          <p i18n:translate="label_select_measure">
            Select one or more of the known common measures provided.
          </p>
        </section>
        <div class="pat-checklist pat-pick-list free-form">
          <label class="item"
                 tal:repeat="solution solutions"
          >
            <input id="sm-${solution/id}"
                   checked="${python: 'checked' if solution['id'] in view.active_standard_measures else None}"
                   name="sm-${solution/id}"
                   type="checkbox"
            />
            <span class="text">${solution/description}</span>
            <span class="functions"><em class="small pat-button icon-plus-circle"
                  i18n:translate="button_add"
              >Add</em></span>
          </label>
        </div>
      </div>
      <button id="close-standard-measures"
              type="button"
      >Close panel</button>
    </tal:solutions>

    <div class="measures pat-clone"
         id="action_plan_form"
         data-pat-clone="template: #measure-template; trigger-element: #add-measure-button; remove-behaviour: none; remove-confirmation: ${view/delete_confirmation}"
    >

      <!-- Existing Measures -->
      <tal:existing_measures define="
                               measures view/get_existing_measures;
                             "
                             condition="python:webhelpers.get_phase()=='actionplan' and view.use_existing_measures"
      >
        <div class="measure pat-collapsible"
             tal:repeat="measure measures"
        >
          <h2><tal:translate i18n:translate="label_implemented_measure">Implemented measure</tal:translate>
          ${repeat/measure/number}
          </h2>
          <h4 i18n:translate="label_description">Description</h4>
          <div class="pat-rich">
            <pre class="pat-markdown"
                 tal:content="structure python:webhelpers.get_safe_html(measure.action)"
            >Action</pre>
          </div>
        </div>
      </tal:existing_measures>


      <tal:solutions repeat="solution solutions">
        <div class="measure pat-collapsible pat-depends"
             data-pat-depends="condition: sm-${solution/id};"
        >
          <h2>
          ${solution/description}
          </h2>
          <p class="functions">
            <a class="icon-trash pat-forward"
               href="#pick-sm-${solution/id}"
               title="Delete this measure"
               data-pat-forward="selector: #sm-${solution/id}"
               i18n:attributes="title label_remove_measure"
               i18n:translate=""
            >Remove</a>
          </p>
          <input name="measure.plan_type:records"
                 type="hidden"
                 value="measure_standard"
          />
          <input name="measure.solution_id:records"
                 type="hidden"
                 value="${solution/id}"
          />
          <input name="measure.action:utf8:ustring:records"
                 type="hidden"
                 value="${solution/action}"
          />
          <input name="measure.requirements:utf8:ustring:records"
                 type="hidden"
                 value="${solution/requirements}"
          />
          <tal:comment condition="nothing">
            We need to provide a value for id, so that further down in the form, where we list the custom measures, the id lands in the correct entry of the measures dictionary.
          </tal:comment>
          <input name="measure.id:records"
                 type="hidden"
                 value="-"
          />
          <section class="pat-rich">
            <h4 i18n:translate="label_description">
              Description
            </h4>
            <div class="pat-rich">
              <pre class="pat-markdown"
                   tal:content="structure python:webhelpers.get_safe_html(solution['action'])"
              >Action</pre>
            </div>
            <tal:requirements condition="python: 'requirements' not in view.skip_fields and solution['requirements']">
              <h4 i18n:translate="label_expertise">
                Expertise
              </h4>
              <p>
                ${solution/requirements}
              </p>
            </tal:requirements>
          </section>
          <fieldset class="vertical"
                    tal:define="
                      measure python:view.active_standard_measures.get(solution['id'], None);
                    "
          >
            <label>
              <tal:span i18n:translate="label_action_plan_responsible">Who is responsible?</tal:span>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_responsible_tooltip"
              >Appoint someone in your company to be responsible for the implementation of this measure. This person will have the authority to take the steps described in the Plan and/or the responsibility to ensure that they are carried out.</dfn>
              <input class="responsible"
                     name="measure.responsible:utf8:ustring:records"
                     type="text"
                     value="${python:measure.responsible if measure else None}"
              />
            </label>
            <label class="currency"
                   tal:condition="python: 'budget' not in view.skip_fields"
            >
              <tal:span i18n:translate="label_action_plan_budget">Budget</tal:span>
              <em class="message error"
                  tal:condition="exists:errors/budget"
                  i18n:translate="error_invalid_budget"
              >Please enter the budget in whole Euros.</em>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_budget_tooltip"
              >Although some measures do not cost any money, most do. The measures should therefore be budgeted for; include them in the annual budget round if necessary.</dfn>
              <span class="composed currency-field">
                <input class="currency"
                       id="solution-budget-${solution/id}"
                       min="0"
                       name="measure.budget:records"
                       type="number"
                       value="${python:measure.budget if measure else None}"
                />
              </span>
            </label>

            <label tal:define="
                     date_error exists:errors/planning_start_date;
                   ">
              <tal:label i18n:translate="label_action_plan_start">Planning start</tal:label>
              <input class="pat-date-picker"
                     id="solution-planning-start-${solution/id}"
                     name="measure.planning_start:records"
                     type="date"
                     value="${python:measure.planning_start if measure else None}"
                     data-pat-date-picker="output-format: D MMM YYYY; locale: ${language}; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json?set_language=${language}"
                     data-pat-validation="${python:u'not-after: #solution-planning-end-{number}; message-date: {message}'.format(number=solution['id'], message=view.message_date_before) if 'planning_end' not in view.skip_fields else None}"
              />
            </label>

            <label tal:define="
                     date_error exists:errors/planning_end_date;
                   "
                   tal:condition="python: 'planning_end' not in view.skip_fields"
            >
              <tal:label i18n:translate="label_action_plan_end">Planning end</tal:label>

              <input class="pat-date-picker"
                     id="solution-planning-end-${solution/id}"
                     name="measure.planning_end:records"
                     type="date"
                     value="${python:measure.planning_end if measure else None}"
                     data-pat-date-picker="output-format: D MMM YYYY; locale: ${language}; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json?set_language=${language}"
                     data-pat-validation="not-before: #solution-planning-start-${solution/id}; message-date: ${view/message_date_after}"
              />
            </label>

          </fieldset>
        </div>
      </tal:solutions>

      <tal:actionplans repeat="actionplan action_plans">
        <div class="measure clone pat-collapsible">
          <h2><tal:span condition="not:view/use_existing_measures"
                      i18n:translate="Measure"
            >Measure</tal:span>
            <tal:span condition="view/use_existing_measures"
                      i18n:translate="Additional Measure"
            >Additional Measure</tal:span>
          ${repeat/actionplan/number}
          </h2>
          <input name="measure.id:records"
                 type="hidden"
                 value="${actionplan/id}"
          />
          <input name="measure.plan_type:records"
                 type="hidden"
                 value="measure_custom"
          />
          <p class="functions">
            <a class="icon-trash remove-clone"
               i18n:translate="label_remove_measure"
            >Delete this measure</a>
          </p>

          <fieldset class="vertical"
                    id="fields-${repeat/actionplan/number}"
          >
            <label><tal:label i18n:translate="label_description">Description</tal:label>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_tooltip"
              >Describe: 1) what is your general approach to eliminate or (if the risk is not avoidable) reduce the risk; 2) the specific action(s) required to implement this approach (to eliminate or to reduce the risk)</dfn>
              <textarea class="actionPlan"
                        name="measure.action:utf8:ustring:records"
                        placeholder="General approach (to eliminate or reduce the risk)"
                        rows="3"
                        type="text"
                        tal:content="actionplan/action|nothing"
                        i18n:attributes="placeholder label_measure_action_plan"
              ></textarea>
            </label>
            <tal:requirements condition="python: 'requirements' not in view.skip_fields">
              <label><tal:label i18n:translate="label_expertise">Expertise</tal:label>
                <dfn class="icon-help-circle iconified pat-tooltip"
                     data-pat-tooltip="source: content; position-list: lt"
                     i18n:translate="actionplan_requirements_tooltip"
                >Describe the level of expertise needed to implement the measure, for instance &ldquo;common sense (no OSH knowledge required)&rdquo;, &ldquo;no specific OSH expertise, but minimum OSH knowledge or training and/or consultation of OSH guidance required&rdquo;, or &ldquo;OSH expert&rdquo;. You can also describe here any other additional requirement (if any).</dfn>
                <textarea class="requirements"
                          name="measure.requirements:utf8:ustring:records"
                          placeholder="Level of expertise and/or requirements needed"
                          rows="3"
                          tal:content="actionplan/requirements|nothing"
                          i18n:attributes="placeholder label_measure_requirements"
                ></textarea>
              </label>
            </tal:requirements>
          </fieldset>

          <fieldset class="vertical"
                    tal:define="
                      number repeat/actionplan/number;
                    "
          >
            <label>
              <tal:span i18n:translate="label_action_plan_responsible">Who is responsible?</tal:span>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_responsible_tooltip"
              >Appoint someone in your company to be responsible for the implementation of this measure. This person will have the authority to take the steps described in the Plan and/or the responsibility to ensure that they are carried out.</dfn>
              <input class="responsible"
                     name="measure.responsible:utf8:ustring:records"
                     type="text"
                     value="${actionplan/responsible|nothing}"
              />
            </label>
            <label class="${python:'error' if exists('errors/budget') else None}"
                   tal:condition="python: 'budget' not in view.skip_fields"
            >
              <tal:span i18n:translate="label_action_plan_budget">Budget</tal:span>
              <em class="message error"
                  tal:condition="exists:errors/budget"
                  i18n:translate="error_invalid_budget"
              >Please enter the budget in whole Euros.</em>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_measure_budget_tooltip"
              >Although some measures do not cost any money, most do. The measures should therefore be budgeted for; include them in the annual budget round if necessary.</dfn>
              <span class="composed currency-field">
                <input class="currency"
                       id="input-budget-${number}"
                       min="0"
                       name="measure.budget:records"
                       type="number"
                       value="${actionplan/budget|nothing}"
                />
              </span>
            </label>

            <label tal:define="
                     date_error exists:errors/planning_start_date;
                   ">
              <tal:label i18n:translate="label_action_plan_start">Planning start</tal:label>
              <input class="pat-date-picker"
                     id="planning-start-${number}"
                     name="measure.planning_start:records"
                     type="date"
                     value="${actionplan/planning_start|nothing}"
                     data-pat-date-picker="output-format: D MMM YYYY; locale: ${language}; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json?set_language=${language}"
                     data-pat-validation="${python:u'not-after: #planning-end-{number}; message-date: {message}'.format(number=number, message=view.message_date_before) if 'planning_end' not in view.skip_fields else None}"
              />
            </label>

            <label tal:define="
                     date_error exists:errors/planning_end_date;
                   "
                   tal:condition="python: 'planning_end' not in view.skip_fields"
            >
              <tal:label i18n:translate="label_action_plan_end">Planning end</tal:label>

              <input class="pat-date-picker"
                     id="planning-end-${number}"
                     name="measure.planning_end:records"
                     type="date"
                     value="${actionplan/planning_end|nothing}"
                     data-pat-date-picker="output-format: D MMM YYYY; locale: ${language}; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json?set_language=${language}"
                     data-pat-validation="not-before: #planning-start-${number}; message-date: ${view/message_date_after}"
              />
            </label>
          </fieldset>
        </div>
      </tal:actionplans>
    </div>

    <div class="button-bar">
      <tal:solutions condition="solutions">
        <button class="pat-button icon-plus-circle pat-depends ${view/style_buttons}"
                id="add-standard-measures"
                title="Add another measure"
                type="button"
                data-pat-depends="${view/solutions_condition}"
                i18n:translate="label_select_standard_measures"
        >Select standard measures</button>
      </tal:solutions>
      <button class="add-clone pat-button icon-plus-circle ${view/style_buttons}"
              id="add-measure-button"
              title="Add another measure"
              type="button"
              i18n:translate="label_extra_add_measure"
      >Add an extra measure</button>
    </div>

    <template id="measure-template">
      <div class="measure pat-collapsible">

        <h2><tal:span condition="not:view/use_existing_measures"
                    i18n:translate="Measure"
          >Measure</tal:span>
          <tal:span condition="view/use_existing_measures"
                    i18n:translate="Additional Measure"
          >Additional Measure</tal:span>
      #{1}
        </h2>
        <p class="functions">
          <a class="icon-trash remove-clone"
             i18n:translate="label_remove_measure"
          >Delete this measure</a>
        </p>

        <fieldset class="vertical"
                  id="fields-#{1}"
        >
          <label><tal:label i18n:translate="label_description">Description</tal:label>
            <dfn class="icon-help-circle iconified pat-tooltip"
                 data-pat-tooltip="source: content; position-list: lt"
                 i18n:translate="actionplan_measure_tooltip"
            >Describe: 1) what is your general approach to eliminate or (if the risk is not avoidable) reduce the risk; 2) the specific action(s) required to implement this approach (to eliminate or to reduce the risk)</dfn>
            <textarea class="actionPlan"
                      autofocus="autofocus"
                      name="measure.action:utf8:ustring:records"
                      placeholder="General approach (to eliminate or reduce the risk)"
                      rows="3"
                      i18n:attributes="placeholder label_measure_action_plan"
            ></textarea>
          </label>
          <tal:requirements condition="python: 'requirements' not in view.skip_fields">
            <label><tal:label i18n:translate="label_expertise">Expertise</tal:label>
              <dfn class="icon-help-circle iconified pat-tooltip"
                   data-pat-tooltip="source: content; position-list: lt"
                   i18n:translate="actionplan_requirements_tooltip"
              >Describe the level of expertise needed to implement the measure, for instance &ldquo;common sense (no OSH knowledge required)&rdquo;, &ldquo;no specific OSH expertise, but minimum OSH knowledge or training and/or consultation of OSH guidance required&rdquo;, or &ldquo;OSH expert&rdquo;. You can also describe here any other additional requirement (if any).</dfn>
              <textarea class="requirements"
                        name="measure.requirements:utf8:ustring:records"
                        placeholder="Level of expertise and/or requirements needed"
                        rows="3"
                        i18n:attributes="placeholder label_measure_requirements"
              ></textarea>
            </label>
          </tal:requirements>
        </fieldset>

        <fieldset class="vertical">
          <label>
            <tal:span i18n:translate="label_action_plan_responsible">Who is responsible?</tal:span>
            <dfn class="icon-help-circle iconified pat-tooltip"
                 data-pat-tooltip="source: content; position-list: lt"
                 i18n:translate="actionplan_measure_responsible_tooltip"
            >Appoint someone in your company to be responsible for the implementation of this measure. This person will have the authority to take the steps described in the Plan and/or the responsibility to ensure that they are carried out.</dfn>
            <input class="responsible"
                   name="measure.responsible:utf8:ustring:records"
                   type="text"
            />
          </label>
          <label class="currency"
                 tal:condition="python: 'budget' not in view.skip_fields"
          >
            <tal:span i18n:translate="label_action_plan_budget">Budget</tal:span>
            <dfn class="icon-help-circle iconified pat-tooltip"
                 data-pat-tooltip="source: content; position-list: lt"
                 i18n:translate="actionplan_measure_budget_tooltip"
            >Although some measures do not cost any money, most do. The measures should therefore be budgeted for; include them in the annual budget round if necessary.</dfn>
            <span class="composed currency-field">
              <input class="currency"
                     id="input-budget-#{1}"
                     min="0"
                     name="measure.budget:records"
                     type="number"
              />
            </span>
          </label>
          <label>
            <tal:label i18n:translate="label_action_plan_start">Planning start</tal:label>
            <input class="pat-date-picker"
                   id="planning-start-#{1}"
                   name="measure.planning_start:records"
                   type="date"
                   data-pat-date-picker="output-format: D MMM YYYY; locale: ${language}; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json?set_language=${language}"
                   data-pat-validation="${python:u'not-after: #planning-end-#{1}; message-date: %s' % view.message_date_before if 'planning_end' not in view.skip_fields else None}"
            />
          </label>
          <label tal:condition="python: 'planning_end' not in view.skip_fields">
            <tal:label i18n:translate="label_action_plan_end">Planning end</tal:label>
            <input class="pat-date-picker"
                   id="planning-end-#{1}"
                   name="measure.planning_end:records"
                   type="date"
                   data-pat-date-picker="output-format: D MMM YYYY; locale: ${language}; week-numbers: show; i18n: ${webhelpers/country_url}/@@date-picker-i18n.json?set_language=${language}"
                   data-pat-validation="not-before: #planning-start-#{1}; message-date: ${view/message_date_after}"
            />
          </label>
        </fieldset>
      </div>
    </template>
  </metal:action_plan>


  <metal:toolbar define-macro="toolbar">
    <div class="pat-toolbar sticky"
         id="assessment-toolbar"
    >
      <div class="toolbar-functions-area">
        <div class="toolbar-section editor">
          <div class="editor-toolbar tiptap"
               id="editor-toolbar-assessment"
          >
            <div class="pat-collapsible pat-context-menu closed align-left no-label icon-paragraph"
                 id="formatting-menu"
                 data-pat-collapsible="close-trigger: .context-menu:not(#formatting-menu),.close-menu;"
            >
              <strong class="context-menu-label menu-trigger pat-tooltip"
                      data-pat-tooltip="trigger: hover; source: content; position-list: tm; class: label"
              >Formatting</strong>
              <p class="close-menu">Close</p>
              <ul class="menu-list">
                <li>
                  <button class="button-heading-level-4 icon-header"
                          type="button"
                  >Header level 4</button>
                </li>
                <li>
                  <button class="button-paragraph icon-paragraph"
                          type="button"
                  >Normal</button>
                </li>
                <li>
                  <button class="button-blockquote icon-quote-left"
                          type="button"
                  >Quote</button>
                </li>
              </ul>
            </div>
            <button class="icon icon-bold button-bold pat-tooltip"
                    type="button"
                    data-pat-tooltip="trigger: hover; source: content; position-list: tm; class: label"
            >Bold</button>


            <button class="icon icon-italic button-italic pat-tooltip"
                    type="button"
                    data-pat-tooltip="trigger: hover; source: content; position-list: tm; class: label"
            >Italic</button>
            <a class="icon icon-link button-link pat-modal pat-tooltip"
               href="#tiptap-modal-hyperlink-fieldname-comments#document-content"
               data-pat-modal="class: medium panel panel-hyperlink"
               data-pat-tooltip="trigger: hover; source: content; position-list: tm; class: label"
            >Hyperlink</a>
            <div class="pat-collapsible pat-context-menu closed align-left no-label icon-list"
                 id="list-menu"
                 type="button"
                 data-pat-collapsible="close-trigger: .context-menu:not(#list-menu),.close-menu;"
            >
              <strong class="context-menu-label menu-trigger pat-tooltip"
                      data-pat-tooltip="trigger: hover; source: content; position-list: tm; class: label"
              >Lists</strong>
              <p class="close-menu">Close</p>
              <ul class="menu-list">
                <li>
                  <button class="button-unordered-list icon-list-bullet"
                          type="button"
                  >Bullet list</button>
                </li>
                <li>
                  <button class="button-ordered-list icon-list-numbered"
                          type="button"
                  >Ordered list</button>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <metal:actions define-slot="page-actions">
          <div class="toolbar-section quick-functions"
               id="assessment-toolbar-quick-functions"
          >
            <tal:status tal:define="
                          session_start_view nocall:here/@@start|webhelpers/traversed_session/@@start;
                          new_session session_start_view/is_new_session;
                          active python: page_section == 'status' and 'active' or '';
                          disabled python:page_section=='' or (page_section=='preparation' and new_session);
                        ">
              <a tal:replace="structure here/@@publication_badge|nothing"></a>
              <a tal:replace="structure here/@@sharing_badge|nothing"></a>
              <metal:macro use-macro="context/certificate_macros/macros/status_icon" />
            </tal:status>
            <a tal:replace="structure here/@@more_badge|nothing"></a>
          </div>
        </metal:actions>
      </div>
    </div>
  </metal:toolbar>

  <metal:webstats_js define-macro="webstats_js"
                     meta:interpolation="true"
                     i18n:domain="euphorie"
  >
    <span tal:replace="structure webhelpers/get_webstats_js"></span>
  </metal:webstats_js>

  <metal:honeypot define-macro="honeypot">
    <label class="zavat-chalav-ve-devach">
            Name
      <input id="name"
             autocomplete="off"
             name="my_name"
             placeholder="Your name here"
             type="text"
      />
    </label>
    <label class="zavat-chalav-ve-devach">
            E-mail
      <input id="email"
             autocomplete="off"
             name="my_email"
             placeholder="Your e-mail here"
             type="text"
      />
    </label>
  </metal:honeypot>

</html>
