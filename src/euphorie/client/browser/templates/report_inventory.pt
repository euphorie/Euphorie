<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      id="report_landing"
      meta:interpolation="true"
      metal:use-macro="context/@@shell/macros/shell"
      tal:define="
        webhelpers nocall:context/@@webhelpers;
        completion_percentage here/session/completion_percentage|python:0;
        completion_threshold webhelpers/report_completion_threshold|python:0;
        is_complete python: completion_percentage >= completion_threshold;
      "
      i18n:domain="euphorie"
>

  <body>
    <metal:slot fill-slot="content">
      <div class="pat-scroll-box"
           id="content-pane"
      >
        <div class="download-blocks"
             tal:condition="is_complete"
        >
          <div class="download-block">
            <div class="download-block-header">
              <h2>Report</h2>
              <a class="default pat-button download rtf icon-download"
                 href="${context/absolute_url}/@@pdf?view=report_inventory_pdf"
              >
                <tal:trans i18n:translate="button_download">Download</tal:trans>
              </a>
            </div>
          </div>
        </div>
        <metal:macro define-macro="report_inventory">
          <tal:block replace="tile:statusmessages" />

          <article class="pat-rich"
                   id="report"
                   tal:define="
                     modules view/modules;
                   "
          >
            <h1 tal:condition="python:len(modules) &gt; 1"
                i18n:translate="label_report_inventory"
            >Good practices and guidance</h1>
            <h1 tal:condition="python:len(modules) == 1"
                i18n:translate="label_report_inventory_short"
            >Short questionnaire report</h1>

            <tal:module tal:condition="is_complete"
                        tal:repeat="module modules"
            >
              <p tal:condition="python:len(modules) &gt; 1"
                 tal:replace="structure python:view.get_intro(module, idx=repeat.module.index)"
              ></p>
              <tal:recom tal:repeat="option python:view.get_selected_options(module)">
                <h3>${option/aq_parent/title}</h3>
                <em>Your answer:</em>
                <span>${option/title}</span>
                <h4>Measures:</h4>
                <p tal:repeat="recommendation option/values"
                   tal:replace="structure recommendation/text"
                >
                </p>
              </tal:recom>
            </tal:module>

            <p tal:condition="not:is_complete"
               i18n:translate="report_intro_incomplete"
            >
            When you have finished the assessment to at least
              <tal:number i18n:name="completion_threshold">${completion_threshold}</tal:number>% you will be able to create a report.
            </p>

          </article>

          <tal:block replace="tile:client-analytics" />
        </metal:macro>
      </div>
    </metal:slot>
  </body>
</html>
