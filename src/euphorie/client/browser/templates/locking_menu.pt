<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="euphorie"
>
  <body>
    <div id="locking-menu"
         hidden="hidden"
         tal:define="
           webhelpers python:view.webhelpers;
           session view/context/session;
           toLocalizedTime nocall: here/@@plone/toLocalizedTime;
           language view/portal/plone_portal_state/language;
           last_modifier session/last_modifier;
           last_locking_event view/last_locking_event;
           is_locked python:session.is_locked;
         "
    >
      <div class="pat-message notice"
           tal:condition="last_locking_event"
      >
        <p tal:define="
             last_actor nocall:last_locking_event/account;
           "
           tal:condition="last_locking_event"
        >
          <!-- Diplay this paragraph only when the assessment is published. -->
          <strong><tal:i18n i18n:translate="label_locked">Locked</tal:i18n>
            <time class="pat-display-time"
                  datetime="${value}"
                  data-pat-display-time="from-now: true; locale: ${language}"
                  tal:define="
                    value python:webhelpers.timezoned_date(view.lock_time);
                  "
            >${value}</time>
            <tal:publisher condition="nocall:last_actor">
              <tal:i18n i18n:translate="by">by</tal:i18n>
              <a href="mailto:${last_actor/email}">${last_actor/title}</a>
            </tal:publisher>
          </strong>
        </p>
        <p tal:condition="last_modifier"
           i18n:translate="last_edited_by"
        >Last edited by
          <a href="mailto:${last_modifier/email}"
             i18n:name="name"
          >${last_modifier/email}</a>
          on
          <tal:i18n i18n:name="date">${python:toLocalizedTime(session.modified, long_format=1)}</tal:i18n>.
        </p>
      </div>
      <tal:can_publish condition="view/show_actions">
        <ul class="menu"
            tal:switch="view/state"
        >
          <tal:case case="string:unlocked">
            <li>
              <form class="pat-inject"
                    action="${here/absolute_url}/@@locking_view/set_lock#content"
              >
                <button class="icon-lock close-panel"
                        type="submit"
                        i18n:translate="label_lock_assessment"
                >Lock this assessment</button>
              </form>
            </li>
          </tal:case>
          <tal:case case="string:locked">
            <li>
              <form class="pat-inject"
                    action="${here/absolute_url}/@@locking_view/unset_lock#content"
              >
                <button class="icon-lock-open close-panel"
                        type="submit"
                        i18n:translate="label_unlock_session"
                >Unlock this risk assessment</button>
              </form>
            </li>
            <li>
              <form class="pat-inject"
                    action="${here/absolute_url}/@@locking_view/refresh_lock#content"
              >
                <button class="icon-arrows-cw"
                        type="submit"
                        i18n:translate=""
                >Refresh locking date</button>
              </form>
            </li>
          </tal:case>
        </ul>
      </tal:can_publish>
      <div class="pat-message notice"
           tal:condition="not:last_locking_event"
      >
        <p i18n:translate="">No information about locking available.</p>
      </div>
    </div>
  </body>
</html>
