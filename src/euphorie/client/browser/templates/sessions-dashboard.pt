<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/@@shell/macros/shell"
      i18n:domain="euphorie"
>
  <metal:slot fill-slot="content"
    tal:define="language view/portal/plone_portal_state/language;
                toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                my_sessions view/get_ordered_sessions;">
  <tal:block replace="tile:statusmessages" />
  <div id="content-pane">
    <article id="screen-intro">
      <header class="title-group">
        <h1>
          OiRA
        </h1>
        <p class="byline">
          ${view/tool_byline}
        </p>
      </header>
    </article>
    <div class="row pat-masonry"
         id="dashboard"
         data-pat-masonry="column-width: .grid-sizer; gutter: 0; item-selector: .portlet; stamp: .stamp;"
    >
      <div class="grid-sizer"></div>

      <div class="portlet span-3" id="portlet-my-ras"  tal:condition="python:len(my_sessions)>0">
        <div class="content">
          <article class="portlet-intro">
            <header class="portlet-title-group">
              <h2 class="portlet-title"
                  i18n:translate=""
              >My risk assessments</h2>
            </header>
            <form class="portlet-tool-group pat-inject pat-autosubmit"
                  action="${request/getURL}#portlet-body-my-ras"
            >
              <div class="pat-collapsible context-menu closed align-right"
                    id="initiators-menu"
                    data-pat-collapsible="close-trigger: .context-menu:not(#initiators-menu),.close-menu"
              >
                <strong class="context-menu-label menu-trigger"
                        i18n:translate=""
                >
                  Filters
                </strong>
                <p class="close-menu"
                   i18n:translate=""
                >
                  Close
                </p>
                <fieldset class="pat-checklist">
                  <label>
                    <input checked="${python:'checked' if view.hide_archived else None}"
                           name="hide_archived"
                           type="checkbox"
                           value="1"
                    />
                    <input name="hide_archived_marker"
                           type="hidden"
                           value="1"
                    />
                    <tal:i18n i18n:translate="">Hide archived risk assessments</tal:i18n>
                  </label>
                </fieldset>
              </div>
            </form>
          </article>
          <div class="portlet-body" id="portlet-body-my-ras">
              <article class="pat-rich">
                <p i18n:translate="info_select_session">Select an earlier session to complete or review or
                  <a href="${webhelpers/session_overview_url}/new-session.html#document-content"
                     i18n:name="start_session"
                     i18n:translate="link_start_session"
                     class="pat-modal icon-plus-circle">start a new session</a>.
                </p>
              </article>
            <ul class="ras">
              <li tal:repeat="session my_sessions"
                class="ra">

                <a href="${here/aq_parent/absolute_url}/${session/zodb_path}/++session++${session/id}/@@start"
                  class="pat-inject follow"
                  data-pat-inject="source: #content; target: #content; &amp;&amp; source: #osc; target: #osc; history: record"
                >
                  <h4 class="name field">${session/title}</h4>
                  <p class="date field">
                    <span class="last-saved">
                      <tal:i18n i18n:translate="">Started</tal:i18n>
                      <time datetime="${value}"
                          tal:define="value session/created/isoformat|nothing;"
                      >${python:toLocalizedTime(value)}</time>
                    </span>
                  </p>
                </a>
                <a class="more-menu iconified icon-ellipsis pat-tooltip inactive"
                   href="${here/aq_parent/absolute_url}/${session/zodb_path}/++session++${session/id}/@@more_menu#more-menu"
                   data-pat-tooltip="source: ajax; position-list: tr"
                   i18n:translate=""
                >More</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="portlet span-3" id="portlet-available-tools">
        <div class="content">
          <article class="portlet-intro">
            <header class="portlet-title-group">
              <h2 class="portlet-title"
                  i18n:translate=""
              >
                Available OiRA tools
              </h2>
            </header>
          </article>
          <div class="portlet-body" id="portlet-body-available-tools">
            <form class="pat-inject"
                  action="${here/absolute_url}/@@new-session.html"
            >
              <article class="pat-rich">
                <p i18n:translate="label_select_new_session">
                  Start a new session by choosing one of the following sectoral tools.
                </p>
              </article>

              <fieldset class="tool-list">
                <fieldset class="department">
                  <fieldset class="tools pat-checklist radio">
                    <label class="tool"
                           tal:repeat="survey view/surveys"
                    >
                      <input name="survey"
                             type="radio"
                             value="${survey/id}"
                      />
                      <strong class="field name">${survey/title}</strong>
                    </label>
                  </fieldset>
                </fieldset>
              </fieldset>

              <p class="button-bar">
                <button class="small pat-button pat-depends"
                        type="submit"
                        data-pat-depends="condition: survey; action: enable"
                        i18n:translate="button_start_session"
                >Start session</button>
              </p>

              <input name="action"
                     type="hidden"
                     value="new"
              />
            </form>
          </div>
        </div>
      </div>

    </div>
    </div>

  </metal:slot>

  <metal:slot fill-slot="splash_message_slot">
    <div class="splash-message" id="splash-message">
    <tal:splash condition="python:splash_message is not None">
      <hr class="trigger pat-switch"
          data-pat-switch="selector: body; remove: splash-on-motd*; add: splash-off-${splash_message/id}; store: local"
      />
      <article class="pat-rich content">
        <p>
          <img src="${base_url}/++resource++euphorie.media/oira-logo-colour.svg"
               width="20%"
          />
        </p>
        <h1 tal:content="structure splash_message/title">Message of the day!</h1>
        <tal:content content="structure splash_message/text" />
      </article>
    </tal:splash>
    </div>
  </metal:slot>

    <metal:slot fill-slot="aside-header">
      <form id="osc-header" class="pat-inject pat-autosubmit" action="${absolute_url}/@@${view/__name__}#browser">
        <tal:in_group condition="python: root_group and root_parent">
          <a class="back-button pat-inject"
             href="${absolute_url}/@@${view/__name__}?groupid=${root_parent/group_id|nothing}"
             data-pat-inject="source: #osc-header; target: #osc-header &amp;&amp; source: #osc; target: #osc"
             i18n:translate=""
          >Back</a>
          <h2 class="column-title">${root_group/fullname}</h2>
        </tal:in_group>

        <!--
        <tal:root condition="python: not root_group or not root_parent">
          <label class="pat-select bare">
            <select>
              <option i18n:translate="">Group by department</option>
              <option i18n:translate="">Group by tool</option>
              <option>Group by publication date</option>
              <option>Group by modification date</option>
              <option>Group by user</option>
              <option>Group by country</option>
              <option>Group by sector</option>
            </select>
          </label>
        </tal:root>
        -->

        <a class="no-label pat-modal iconified icon-plus"
           id="button-new-session-quick"
           href="${webhelpers/session_overview_url}/@@new-session.html#document-content"
           title="Start a new session"
           data-pat-modal="class: large"
           i18n:attributes="title link_start_session"
           i18n:translate="New"
        >New</a>
        <button id="button-osc-expand"
                tal:condition="webhelpers/use_publication_feature"
                class="no-label iconified icon-resize-full pat-toggle"
                data-pat-toggle="selector: body; value: osc-size-full osc-size-normal"
                i18n:attributes="title"
                title="Expand sidebar" i18n:translate="">Expand sidebar</button>

      </form>
    </metal:slot>


</html>
